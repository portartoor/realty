function __MB_TASKS_TASK_DETAIL_scrollPageBottom(){if(window.platform=="android"){window.scrollTo(0,document.documentElement.scrollHeight)}else{var e=document.getElementById("tasks-detail-card-container");e.scrollTop=e.scrollHeight}}function __MBTasks__mobile_tasks_view_init(){MBTasks.CPT.view.hideBottomLoader=function(){BX("tasks-view-loader-area").innerHTML=""};MBTasks.CPT.view.softReset=function(e,s,a){try{var i=BX(e);switch(s){case"innerHTML":i.innerHTML="";break;case"href":i.href="javascript:void(0);";break;case"bgImage":i.style.backgroundImage="";break;case"hide":i.style.display="none";break;case"className":i.className=typeof a=="undefined"?"":a;break;case"value":i.value=typeof a=="undefined"?"":a;break}}catch(t){}};MBTasks.CPT.view.resetToBulk=function(){if(!BX("tasks-view-title"))return;var e=MBTasks.CPT.view.softReset;try{e("tasks-view-title","innerHTML");e("tasks-view-description","innerHTML");e("tasks-view-originator","innerHTML");e("tasks-view-responsible","innerHTML");e("tasks-view-originator","href");e("tasks-view-responsible","href");e("tasks-view-originator-work-position","innerHTML");e("tasks-view-responsible-work-position","innerHTML");e("tasks-view-originator-avatar","innerHTML");e("tasks-view-responsible","bgImage");e("tasks-view-status","innerHTML");e("tasks-view-status-corner","className","task-view-status");e("tasks-view-groupContainer","hide");e("tasks-view-groupName","innerHTML");e("tasks-view-deadlineBlock","hide");e("tasks-view-deadlineValue","innerHTML");e("tasks-view-priority","innerHTML");e("task-card-info-notification","innerHTML");e("task-card-info-notification","className","task-card-info-right");e("tasks-view-filesList","innerHTML");e("tasks-view-filesList","hide");e("tasks-view-accomplicesList","innerHTML");e("tasks-view-accomplicesBlock","hide");e("tasks-view-auditorsList","innerHTML");e("tasks-view-auditorsBlock","hide");e("tasks-view-membersBlock","hide");e("tasks-view-user-fields","innerHTML");if(BX("tasks-view-loader-area"))BX("tasks-view-loader-area").appendChild(BX.clone(MBTasks.CPT.view.LoadingImage));e("post-comment-hidden","hide");e("post-comment-hidden","innerHTML");if(BX("post-comments-wrap")){var s=BX("post-comments-wrap");var a=s.childNodes.length-1;for(var i=a;i>=0;i--){var t=s.childNodes[i];if(t.nodeName.toLowerCase()!="div")continue;if(t.className!=="post-comment-block")continue;BX.remove(t)}}e("post-comment-more","hide");e("tasks-already-loaded-on-page","value");MBTasks.CPT.view.switchOffMenu()}catch(n){}};MBTasks.CPT.view.renderBaseDataStatus=function(e){if(typeof e!="undefined"&&typeof e.status_formatted_name!="undefined")BX("tasks-view-status").innerHTML=BX.util.htmlspecialchars(e.status_formatted_name)};MBTasks.CPT.view.renderBaseData=function(e){if(!BX("tasks-view-title"))return;if(!e||!e.task_id){return}if(!!!e.title||e.title.length==0){var s=BX.message("MB_TASKS_TASK_DETAIL_TASK_WAS_REMOVED_OR_NOT_ENOUGH_RIGHTS");document.getElementById("tasks-view-title").innerHTML=s.replace("#TASK_ID#",e.task_id);return}var a=MBTasks.user_path_template.replace("#USER_ID#",parseInt(e.originator_id));var i=MBTasks.user_path_template.replace("#USER_ID#",parseInt(e.responsible_id));BX("tasks-view-title").innerHTML=BX.util.htmlspecialchars(e.title);BX("tasks-view-description").innerHTML=e.description;BX("tasks-view-originator").innerHTML=BX.util.htmlspecialchars(e.originator_formatted_name);BX("tasks-view-responsible").innerHTML=BX.util.htmlspecialchars(e.responsible_formatted_name);BX("tasks-view-originator-work-position").innerHTML=BX.util.htmlspecialchars(e.originator_work_position);BX("tasks-view-responsible-work-position").innerHTML=BX.util.htmlspecialchars(e.responsible_work_position);BX("tasks-view-originator").href=a;BX("tasks-view-responsible").href=i;MBTasks.CPT.view.renderBaseDataStatus(e);var t="";if(e.status_id==-1){t="task-list-status-overdue";BX("task-card-info-notification").className="task-card-info-right task-card-info-right-red";BX("task-card-info-notification").innerHTML=BX.message("MB_TASKS_TASK_DETAIL_NOTIFICATION_EXPIRED")}else if(e.status_id==4||e.status_id==7){t="task-list-status-waiting";if(e.status_id==4){BX("task-card-info-notification").className="task-card-info-right task-card-info-right-orange";BX("task-card-info-notification").innerHTML=BX.message("MB_TASKS_TASK_DETAIL_NOTIFICATION_STATE_SUPPOSEDLY_COMPLETED")}}else if(e.status_id==-2||e.status_id==1){t="task-list-status-new"}BX("tasks-view-status-corner").className="task-view-status "+t;try{if(e.originator_photo_src&&e.originator_photo_src.length>0)BX("tasks-view-originator-avatar").style.backgroundImage="url('"+e.originator_photo_src+"')";else BX("tasks-view-originator-avatar").style.backgroundImage=""}catch(n){}try{if(e.responsible_photo_src&&e.responsible_photo_src.length>0)BX("tasks-view-responsible-avatar").style.backgroundImage="url('"+e.responsible_photo_src+"')";else BX("tasks-view-responsible-avatar").style.backgroundImage=""}catch(n){}if(e.group_id>0){BX("tasks-view-groupContainer").style.display="block";BX("tasks-view-groupName").innerHTML=BX.util.htmlspecialchars(e.group_name)}else{BX("tasks-view-groupContainer").style.display="none";BX("tasks-view-groupName").innerHTML=""}if(e.deadline_formatted.length>0){BX("tasks-view-deadlineBlock").style.display="block";BX("tasks-view-deadlineValue").innerHTML=BX.util.htmlspecialchars(e.deadline_formatted)}else{BX("tasks-view-deadlineBlock").style.display="none";BX("tasks-view-deadlineValue").innerHTML=""}var r="black";var o="unknown priority";switch(parseInt(e.priority)){case 0:r="grey";o=BX.message("MB_TASKS_TASK_DETAIL_PRIORITY_LOW");break;case 1:r="green";o=BX.message("MB_TASKS_TASK_DETAIL_PRIORITY_AVERAGE");break;case 2:r="red";o=BX.message("MB_TASKS_TASK_DETAIL_PRIORITY_HIGH");break}BX("tasks-view-priority").innerHTML='<span style="color:'+r+'">'+o+"</span>";BitrixMobile.LazyLoad.showImages()};MBTasks.CPT.view.renderDetailData=function(e){var s=BX("tasks-view-filesList");if(!e||!e.task_id){if(s)s.innerHTML="error";BX("tasks-view-accomplicesList").innerHTML="error";BX("tasks-view-auditorsList").innerHTML="error";return false}if(e.accomplices){MBTasks.CPT.view.renderMembersList("tasks-view-accomplicesBlock","tasks-view-accomplicesList",e.task_id,e.accomplices)}if(e.auditors){MBTasks.CPT.view.renderMembersList("tasks-view-auditorsBlock","tasks-view-auditorsList",e.task_id,e.auditors)}if(e.auditors&&e.auditors.length||e.accomplices&&e.accomplices.length){BX("tasks-view-membersBlock").style.display="block"}else BX("tasks-view-membersBlock").style.display="none";MBTasks.CPT.view.renderUserFields(e.user_fields);MBTasks.CPT.view.resetMenu(e.task_id,e.actions);BX("tasks-view-loader-area").innerHTML="";BitrixMobile.LazyLoad.showImages()};MBTasks.CPT.view.resetMenu=function(e,s){var a=false;if(typeof MBTasks.CPT.view.vars=="undefined")MBTasks.CPT.view.vars={};if(typeof MBTasks.CPT.view.vars.pageMenu!="undefined"){MBTasks.CPT.view.vars.pageMenu.hide()}if(s){var i=MBTasks.CPT.view.createMenu(e,s);if(i.length){MBTasks.CPT.view.vars.pageMenu=new BXMobileApp.UI.Menu({items:i});BXMobileApp.UI.Page.TopBar.title.setCallback(function(){MBTasks.CPT.view.vars.pageMenu.show()});a=true}}if(!a){MBTasks.CPT.view.switchOffMenu()}};MBTasks.CPT.view.renderUserFields=function(e){var s=BX("tasks-view-user-fields");if(BX.type.isElementNode(s)){var a="";if(typeof e!="undefined"){for(var i in e){if(BX.type.isNotEmptyString(e[i].HTML)){a+='<div class="task-card-info-row user-field">'+'<div class="task-card-info-left">'+(BX.type.isNotEmptyString(e[i].TITLE)?BX.util.htmlspecialchars(e[i].TITLE):"&nbsp;")+"</div>"+'<div class="task-card-info-right">'+e[i].HTML+"</div>"+"</div>"}}}BX.html(s,a)}};MBTasks.CPT.view.renderFilesList=function(e){var s=0;if(!e.files&&!e.forum_files)return;if(MBTasks.residentTaskId!=e.task_id)return;var a=BX("tasks-view-filesList");if(!a)return;a.innerHTML="";var i=[];if(e.files){s=s+e.files.length;i=e.files}if(e.forum_files){s=s+e.forum_files.length;for(var t in e.forum_files){if(e.forum_files.hasOwnProperty(t)){e.forum_files[t]["fileLinkPref"]="/bitrix/components/bitrix/forum.interface/show_file.php?fid=";i.push(e.forum_files[t])}}}if(s==0){a.style.display="none";return}else a.style.display="block";i.forEach(function(s,i,t){try{var n="/bitrix/components/bitrix/tasks.task.detail/show_file.php?fid=";if(s.fileLinkPref)n=s.fileLinkPref;var r=n+s.id;var o=BX.create("div",{props:{className:"post-item-attached-file"},children:[BX.create("span",{style:{display:"none"},html:"&nbsp;"}),BX.create("a",{attrs:{href:r},text:BX.util.htmlspecialchars(s.name)}),BX.create("span",{text:" ("+s.size_formatted+")"})]});if(MBTasks.residentTaskId!=e.task_id)return;a.appendChild(o);if(MBTasks.residentTaskId!=e.task_id){try{BX.remove(o)}catch(T){}return}}catch(T){}})};MBTasks.CPT.view.renderMembersList=function(e,s,a,i){if(!i)return;if(MBTasks.residentTaskId!=a)return;BX(s).innerHTML="";if(i.length==0)BX(e).style.display="none";else BX(e).style.display="block";i.forEach(function(e,i,t){try{var n=MBTasks.user_path_template.replace("#USER_ID#",e.user_id);var r=BX.create("a",{attrs:{href:n},text:e.name_formatted});var o=BX.create("span",{html:" &nbsp; "});if(MBTasks.residentTaskId!=a)return;BX(s).appendChild(r);BX(s).appendChild(o);if(MBTasks.residentTaskId!=a){try{BX.remove(r);BX(s).appendChild(o)}catch(T){}return}}catch(T){}});return i.length>0};MBTasks.CPT.view.renderCommentsData=function(e){if(e&&e["commentsHTML"]&&BX("task-comments-block")){var s=BX.processHTML(e["commentsHTML"],false),a=function(e){if(BX("task-comments-block").childNodes.length>0){BX.ajax.processScripts(e)}else{setTimeout(function(){a(e)},100)}};BX("task-comments-block").innerHTML=s.HTML;a(s.SCRIPT)}else if(__MB_TASKS_TASK_TOPIC_REVIEWS_ShowComments){__MB_TASKS_TASK_TOPIC_REVIEWS_ShowComments(e)}};MBTasks.CPT.view.switchOffMenu=function(){if(typeof MBTasks.CPT.view.vars.pageMenu!="undefined")MBTasks.CPT.view.vars.pageMenu.hide();BXMobileApp.UI.Page.TopBar.title.setCallback("")};MBTasks.CPT.view.perfomActionOnFailure=function(){};MBTasks.CPT.view.perfomActionOnSuccess=function(e,s){if(!e)return;if(e=='{"status":"failed"}'||e.status&&e.status=="failed"){app.BasicAuth({success:function(e){return function(s){MBTasks.sessid=s.sessid_md5;BX.ajax({timeout:30,method:"POST",dataType:"json",url:MBTasks.snmRouterAjaxUrl,data:e,onsuccess:function(s){try{MBTasks.CPT.view.perfomActionOnSuccess(s,e)}catch(a){}},onfailure:function(){try{MBTasks.CPT.view.perfomActionOnFailure()}catch(e){}}})}}(s),failure:function(){try{MBTasks.CPT.view.perfomActionOnFailure()}catch(e){}}})}else if(e&&e.data&&e.data.task_id){var a={module_id:"tasks",emitter:"tasks component mobile.tasks.detail",task_id:e.data.task_id,action:e.action_perfomed,data:e.data,rc:e.rc};app.onCustomEvent("onTaskActionPerfomed",a);BX.onCustomEvent("onTaskActionPerfomed",[a])}};MBTasks.CPT.view.perfomAction=function(e,s,a){MBTasks.CPT.view.switchOffMenu();app.showPopupLoader();var i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var s=Math.random()*16|0,a=e=="x"?s:s&3|8;return a.toString(16)});app.onCustomEvent("onTaskActionBeforePerfome",{UUID:i});BX.onCustomEvent("onTaskActionBeforePerfome",[{UUID:i}]);var t=false;var n=false;if(s=="edit"){t=a.taskData;s="edit";n="BASE_AND_DETAIL_AND_COMMENTS";t["META::EVENT_GUID"]=i}else if(s=="delegate"){t=a.taskData;s="delegate";n="BASE_AND_DETAIL_AND_COMMENTS";t["META::EVENT_GUID"]=i}var r={site:MBTasks.site,lang:MBTasks.lang,task_id:e,user_id:MBTasks.userId,action:"perfom_action",action_name:s,subject:n,taskData:t,DATE_TIME_FORMAT:MBTasks.CPT.view.arParams.DATE_TIME_FORMAT,PATH_TEMPLATE_TO_USER_PROFILE:MBTasks.CPT.view.arParams.PATH_TEMPLATE_TO_USER_PROFILE,PATH_TO_FORUM_SMILE:MBTasks.CPT.view.arParams.PATH_TO_FORUM_SMILE,AVA_WIDTH:MBTasks.CPT.view.arParams.AVA_WIDTH,AVA_HEIGHT:MBTasks.CPT.view.arParams.AVA_HEIGHT},o={sessid:BX.bitrix_sessid(),site:MBTasks.site,lang:MBTasks.lang,task_id:e,user_id:MBTasks.userId,action:"perfom_action",action_name:s,subject:n,taskData:t,DATE_TIME_FORMAT:MBTasks.CPT.view.arParams.DATE_TIME_FORMAT,PATH_TEMPLATE_TO_USER_PROFILE:MBTasks.CPT.view.arParams.PATH_TEMPLATE_TO_USER_PROFILE,PATH_TO_FORUM_SMILE:MBTasks.CPT.view.arParams.PATH_TO_FORUM_SMILE,AVA_WIDTH:MBTasks.CPT.view.arParams.AVA_WIDTH,AVA_HEIGHT:MBTasks.CPT.view.arParams.AVA_HEIGHT};BX.ajax({timeout:30,method:"POST",dataType:"json",data:o,url:MBTasks.snmRouterAjaxUrl+(MBTasks.snmRouterAjaxUrl.indexOf("?")>=0?"&":"?")+BX.ajax.prepareData(r),onsuccess:function(e){return function(s){try{MBTasks.CPT.view.perfomActionOnSuccess(s,e);app.hidePopupLoader()}catch(a){}}}(o),onfailure:function(){try{app.hidePopupLoader();MBTasks.CPT.view.perfomActionOnFailure()}catch(e){}}})};MBTasks.CPT.view.createMenu=function(e,s){var a=[{name:BX.message("MB_TASKS_TASK_DETAIL_TASK_ADD"),arrowFlag:false,icon:"add",action:BX.delegate(function(){app.showModalDialog({url:BX.message("PATH_TO_USER_TASKS_EDIT")})},this)}];s.forEach(function(s,i,t){if(s.public_name=="edit"){a.push({name:BX.message("MB_TASKS_TASK_DETAIL_BTN_EDIT"),icon:"edit",arrowFlag:false,action:function(e){return function(){app.showModalDialog({url:MBTasks.task_edit_path_template.replace("#TASK_ID#",e+"&dialogKey="+MBTasks.CPT.view.dialogKey+"&t="+(new Date).getTime())})}}(e)})}if(s.public_name=="remove"){a.push({name:BX.message("MB_TASKS_TASK_DETAIL_BTN_REMOVE"),icon:"delete",action:function(e,s){return function(){app.confirm({title:BX.message("MB_TASKS_TASK_REMOVE_CONFIRM_TITLE"),text:BX.message("MB_TASKS_TASK_DETAIL_CONFIRM_REMOVE"),buttons:["OK",BX.message("MB_TASKS_TASK_DETAIL_USER_SELECTOR_BTN_CANCEL")],callback:function(e,s){return function(a){if(a==1)MBTasks.CPT.view.perfomAction(e,s)}}(e,s)})}}(e,s.system_name)})}if(s.public_name=="accept"){a.push({name:BX.message("MB_TASKS_TASK_DETAIL_BTN_ACCEPT_TASK"),icon:"check",action:function(e,s){return function(){MBTasks.CPT.view.perfomAction(e,s)}}(e,s.system_name)})}if(s.public_name=="start"){a.push({name:BX.message("MB_TASKS_TASK_DETAIL_BTN_START_TASK"),icon:"play",action:function(e,s){return function(){MBTasks.CPT.view.perfomAction(e,s)}}(e,s.system_name)})}if(s.public_name=="decline"){a.push({name:BX.message("MB_TASKS_TASK_DETAIL_BTN_DECLINE_TASK"),icon:"cancel",action:function(e,s){return function(){MBTasks.CPT.view.perfomAction(e,s)}}(e,s.system_name)})}if(s.public_name=="renew"){a.push({name:BX.message("MB_TASKS_TASK_DETAIL_BTN_RENEW_TASK"),icon:"reload",action:function(e,s){return function(){MBTasks.CPT.view.perfomAction(e,s)}}(e,s.system_name)})}if(s.public_name=="close"){a.push({name:BX.message("MB_TASKS_TASK_DETAIL_BTN_CLOSE_TASK"),icon:"finish",action:function(e,s){return function(){MBTasks.CPT.view.perfomAction(e,s)}}(e,s.system_name)})}if(s.public_name=="pause"){a.push({name:BX.message("MB_TASKS_TASK_DETAIL_BTN_PAUSE_TASK"),icon:"pause",action:function(e,s){return function(){MBTasks.CPT.view.perfomAction(e,s)}}(e,s.system_name)})}if(s.public_name=="approve"){a.push({name:BX.message("MB_TASKS_TASK_DETAIL_BTN_APPROVE_TASK"),icon:"checkbox",action:function(e,s){return function(){MBTasks.CPT.view.perfomAction(e,s)}}(e,s.system_name)})}if(s.public_name=="redo"){a.push({name:BX.message("MB_TASKS_TASK_DETAIL_BTN_REDO_TASK"),action:function(e,s){return function(){MBTasks.CPT.view.perfomAction(e,s)}}(e,s.system_name)})}if(s.public_name=="delegate"){a.push({name:BX.message("MB_TASKS_TASK_DETAIL_BTN_DELEGATE_TASK"),icon:"finish",action:function(e,s){return function(){app.openTable({callback:function(s){if(!(s&&s.a_users&&s.a_users[0]))return;var a=s.a_users[0];var i=a["ID"].toString();MBTasks.CPT.view.perfomAction(e,"delegate",{taskData:{TASK_ID:e,"META::DELEGATE_TO_USER":i}})},url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/index.php?mobile_action=get_user_list",markmode:true,multiple:false,return_full_mode:true,modal:true,alphabet_index:true,outsection:false,cancelname:BX.message("MB_TASKS_TASK_DETAIL_USER_SELECTOR_BTN_CANCEL")})}}(e,s.system_name)})}if(s.public_name=="add_favorite"||s.public_name=="delete_favorite"){a.push({name:BX.message("MB_TASKS_TASK_DETAIL_BTN_"+s.system_name.toString().toUpperCase()+"_TASK"),image:"/bitrix/templates/mobile_app/images/tasks/menu/favorite.png",action:function(e,s){return function(){MBTasks.CPT.view.perfomAction(e,s)}}(e,s.system_name)})}});return a};BX.addCustomEvent("onTaskSaveBefore",function(e){if(!(e&&e.module_id&&e.dialogKey&&e.taskData&&e.module_id=="tasks"&&e.dialogKey==MBTasks.CPT.view.dialogKey)){return}if(e.delayFire){(function(e){window.setTimeout(function(){MBTasks.CPT.view.perfomAction(e.taskData.TASK_ID,"edit",e)},parseInt(e.delayFire))})(e)}else MBTasks.CPT.view.perfomAction(e.taskData.TASK_ID,"edit",e)})}
//# sourceMappingURL=script.map.js