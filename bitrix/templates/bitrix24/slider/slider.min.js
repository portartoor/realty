BX.namespace("BX.Bitrix24");BX.Bitrix24.PageSlider={defaultOptions:{panelStylezIndex:3200,imStylezIndex:3300,imBarStylezIndex:3100,headerStylezIndex:3100,maxWidth:"auto",minWidth:"auto",overlayClassName:"slider-panel-overlay",overlayTop:false,containerClassName:"slider-panel-container",closeBtn:"slider-panel-close",contentClassName:"slider-panel-content-container",contentPadding:0,typeLoader:"default-loader",top:"inherit",right:"inherit",bottom:"inherit",height:"inherit",width:"inherit",anchorRules:[]},init:function(){if(this.inited){return}this.panel=BX("bx-panel");this.header=BX("header");this.imBar=BX("bx-im-bar");this.isOpen=false;this.inited=true;this.iframeSrc=null;this.animation=null;this.animationDuration=200;this.startParams={translateX:100,opacity:0};this.endParams={translateX:0,opacity:100};this.currentParams=null;this.createLayout();BX.addCustomEvent("BX.Bitrix24.PageSlider:close",this.close.bind(this));BX.addCustomEvent("BX.Bitrix24.Map:onBeforeOpen",this.close.bind(this,true))},setOptions:function(t){t=BX.type.isPlainObject(t)?t:{};this.defaultOptions=BX.mergeEx(this.defaultOptions,t)},createLayout:function(){this.overlay=BX.create("div",{props:{className:this.options.overlayClassName},events:{click:this.close.bind(this)}});this.container=BX.create("div",{props:{className:this.options.containerClassName}});this.closeBtn=BX.create("span",{props:{className:this.options.closeBtn},children:[BX.create("span",{props:{className:this.options.closeBtn+"-inner"}})],events:{click:this.close.bind(this)}});this.content=BX.create("div",{props:{className:this.options.contentClassName}});this.iframe=BX.create("iframe",{attrs:{src:"about:blank",frameborder:"0"},events:{load:this.onIframeLoad.bind(this)}});this.container.appendChild(this.content);this.container.appendChild(this.closeBtn);this.content.appendChild(this.iframe);document.body.appendChild(this.overlay);document.body.appendChild(this.container)},getLoaderId:function(t){var e=this.options.typeLoader;var i=this.getUrlRule(t);if(i&&BX.type.isNotEmptyString(i.loader)){e=i.loader}return e},createLoader:function(t){BX.remove(this.loader);t=BX.type.isNotEmptyString(t)?t:"default-loader";if(t==="default-loader"){this.loader=BX.create("div",{props:{className:"slider-panel-loader "+t},children:[BX.create("div",{props:{className:"b24-loader b24-loader-show"},children:[BX.create("div",{props:{className:"b24-loader-curtain"}})]})]})}else{this.loader=BX.create("div",{props:{className:"slider-panel-loader "+t},children:[BX.create("img",{attrs:{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAMAAABhq6zVAAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAAAtJREFUeAFjGMQAAACcAAG25ruvAAAAAElFTkSuQmCC"},props:{className:"slider-panel-loader-mask left"}}),BX.create("img",{attrs:{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAMAAABhq6zVAAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAAAtJREFUeAFjGMQAAACcAAG25ruvAAAAAElFTkSuQmCC"},props:{className:"slider-panel-loader-mask right"}})]})}this.loader.dataset.loader=t;this.content.appendChild(this.loader)},showLoader:function(t){if(!this.loader||this.loader.dataset.loader!==t){this.createLoader(t)}this.loader.style.opacity=1;this.loader.style.display="block"},closeLoader:function(){this.loader.style.display="none";this.loader.style.opacity=0},onIframeLoad:function(t){var e=this.iframe.contentWindow;var i=e.location;if(i.toString()==="about:blank"){return}this.closeLoader();BX.bind(e,"keyup",this.onDocumentKeyDown.bind(this));if(e.BX){e.BX.onCustomEvent("BX.Bitrix24.PageSlider:onOpen",[this])}var n=i.pathname+i.search+i.hash;this.iframeSrc=BX.util.remove_url_param(n,["IFRAME","IFRAME_TYPE"])},adjustLayout:function(){var t=0;var e=0;var i="100vh";if(this.options.overlayTop===false){var n=BX.pos(this.header);var s=window.pageYOffset||document.documentElement.scrollTop;t=n.bottom-s;if(t<0){t=0}i="calc(100vh - "+t+"px)";if(this.imBar){e=this.imBar.offsetWidth}}else{if(this.imBar){this.imBar.style.removeProperty("z-index")}}var a="100%";var r=this.options.maxWidth+"px";var o=this.options.minWidth>this.options.maxWidth?0:this.options.minWidth;if(this.options.maxWidth==="auto"){var h=240;var l=this.imBar?this.imBar.offsetWidth:0;var d=document.documentElement.clientWidth;var c=window.innerWidth-d;var p=h+l+c;if(d<1160){p-=175}a="calc(100% - "+p+"px)";r="auto"}this.overlay.style.height=i;this.overlay.style.top=t+"px";this.container.style.width=a;this.container.style.height=i;this.container.style.minWidth=o+"px";this.container.style.maxWidth=r+"px";this.container.style.top=t+"px";this.container.style.right=e+"px"},setFrameSrc:function(t){if(BX.type.isNotEmptyString(t)){if(this.iframeSrc!==t){this.iframeSrc=t;this.iframe.src=BX.util.add_url_param(t,{IFRAME:"Y",IFRAME_TYPE:"SIDE_SLIDER"})}}else{this.iframeSrc=null}},open:function(t,e){if(!BX.type.isNotEmptyString(t)){return}e=BX.type.isPlainObject(e)?e:{};this.options=BX.mergeEx({},this.defaultOptions,e);if(!this.isOpen){this.init();this.applyHacks();this.adjustLayout();this.bindEvents()}if(this.iframeSrc!==t){this.setFrameSrc(t);var i=this.getLoaderId(t);this.showLoader(i)}if(BX.type.isDomNode(document.activeElement)){document.activeElement.blur()}this.animateOpening();this.isOpen=true},animateOpening:function(){if(this.isOpen){return}BX.addClass(this.overlay,"slider-panel-overlay-open");BX.addClass(this.container,"slider-panel-container-open");if(this.animation){this.animation.stop()}this.animation=new BX.easing({duration:this.animationDuration,start:this.currentParams?this.currentParams:this.startParams,finish:this.endParams,transition:BX.easing.transitions.linear,step:BX.delegate(function(t){this.currentParams=t;this.animateStep(t)},this),complete:BX.delegate(function(){this.completeAnimation()},this)});this.animation.animate()},close:function(t){if(!this.isOpen){if(this.animation){this.animation.stop(true)}return}this.isOpen=false;this.unbindEvents();if(this.animation){this.animation.stop()}var e=this.iframe.contentWindow;if(e.BX){e.BX.onCustomEvent("BX.Bitrix24.PageSlider:onClose",[this])}if(t===true){this.currentParams=this.startParams;this.completeAnimation()}else{this.animation=new BX.easing({duration:this.animationDuration,start:this.currentParams,finish:this.startParams,transition:BX.easing.transitions.linear,step:BX.delegate(function(t){this.currentParams=t;this.animateStep(t)},this),complete:BX.delegate(function(){this.completeAnimation()},this)});this.animation.animate()}},completeAnimation:function(){this.animation=null;if(this.isOpen){this.currentParams=this.endParams}else{this.currentParams=this.startParams;BX.removeClass(this.overlay,"slider-panel-overlay-open");BX.removeClass(this.container,"slider-panel-container-open");this.container.style.removeProperty("width");this.container.style.removeProperty("right");this.container.style.removeProperty("max-width");this.container.style.removeProperty("min-width");this.closeBtn.style.removeProperty("opacity");this.resetHacks()}},applyHacks:function(){var t=window.innerWidth-document.documentElement.clientWidth;document.body.style.paddingRight=t+"px";document.body.style.overflow="hidden";this.header.style.paddingRight=t+"px";this.header.style.marginRight="-"+t+"px";this.header.style.zIndex=this.options.overlayTop===false?this.options.headerStylezIndex:"inherit";if(this.imBar){this.imBar.style.zIndex=this.options.imBarStylezIndex;this.imBar.style.width=this.imBar.offsetWidth+t-1+"px"}if(this.panel){this.panel.style.zIndex=this.options.panelStylezIndex}},resetHacks:function(){document.body.style.cssText="";if(this.panel){this.panel.style.removeProperty("z-index")}if(this.imBar){this.imBar.style.removeProperty("z-index");this.imBar.style.removeProperty("width")}this.header.style.cssText=""},animateStep:function(t){this.container.style.transform="translateX("+t.translateX+"%)";this.overlay.style.opacity=t.opacity/100;this.closeBtn.style.opacity=t.opacity/100},extractLinkFromEvent:function(t){t=t||window.event;var e=t.target;if(t.which!==1||!BX.type.isDomNode(e)||t.ctrlKey||t.metaKey){return null}var i=e;if(e.nodeName!=="A"){i=BX.findParent(e,{tag:"A"},1)}if(!BX.type.isDomNode(i)){return null}var n=i.getAttribute("href");if(n&&!BX.data(i,"slider-ignore-autobinding")&&!BX.ajax.isCrossDomain(n)){return{url:n,anchor:i,target:i.getAttribute("target")}}return null},handleClick:function(t){var e=this.extractLinkFromEvent(t);if(!e){return}var i=this.getUrlRule(e.url,e);if(!i){return}var n=BX.type.isFunction(i.validate)?i.validate(e):this.isValidLink(e);if(!n){return}if(BX.type.isFunction(i.handler)){i.handler(t,e)}else{t.preventDefault();this.open(e.url)}},getUrlRule:function(t,e){if(!BX.type.isNotEmptyString(t)){return null}var i=this.defaultOptions.anchorRules;var n=null;for(var s=0;s<i.length;s++){n=i[s];if(!BX.type.isArray(n.condition)){continue}for(var a=0;a<n.condition.length;a++){if(BX.type.isString(n.condition[a])){n.condition[a]=new RegExp(n.condition[a],"i")}var r=t.match(n.condition[a]);if(r&&!this.hasStopParams(t,n.stopParameters)){if(e){e.matches=r}return n}}}return null},isValidLink:function(t){return t.target!=="_blank"&&t.target!=="_top"},hasStopParams:function(t,e){if(!e||!BX.type.isArray(e)||!BX.type.isNotEmptyString(t)){return false}var i=t.indexOf("?");if(i===-1){return false}var n=t.substring(i);for(var s=0;s<e.length;s++){var a=e[s];if(n.match(new RegExp("[?&]"+a+"=","i"))){return true}}return false},bindAnchors:function(t){t=t||{};if(BX.type.isArray(t.rules)){this.defaultOptions.anchorRules=this.defaultOptions.anchorRules.concat(t.rules)}if(!this.anchorHandler){this.anchorHandler=this.handleClick.bind(this);window.document.addEventListener("click",this.anchorHandler,true)}},bindEvents:function(){BX.bind(document,"keydown",BX.proxy(this.onDocumentKeyDown,this));setTimeout(function(){BX.bind(document,"click",BX.proxy(this.onDocumentClick,this))}.bind(this),0);BX.bind(window,"resize",BX.throttle(this.onWindowResize,300,this));BX.bind(window,"scroll",BX.proxy(this.adjustLayout,this));if(this.header){this.header.addEventListener("click",BX.proxy(this.onHeaderClick,this),true)}BX.addCustomEvent("OnMessengerWindowShowPopup",BX.proxy(this.onMessengerOpen,this));if(BX.browser.IsMobile()){BX.bind(document.body,"touchmove",BX.proxy(this.disableScroll,this))}},unbindEvents:function(){BX.unbind(document,"keydown",BX.proxy(this.onDocumentKeyDown,this));BX.unbind(document,"click",BX.proxy(this.onDocumentClick,this));BX.unbind(window,"resize",BX.proxy(this.onWindowResize,this));BX.unbind(window,"scroll",BX.proxy(this.adjustLayout,this));if(this.header){this.header.removeEventListener("click",BX.proxy(this.onHeaderClick,this),true)}BX.removeCustomEvent("OnMessengerWindowShowPopup",BX.proxy(this.onMessengerOpen,this));if(BX.browser.IsMobile()){BX.unbind(document.body,"touchmove",BX.proxy(this.disableScroll,this))}},onMessengerOpen:function(){if(this.isOpen){this.close(true);BX.addCustomEvent("OnMessengerWindowClosePopup",BX.proxy(this.onMessengerClose,this))}},onMessengerClose:function(){this.open(this.iframeSrc);BX.removeCustomEvent("OnMessengerWindowClosePopup",BX.proxy(this.onMessengerClose,this))},onDocumentKeyDown:function(t){if(this.isViewerVisible()){return}if(t.keyCode===27){t.preventDefault();this.close()}},onDocumentClick:function(t){if(this.isViewerVisible()){return}if(this.overlay.contains(t.target)||this.container.contains(t.target)){return}if(this.imBar&&this.imBar.contains(t.target)){return}if(BX.findParent(t.target,{className:"popup-window"})){return}this.close()},onHeaderClick:function(t){if(this.isOpen&&t.target.className.match(/help-/)){this.close(true)}},onWindowResize:function(){this.adjustLayout()},isViewerVisible:function(){return BX.CViewer&&BX.CViewer.objNowInShow&&BX.CViewer.objNowInShow.bVisible},disableScroll:function(t){t.preventDefault()}};
//# sourceMappingURL=slider.map.js