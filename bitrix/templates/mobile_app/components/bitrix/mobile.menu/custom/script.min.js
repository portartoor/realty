(function(){if(BX.Menu)return;BX.Menu=function(){BX.addCustomEvent("mobile_calendar_first_page_trigger",BX.proxy(function(){window.bCalendarShowMobileHelp=false;this.calendarList(this.MenuSettings.userId)},this));BX.addCustomEvent("onMobileMenuSettingsSet",BX.proxy(function(){var e={enable:true,pulltext:this.MenuSettings.lang.pulltext,downtext:this.MenuSettings.lang.downtext,loadtext:this.MenuSettings.lang.loadtext};if(app.enableInVersion(2))e.action="RELOAD";else e.callback=function(){document.location.reload()};app.pullDown(e)},this));BX.addCustomEvent("onPullOnline",BX.delegate(function(e){var t=e.params;e=e.command;if(e=="user_status"&&this.MenuSettings.userId==t.USER_ID&&t.COLOR!=""){BX.style(BX("menu-user"),"background-color",t.COLOR)}},this));BX.addCustomEvent("onClearLFCounter",function(e){var t={};t[e]=0;BX.Menu.updateCounters(t)});BX.addCustomEvent("onPullEvent-main",function(e,t){if(e=="user_counter"&&t[BX.message("SITE_ID")]){var n=t[BX.message("SITE_ID")];BX.Menu.updateCounters(n)}});BX.addCustomEvent("onImUpdateCounter",function(e){if(e){if(typeof e["obZeroDate"]!="undefined"){var t=e["obZeroDate"];delete e["obZeroDate"]}BX.Menu.updateCounters(e,typeof t!="undefined"?t:null)}});this.MenuSettings={lang:{},userId:false,siteDir:"/",canInvite:false,calendarFirstVisit:false,profileUrl:null,helpUrl:null,marketPlaceApps:[],setSettings:function(e){if(e){if(e.lang)this.lang=e.lang;if(e.userId)this.userId=e.userId;if(e.siteDir)this.siteDir=e.siteDir;if(e.marketPlaceApps)this.marketPlaceApps=e.marketPlaceApps;if(e.canInvite)this.canInvite=e.canInvite;if(e.calendarFirstVisit)this.calendarFirstVisit=e.calendarFirstVisit;if(BX.type.isNotEmptyString(e.profileUrl)){this.profileUrl=e.profileUrl}if(BX.type.isNotEmptyString(e.helpUrl)){this.helpUrl=e.helpUrl}}BX.onCustomEvent("onMobileMenuSettingsSet",[e])}};this.getMarketPlaceAppName=function(e){var t=this.MenuSettings.marketPlaceApps;var n=t.length;for(var i=0;i<n;i++){if(t[i]["id"]==e){return t[i]["name"]}}return null};this.currentItem=null;this.init=function(e){this.currentItem=e;var t=document.getElementById("menu-items");var n=this;new FastButton(t,function(e){n.onItemClick(e)});var i={"menu-user-accounts":function(e){app.exec("showAuthForm");BX.eventCancelBubble(e)},"menu-user-help":function(e){BXMobileApp.PageManager.loadPageStart({url:n.MenuSettings.helpUrl});BX.eventCancelBubble(e)},"menu-user-logout":function(e){app.logOut();BX.eventCancelBubble(e)}};for(var s in i){var a=BX(s);if(!a){continue}BX.bind(a,"touchstart",function(){BX.addClass(this,"menu-user-action-selected")});BX.bind(a,"touchend",function(){BX.removeClass(this,"menu-user-action-selected")});new FastButton(a,i[s])}new FastButton(BX("menu-user"),function(){BXMobileApp.PageManager.loadPageStart({url:n.MenuSettings.profileUrl,bx24ModernStyle:true,page_id:"user_profile"})})};this.onItemClick=function(e){var t=e.target;var n=BX.hasClass(t.parentNode,"menu-item");if(t&&t.nodeType&&t.nodeType==1&&(BX.hasClass(t,"menu-item")||n)){if(n)t=t.parentNode;if(this.currentItem!=null)this.unselectItem(this.currentItem);this.selectItem(t);if(t.getAttribute("data-highlight")=="N"){setTimeout(BX.delegate(function(){this.unselectItem(t)},this),500)}var i=t.getAttribute("data-url");var s=t.getAttribute("data-mp-app");var a=t.getAttribute("data-mp-app-id");var o=t.getAttribute("data-pageid");var u=t.getAttribute("data-bx24ModernStyle");if(BX.type.isNotEmptyString(i)){var r={url:i};if(s=="Y"){var l=this.getMarketPlaceAppName(a);if(l!=null){r["title"]=l}r.url=location.protocol+"//"+location.host+r.url;app.exec("openMarketplaceApp",r)}else{if(BX.type.isNotEmptyString(o))r.page_id=o;if(BX.type.isNotEmptyString(u)&&u=="Y")r.bx24ModernStyle=true;BXMobileApp.PageManager.loadPageStart(r)}}else t.onclick();this.currentItem=t}};this.selectItem=function(e){if(!BX.hasClass(e,"menu-item-selected"))BX.addClass(e,"menu-item-selected")};this.unselectItem=function(e){BX.removeClass(e,"menu-item-selected")}};BX.Menu.counters={};BX.addCustomEvent("onGetLFCounter",function(e){if(typeof e!="undefined"&&typeof e.id!="undefined"&&typeof BX.Menu.counters[e.id]!="undefined"){e.value=BX.Menu.counters[e.id]["value"];e.zeroCounter=BX.Menu.counters[e.id]["zeroCounter"]}});BX.Menu.updateCounters=function(e,t){var n=0;for(var i in e){var s=BX(i=="**"?"menu-counter-live-feed":"menu-counter-"+i.toLowerCase(),true);if(!s)continue;if(e[i]>0){var a=e[i]>50;s.firstChild.innerHTML=a?"50":e[i];BX.addClass(s,"menu-item-counter-show-value"+(a?" menu-item-counter-show-plus":""))}else{BX.removeClass(s,"menu-item-counter-show-value menu-item-counter-show-plus")}BX.Menu.counters[i]={value:e[i],zeroCounter:typeof t=="object"&&t!=null&&typeof t[i]!="undefined"?t[i]:null}}for(var o in BX.Menu.counters){n=n+parseInt(BX.Menu.counters[o]["value"])}};BX.Menu.prototype.userList=function(){app.exec("offerAndroidAccountContactsSync");if(this.MenuSettings.canInvite){app.openBXTable({url:this.MenuSettings.siteDir+"mobile/?mobile_action=get_user_list&tags=Y&detail_url="+this.MenuSettings.siteDir+"mobile/users/?user_id=",isroot:true,table_settings:{type:"users",alphabet_index:true,outsection:false,button:{type:"plus",callback:BX.delegate(function(){app.openNewPage(this.MenuSettings.siteDir+"mobile/users/invite.php")},this)}}})}else{app.openUserList({source_url:this.MenuSettings.siteDir+"mobile/?mobile_action=get_user_list&tags=Y&detail_url="+this.MenuSettings.siteDir+"mobile/users/?user_id="})}app.closeMenu()};BX.Menu.prototype.bpList=function(e){app.openBXTable({url:this.MenuSettings.siteDir+"mobile/webdav/"+e,isroot:true,table_settings:{type:"files",useTagsInSearch:false}});app.closeMenu()};BX.Menu.prototype.webdavList=function(e){app.openBXTable({url:this.MenuSettings.siteDir+"mobile/webdav/"+e,isroot:true,table_settings:{type:"files",useTagsInSearch:false}});app.closeMenu()};BX.Menu.prototype.diskList=function(e,t){t=t||"/";e=e||{};t=encodeURIComponent(t);var n=encodeURIComponent(e.type);var i=encodeURIComponent(e.entityId);app.openBXTable({url:this.MenuSettings.siteDir+"mobile/?mobile_action=disk_folder_list&type="+n+"&path="+t+"&entityId="+i,isroot:true,table_settings:{type:"files",useTagsInSearch:false}});app.closeMenu()};BX.Menu.prototype.calendarList=function(e){BX.addCustomEvent("mobile_calendar_first_page",function(){window.bCalendarShowMobileHelp=false});if(window.bCalendarShowMobileHelp==undefined){window.bCalendarShowMobileHelp=this.MenuSettings.calendarFirstVisit}if(window.bCalendarShowMobileHelp===false||window.platform=="android"){app.openBXTable({url:this.MenuSettings.siteDir+"mobile/?mobile_action=calendar&user_id="+e,isroot:true,table_id:"calendar_list",table_settings:{cache:true,useTagsInSearch:false,use_sections:true,button:{type:"plus",callback:BX.delegate(function(){app.openNewPage(this.MenuSettings.siteDir+"mobile/calendar/edit_event.php")},this)}}})}else{app.loadPage(this.MenuSettings.siteDir+"mobile/calendar/first_page.php")}app.closeMenu()};window.MobileMenu=new BX.Menu})();
//# sourceMappingURL=script.map.js