if(typeof BX.HtmlHelper==="undefined"){BX.HtmlHelper=function(){};BX.HtmlHelper.setupSelectOptions=function(t,e){while(t.options.length>0){t.remove(0)}var i=null;var n="";for(var s=0;s<e.length;s++){var r=e[s];var o=BX.type.isNotEmptyString(r["group"])?r["group"]:"";if(o!==""&&o!==n){n=o;i=document.createElement("OPTGROUP");i.label=o;t.appendChild(i)}var a=BX.type.isNotEmptyString(r["value"])?r["value"]:"";var l=BX.type.isNotEmptyString(r["text"])?r["text"]:r["value"];var h=new Option(l,a,false,false);var c=BX.type.isPlainObject(r["attrs"])?r["attrs"]:null;if(c){for(var u in c){if(!c.hasOwnProperty(u)){continue}h.setAttribute("data-"+u,c[u])}}if(i){i.appendChild(h)}else{if(!BX.browser.IsIE()){t.add(h,null)}else{try{t.add(h,t.options[null])}catch(p){t.add(h,null)}}}}}}if(typeof BX.CrmUserSearchPopup==="undefined"){BX.CrmUserSearchPopup=function(){this._id="";this._search_input=null;this._data_input=null;this._componentName="";this._componentContainer=null;this._componentObj=null;this._serviceContainer=null;this._zIndex=0;this._dlg=null;this._dlgDisplayed=false;this._currentUser={};this._searchKeyHandler=BX.delegate(this._handleSearchKey,this);this._searchFocusHandler=BX.delegate(this._handleSearchFocus,this);this._externalClickHandler=BX.delegate(this._handleExternalClick,this);this._clearButtonClickHandler=BX.delegate(this._hadleClearButtonClick,this);this._userSelectorInitCounter=0};BX.CrmUserSearchPopup.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"crm_user_search_popup_"+Math.random();if(!e){e={}}if(!BX.type.isElementNode(e["searchInput"])){throw"BX.CrmUserSearchPopup: 'search_input' is not defined!"}this._search_input=e["searchInput"];this._clearButton=BX.findPreviousSibling(this._search_input,{className:"crm-filter-name-clean"});if(!BX.type.isElementNode(e["dataInput"])){throw"BX.CrmUserSearchPopup: 'data_input' is not defined!"}this._data_input=e["dataInput"];if(!BX.type.isNotEmptyString(e["componentName"])){throw"BX.CrmUserSearchPopup: 'componentName' is not defined!"}this._currentUser=e["user"]?e["user"]:{};this._componentName=e["componentName"];this._componentContainer=BX(this._componentName+"_selector_content");this._initializeUserSelector();this._adjustUser();this._serviceContainer=e["serviceContainer"]?e["serviceContainer"]:document.body;this.setZIndex(e["zIndex"])},_initializeUserSelector:function(){var t="O_"+this._componentName;if(!window[t]){if(this._userSelectorInitCounter===10){throw"BX.CrmUserSearchPopup: Could not find '"+t+"' user selector!"}this._userSelectorInitCounter++;window.setTimeout(BX.delegate(this._initializeUserSelector,this),200);return}this._componentObj=window[t];this._componentObj.onSelect=BX.delegate(this._handleUserSelect,this);this._componentObj.searchInput=this._search_input;if(this._currentUser){this._componentObj.setSelected([this._currentUser])}BX.bind(this._search_input,"keyup",this._searchKeyHandler);BX.bind(this._search_input,"focus",this._searchFocusHandler);if(BX.type.isElementNode(this._clearButton)){BX.bind(this._clearButton,"click",this._clearButtonClickHandler)}BX.bind(document,"click",this._externalClickHandler)},open:function(){this._componentContainer.style.display="";this._dlg=new BX.PopupWindow(this._id,this._search_input,{autoHide:false,draggable:false,closeByEsc:true,offsetLeft:0,offsetTop:0,zIndex:this._zIndex,bindOptions:{forceBindPosition:true},content:this._componentContainer,events:{onPopupShow:BX.delegate(function(){this._dlgDisplayed=true},this),onPopupClose:BX.delegate(function(){this._dlgDisplayed=false;this._componentContainer.parentNode.removeChild(this._componentContainer);this._serviceContainer.appendChild(this._componentContainer);this._componentContainer.style.display="none";this._dlg.destroy()},this),onPopupDestroy:BX.delegate(function(){this._dlg=null},this)}});this._dlg.show()},_adjustUser:function(){if(parseInt(this._currentUser["id"])>0){this._data_input.value=this._currentUser["id"];this._search_input.value=this._currentUser["name"]?this._currentUser.name:this._currentUser["id"]}else{this._data_input.value=this._search_input.value=""}},getZIndex:function(){return this._zIndex},setZIndex:function(t){if(typeof t==="undefined"||t===null){t=0}var e=parseInt(t);this._zIndex=!isNaN(e)?e:0},close:function(){if(this._dlg){this._dlg.close()}},select:function(t){this._currentUser=t;this._adjustUser();if(this._componentObj){this._componentObj.setSelected([t])}},_onBeforeDelete:function(){if(BX.type.isElementNode(this._search_input)){BX.unbind(this._search_input,"keyup",this._searchKeyHandler);BX.unbind(this._search_input,"focus",this._searchFocusHandler)}if(BX.type.isElementNode(this._clearButton)){BX.bind(this._clearButton,"click",this._clearButtonClickHandler)}BX.unbind(document,"click",this._externalClickHandler);if(this._componentContainer){BX.remove(this._componentContainer);this._componentContainer=null}},_hadleClearButtonClick:function(t){this._data_input.value=this._search_input.value=""},_handleExternalClick:function(t){if(!t){t=window.event}if(!this._dlgDisplayed){return}var e=null;if(t){if(t.target){e=t.target}else if(t.srcElement){e=t.srcElement}}if(e!==this._search_input&&!BX.findParent(e,{attribute:{id:this._componentName+"_selector_content"}})){this._adjustUser();this.close()}},_handleSearchKey:function(t){if(!this._dlg||!this._dlgDisplayed){this.open()}this._componentObj.search()},_handleSearchFocus:function(t){if(!this._dlg||!this._dlgDisplayed){this.open()}this._componentObj._onFocus(t)},_handleUserSelect:function(t){this._currentUser=t;this._adjustUser();this.close()}};BX.CrmUserSearchPopup.items={};BX.CrmUserSearchPopup.create=function(t,e,i){if(isNaN(i)){i=0}if(i>0){window.setTimeout(function(){BX.CrmUserSearchPopup.create(t,e,0)},i);return null}var n=new BX.CrmUserSearchPopup;n.initialize(t,e);this.items[t]=n;return n};BX.CrmUserSearchPopup.createIfNotExists=function(t,e){var i=this.items[t];if(typeof i!=="undefined"){i.initialize(t,e)}else{i=new BX.CrmUserSearchPopup;i.initialize(t,e);this.items[t]=i}return i};BX.CrmUserSearchPopup.deletePopup=function(t){var e=this.items[t];if(typeof e==="undefined"){return false}e._onBeforeDelete();delete this.items[t];return true}}if(typeof BX.CrmNotifier==="undefined"){BX.CrmNotifier=function(){this._sender=null;this._listeners=[]};BX.CrmNotifier.prototype={initialize:function(t){this._sender=t},addListener:function(t){if(!BX.type.isFunction(t)){return}for(var e=0;e<this._listeners.length;e++){if(this._listeners[e]===t){return}}this._listeners.push(t)},removeListener:function(t){if(!BX.type.isFunction(t)){return}for(var e=0;e<this._listeners.length;e++){if(this._listeners[e]===t){this._listeners.splice(e,1);return}}},resetListeners:function(){this._listeners=[]},notify:function(t){var e=[];for(var i=0;i<this._listeners.length;i++){e.push(this._listeners[i])}if(!BX.type.isArray(t)){t=[]}t.splice(0,0,this._sender);for(var n=0;n<e.length;n++){try{e[n].apply(this._sender,t)}catch(s){}}},getListenerCount:function(){return this._listeners.length}};BX.CrmNotifier.create=function(t){var e=new BX.CrmNotifier;e.initialize(t);return e}}if(typeof BX.CmrSelectorMenuItem==="undefined"){BX.CmrSelectorMenuItem=function(){this._parent=null;this._settings={};this._onSelectNotifier=null};BX.CmrSelectorMenuItem.prototype={initialize:function(t){this._settings=t;this._onSelectNotifier=BX.CrmNotifier.create(this);var e=this.getSetting("events");if(e&&e["select"]){this._onSelectNotifier.addListener(e["select"])}},getSetting:function(t,e){var i=this._settings;return typeof i[t]!="undefined"?i[t]:e},getValue:function(){return this.getSetting("value","")},getText:function(){var t=this.getSetting("text");return BX.type.isNotEmptyString(t)?t:this.getValue()},isEnabled:function(){return this.getSetting("enabled",true)},isDefault:function(){return this.getSetting("default",false)},createMenuItem:function(t){t=!!t;var e=this.getText();if(!!t){e=BX.util.htmlspecialchars(e)}return{text:e,onclick:BX.delegate(this._onClick,this)}},addOnSelectListener:function(t){this._onSelectNotifier.addListener(t)},removeOnSelectListener:function(t){this._onSelectNotifier.removeListener(t)},_onClick:function(){this._onSelectNotifier.notify()}};BX.CmrSelectorMenuItem.create=function(t){var e=new BX.CmrSelectorMenuItem;e.initialize(t);return e}}if(typeof BX.CmrSelectorMenu==="undefined"){BX.CmrSelectorMenu=function(){this._id="";this._settings={};this._items=[];this._encodeItems=true;this._onSelectNotifier=null;this._popup=null;this._isOpened=false;this._itemSelectHandler=BX.delegate(this.onItemSelect,this)};BX.CmrSelectorMenu.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"crm_selector_menu_"+Math.random().toString().substring(2);this._settings=e?e:{};this._encodeItems=!!this.getSetting("encodeItems",true);var i=this.getSetting("items");i=BX.type.isArray(i)?i:[];this._items=[];for(var n=0;n<i.length;n++){var s=BX.CmrSelectorMenuItem.create(i[n]);s.addOnSelectListener(this._itemSelectHandler);this._items.push(s)}this._onSelectNotifier=BX.CrmNotifier.create(this)},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},isOpened:function(){return this._isOpened},open:function(t){if(this._isOpened){return}var e=[];for(var i=0;i<this._items.length;i++){var n=this._items[i];if(n.isEnabled()){e.push(n.createMenuItem(this._encodeItems))}}BX.PopupMenu.show(this._id,t,e,{offsetTop:0,offsetLeft:0,events:{onPopupShow:BX.delegate(this.onPopupShow,this),onPopupClose:BX.delegate(this.onPopupClose,this),onPopupDestroy:BX.delegate(this.onPopupDestroy,this)}});this._popup=BX.PopupMenu.currentItem},close:function(){if(this._popup&&this._popup.popupWindow){this._popup.popupWindow.close()}},addOnSelectListener:function(t){this._onSelectNotifier.addListener(t)},removeOnSelectListener:function(t){this._onSelectNotifier.removeListener(t)},onItemSelect:function(t){this.close();this._onSelectNotifier.notify([t])},onPopupShow:function(){this._isOpened=true},onPopupClose:function(){if(this._popup){if(this._popup.popupWindow){this._popup.popupWindow.destroy()}}},onPopupDestroy:function(){this._isOpened=false;this._popup=null;if(typeof BX.PopupMenu.Data[this._id]!=="undefined"){delete BX.PopupMenu.Data[this._id]}}};BX.CmrSelectorMenu.create=function(t,e){var i=new BX.CmrSelectorMenu;i.initialize(t,e);return i}}if(typeof BX.CrmSelector==="undefined"){BX.CrmSelector=function(){this._id="";this._selectedValue="";this._settings={};this._outerWrapper=this._wrapper=this._container=this._view=null;this._items=[];this._encodeItems=true;this._onSelectNotifier=null;this._popup=null;this._isPopupShown=false};BX.CrmSelector.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"crm_selector_"+Math.random().toString().substring(2);this._settings=e?e:{};this._container=this.getSetting("container",null);this._selectedValue=this.getSetting("selectedValue","");this._encodeItems=!!this.getSetting("encodeItems",true);var i=this.getSetting("items");i=BX.type.isArray(i)?i:[];this._items=[];for(var n=0;n<i.length;n++){var s=BX.CmrSelectorMenuItem.create(i[n]);s.addOnSelectListener(BX.delegate(this._onItemSelect,this));this._items.push(s)}this._onSelectNotifier=BX.CrmNotifier.create(this)},getId:function(){return this._id},getSetting:function(t,e){var i=this._settings;return typeof i[t]!="undefined"?i[t]:e},isEnabled:function(){return this.getSetting("enabled",true)},layout:function(t){if(BX.type.isDomNode(t)){this._container=t}else if(this._container){t=this._container}if(!t){return}var e=this.isEnabled();var i=this.getSetting("layout");if(!i){i={}}var n=this._outerWrapper=BX.create("DIV",{attrs:{className:"crm-selector-container",id:this._id}});if(i["position"]==="first"){t.insertBefore(n,BX.firstChild(t))}else if(i["insertBefore"]){t.insertBefore(n,BX.findChild(t,i["insertBefore"]))}else{t.appendChild(n)}var s=BX.type.isPlainObject(i["offset"])?i["offset"]:{};if(BX.type.isNotEmptyString(s["left"])){n.style.marginLeft=s["left"]}if(BX.type.isNotEmptyString(s["right"])){n.style.marginRight=s["right"]}var r=this.getSetting("title","");if(BX.type.isNotEmptyString(r)){n.appendChild(BX.create("SPAN",{attrs:{className:"crm-selector-title"},text:r+":"}))}var o=this._wrapper=BX.create("DIV",{attrs:{className:"crm-selector-wrapper"}});n.appendChild(o);var a=BX.delegate(this._onClick,this);var l=BX.create("DIV",{attrs:{className:"crm-selector-inner-wrapper"}});if(e){BX.bind(l,"click",a)}o.appendChild(l);var h=this._findItemByValue(this._selectedValue);if(!h){h=this.getDefaultItem()}var c=h?h.getText():"";if(this._encodeItems){c=BX.util.htmlspecialchars(c)}var u=this._view=BX.create("SPAN",{attrs:{className:"crm-selector-view"},html:c});l.appendChild(u);if(e){l.appendChild(BX.create("A",{attrs:{className:"crm-selector-arrow"},events:{click:a},html:"&nbsp;"}))}},clearLayout:function(){if(!this._outerWrapper){return}BX.remove(this._outerWrapper);this._outerWrapper=null},getItems:function(){return this._items},selectValue:function(t){this.selectItem(this._findItemByValue(t))},selectItem:function(t){if(!t){return}this._selectedValue=t.getValue();if(this._view){var e=t.getText();if(this._encodeItems){e=BX.util.htmlspecialchars(e)}this._view.innerHTML=e}},getSelectedValue:function(){return this._selectedValue},getSelectedItem:function(){return this._findItemByValue(this._selectedValue)},getDefaultItem:function(){var t=this.getItems();for(var e=0;e<t.length;e++){var i=t[e];if(i.isDefault()){return i}}return null},showPopup:function(){if(this._isPopupShown){return}var t=[];for(var e=0;e<this._items.length;e++){var i=this._items[e];if(i.isEnabled()){t.push(i.createMenuItem(this._encodeItems))}}BX.PopupMenu.show(this._id,this._wrapper,t,{offsetTop:0,offsetLeft:0,events:{onPopupShow:BX.delegate(this._onPopupShow,this),onPopupClose:BX.delegate(this._onPopupClose,this),onPopupDestroy:BX.delegate(this._onPopupDestroy,this)}});this._popup=BX.PopupMenu.currentItem},addOnSelectListener:function(t){this._onSelectNotifier.addListener(t)},removeOnSelectListener:function(t){this._onSelectNotifier.removeListener(t)},_findItemByValue:function(t){var e=this.getItems();for(var i=0;i<e.length;i++){var n=e[i];if(t===n.getValue()){return n}}return null},_onClick:function(t){t=t?t:window.event;BX.PreventDefault(t);if(this.isEnabled()){this.showPopup()}},_onItemSelect:function(t){this.selectItem(t);if(this._popup){if(this._popup.popupWindow){this._popup.popupWindow.close()}}this._onSelectNotifier.notify([t])},_onPopupShow:function(){this._isPopupShown=true},_onPopupClose:function(){if(this._popup){if(this._popup.popupWindow){this._popup.popupWindow.destroy()}}},_onPopupDestroy:function(){this._isPopupShown=false;this._popup=null;if(typeof BX.PopupMenu.Data[this._id]!=="undefined"){delete BX.PopupMenu.Data[this._id]}}};BX.CrmSelector.create=function(t,e){var i=new BX.CrmSelector;i.initialize(t,e);this.items[i.getId()]=i;return i};BX.CrmSelector.deleteItem=function(t){if(this.items[t]){this.items[t].clearLayout();delete this.items[t]}};BX.CrmSelector.items={}}if(typeof BX.CrmInterfaceFormUtil==="undefined"){BX.CrmInterfaceFormUtil=function(){};BX.CrmInterfaceFormUtil.disableThemeSelection=function(t){var e=window["bxForm_"+t];var i=e?e.settingsMenu:null;if(!i){return}for(var n=0;n<i.length;n++){if(i[n]&&i[n].ICONCLASS==="form-themes"){i.splice(n,1);break}}if(i.length===0){var s=BX.findChild(BX("form_"+t),{tag:"A","class":"bx-context-button bx-form-menu"},true);if(s){s.style.display="none"}}};BX.CrmInterfaceFormUtil.showFormRow=function(t,e){var i=BX.findParent(e,{tag:"TR"});if(i){i.style.display=!!t?"":"none"}}}if(typeof BX.CrmParamBag==="undefined"){BX.CrmParamBag=function(){this._params={}};BX.CrmParamBag.prototype={initialize:function(t){this._params=t?t:{}},getParam:function(t,e){var i=this._params;return typeof i[t]!="undefined"?i[t]:e},getIntParam:function(t,e){if(typeof e==="undefined"){e=0}var i=this._params;return typeof i[t]!="undefined"?parseInt(i[t]):e},getBooleanParam:function(t,e){if(typeof e==="undefined"){e=0}var i=this._params;return typeof i[t]!="undefined"?!!i[t]:e},setParam:function(t,e){this._params[t]=e},clear:function(){this._params={}}};BX.CrmParamBag.create=function(t){var e=new BX.CrmParamBag;e.initialize(t);return e}}if(typeof BX.CrmSubscriber==="undefined"){BX.CrmSubscriber=function(){this._id="";this._element=null;this._eventName="";this._callback=null;this._settings=null;this._handler=BX.delegate(this._onElementEvent,this)};BX.CrmSubscriber.prototype={initialize:function(t,e,i,n,s){this._id=t;this._element=e;this._eventName=i;this._callback=n;this._settings=s?s:BX.CrmParamBag.create(null)},getSetting:function(t,e){return this._settings.getParam(t,e)},setSetting:function(t,e){return this._settings.setParam(t,e)},getId:function(){return this._id},getElement:function(){return this._element},getEventName:function(){return this._eventName},getCallback:function(){return this._callback},subscribe:function(){BX.bind(this.getElement(),this.getEventName(),this._handler)},unsubscribe:function(){BX.unbind(this.getElement(),this.getEventName(),this._handler)},_onElementEvent:function(t){var e=this.getCallback();if(BX.type.isFunction(e)){e(this,{event:t})}return this.getSetting("preventDefault",false)?BX.PreventDefault(t):true}};BX.CrmSubscriber.items={};BX.CrmSubscriber.create=function(t,e,i,n,s){var r=new BX.CrmSubscriber;r.initialize(t,e,i,n,s);this.items[t]=r;return r};BX.CrmSubscriber.subscribe=function(t,e,i,n,s){var r=this.create(t,e,i,n,s);r.subscribe();return r}}if(typeof BX.CrmMultiFieldViewer==="undefined"){BX.CrmMultiFieldViewer=function(){this._id="";this._shown=false;this._layout="";this._typeName=""};BX.CrmMultiFieldViewer.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._layout=this.getSetting("layout","grid").toLowerCase();this._typeName=this.getSetting("typeName","")},getSetting:function(t,e){return typeof this._settings[t]!="undefined"?this._settings[t]:e},show:function(){if(this._shown){return}var t=BX.create("TABLE");t.cellSpacing="0";t.cellPadding="0";t.border="0";var e="bx-crm-grid-multi-field-viewer";var i=false;var n=this.getSetting("items",[]);for(var s=0;s<n.length;s++){var r=n[s];var o=t.insertRow(-1);var a=o.insertCell(-1);var l=r["value"];var h="crm-client-contacts-block-text";if(this._typeName==="PHONE"&&BX.type.isNotEmptyString(r["sipCallHtml"])){if(!i){i=true}l+=r["sipCallHtml"]}a.appendChild(BX.create("SPAN",{attrs:{className:h},html:l}));var c=o.insertCell(-1);c.appendChild(BX.create("SPAN",{attrs:{className:"crm-multi-field-value-type"},text:BX.type.isNotEmptyString(r["type"])?r["type"]:""}))}if(i){e+=" bx-crm-grid-multi-field-viewer-tel-sip"}t.className=e;var u=BX.CrmMultiFieldViewer.dialogs[this._id]?BX.CrmMultiFieldViewer.dialogs[this._id]:null;if(!u){var p=this.getSetting("anchor");if(!BX.type.isElementNode(p)){p=BX(this.getSetting("anchorId",""))}var m=!!this.getSetting("topmost",false);u=new BX.PopupWindow(this._id,p,{autoHide:true,draggable:false,offsetLeft:0,offsetTop:0,bindOptions:{forceBindPosition:true},closeByEsc:true,zIndex:m?-10:-14,className:"crm-item-popup-num-block",events:{onPopupShow:BX.delegate(function(){this._shown=true},this),onPopupClose:BX.delegate(function(){this._shown=false;BX.CrmMultiFieldViewer.dialogs[this._id].destroy()},this),onPopupDestroy:BX.delegate(function(){delete BX.CrmMultiFieldViewer.dialogs[this._id]},this)},content:t});BX.CrmMultiFieldViewer.dialogs[this._id]=u}u.show()},close:function(){if(this._shown&&typeof BX.CrmMultiFieldViewer.dialogs[this._id]!=="undefined"){BX.CrmMultiFieldViewer.dialogs[this._id].close()}}};BX.CrmMultiFieldViewer.items={};BX.CrmMultiFieldViewer.create=function(t,e){var i=new BX.CrmMultiFieldViewer;i.initialize(t,e);this.items[t]=i;return i};BX.CrmMultiFieldViewer.ensureCreated=function(t,e){return this.items[t]?this.items[t]:this.create(t,e)};BX.CrmMultiFieldViewer.dialogs={}}if(typeof BX.CrmSipManager==="undefined"){BX.CrmSipManager=function(){this._id="";this._settings=null;this._serviceUrls={};this._recipientInfos={}};BX.CrmSipManager.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:BX.CrmParamBag.create(null)},getId:function(){return this._id},getSetting:function(t,e){return this._settings.getParam(t,e)},setSetting:function(t,e){return this._settings.setParam(t,e)},openPreCallDialog:function(t,e,i,n){if(!t||typeof t!=="object"){return}if(!e||typeof e!=="object"){e={}}var s=BX.type.isNotEmptyString(e["ENTITY_TYPE"])?e["ENTITY_TYPE"]:"";var r=BX.type.isNotEmptyString(e["ENTITY_ID"])?e["ENTITY_ID"]:"";var o=s+"_"+r.toString();var a=BX.CrmPreCallDialog.create(o,BX.CrmParamBag.create({recipient:t,params:e,anchor:i,closeCallback:n}));a.show()},setServiceUrl:function(t,e){if(BX.type.isNotEmptyString(t)&&BX.type.isNotEmptyString(e)){this._serviceUrls[t]=e}},getServiceUrl:function(t){return BX.type.isNotEmptyString(t)&&this._serviceUrls.hasOwnProperty(t)?this._serviceUrls[t]:""},makeCall:function(t,e){var i=BX.type.isNotEmptyString(t["number"])?t["number"]:"";if(i==""){return}var n=BX.type.isNotEmptyString(e["ENTITY_TYPE"])?e["ENTITY_TYPE"]:"";var s=BX.type.isNotEmptyString(e["ENTITY_ID"])?parseInt(e["ENTITY_ID"]):0;if(!(n!==""&&s>0)){n=BX.type.isNotEmptyString(t["entityTypeName"])?t["entityTypeName"]:"";if(n!==""){n="CRM_"+n.toUpperCase()}e["ENTITY_TYPE"]=n;e["ENTITY_ID"]=typeof t["entityId"]!=="undefined"?parseInt(t["entityId"]):0}var r=[];BX.onCustomEvent(window,"CRM_SIP_MANAGER_MAKE_CALL",[this,t,e,r]);if(BX.type.isArray(r)&&r.length>0){for(var o=0;o<r.length;o++){var a=r[o];if(BX.type.isFunction(a)){try{a(t,e)}catch(l){}}}}else if(typeof window["BXIM"]!=="undefined"){window["BXIM"].phoneTo(i,e)}},startCall:function(t,e,i,n){i=!!i;if(i){var s=typeof t["enableInfoLoading"]?t["enableInfoLoading"]:false;if(s){var r=BX.type.isNotEmptyString(e["ENTITY_TYPE"])?e["ENTITY_TYPE"]:"";var o="";if(BX.type.isNotEmptyString(e["ENTITY_ID"])||BX.type.isNumber(e["ENTITY_ID"])){o=e["ENTITY_ID"]}var a=r+"_"+o.toString();if(this._recipientInfos.hasOwnProperty(a)){var l=this._recipientInfos[a];t["title"]=BX.type.isNotEmptyString(l["title"])?l["title"]:"";t["legend"]=BX.type.isNotEmptyString(l["legend"])?l["legend"]:"";t["imageUrl"]=BX.type.isNotEmptyString(l["imageUrl"])?l["imageUrl"]:"";t["showUrl"]=BX.type.isNotEmptyString(l["showUrl"])?l["showUrl"]:""}else{var h=this.getServiceUrl(BX.type.isNotEmptyString(e["ENTITY_TYPE"])?e["ENTITY_TYPE"]:"");if(h!==""){var c=BX.CrmSipRecipientInfoLoader.create(BX.CrmParamBag.create({serviceUrl:h,recipient:t,params:e,anchor:n,callback:BX.delegate(this._onRecipientInfoLoad,this)}));c.process();return}}}this.openPreCallDialog(t,e,n,BX.delegate(this._onPreCallDialogClose,this))}else{this.makeCall(t,e)}},getMessage:function(t){return BX.CrmSipManager.messages&&BX.CrmSipManager.messages.hasOwnProperty(t)?BX.CrmSipManager.messages[t]:""},_onPreCallDialogClose:function(t,e,i,n){if(!i||typeof i!=="object"){i={}}this.makeCall(e,i)},_onRecipientInfoLoad:function(t,e,i,n,s){var r=BX.type.isNotEmptyString(i["ENTITY_TYPE"])?i["ENTITY_TYPE"]:"";var o=BX.type.isNotEmptyString(i["ENTITY_ID"])?i["ENTITY_ID"]:"";var a=r+"_"+o.toString();this._recipientInfos[a]=s;e["title"]=BX.type.isNotEmptyString(s["title"])?s["title"]:"";e["legend"]=BX.type.isNotEmptyString(s["legend"])?s["legend"]:"";e["imageUrl"]=BX.type.isNotEmptyString(s["imageUrl"])?s["imageUrl"]:"";e["showUrl"]=BX.type.isNotEmptyString(s["showUrl"])?s["showUrl"]:"";this.openPreCallDialog(e,i,n,BX.delegate(this._onPreCallDialogClose,this))}};BX.CrmSipManager.items={};BX.CrmSipManager.create=function(t,e){var i=new BX.CrmSipManager;i.initialize(t,e);this.items[t]=i;return i};BX.CrmSipManager.current=null;BX.CrmSipManager.getCurrent=function(){if(!this._current){this._current=this.create("_CURRENT",null)}return this._current};BX.CrmSipManager.startCall=function(t,e,i,n){this.getCurrent().startCall(t,e,i,n)};BX.CrmSipManager.resolveSipEntityTypeName=function(t){return BX.type.isNotEmptyString(t)?"CRM_"+t.toUpperCase():""}}if(typeof BX.CrmSipRecipientInfoLoader==="undefined"){BX.CrmSipRecipientInfoLoader=function(){this._settings=null;this._serviceUrl=null;this._recipient=null;this._params=null;this._anchor=null;this._callBack=null};BX.CrmSipRecipientInfoLoader.prototype={initialize:function(t){this._settings=t?t:BX.CrmParamBag.create(null);this._serviceUrl=this.getSetting("serviceUrl","");this._recipient=this.getSetting("recipient");if(!this._recipient){this._recipient={}}this._params=this.getSetting("params");if(!this._params){this._params={}}this._anchor=this.getSetting("anchor",null);this._callBack=this.getSetting("callback");if(!BX.type.isFunction(this._callBack)){this._callBack=null}},getSetting:function(t,e){return this._settings.getParam(t,e)},setSetting:function(t,e){return this._settings.setParam(t,e)},process:function(){var t=this._params;var e=BX.type.isNotEmptyString(t["ENTITY_TYPE"])?t["ENTITY_TYPE"]:"";var i=typeof t["ENTITY_ID"]!=="undefined"?parseInt(t["ENTITY_ID"]):0;var n=this._serviceUrl;var s=this._callBack;if(e===""||i<=0||n===""){if(BX.type.isFunction(this._callBack)){s(this,this._recipient,this._params,this._anchor,{})}return}BX.ajax({url:n,method:"POST",dataType:"json",data:{MODE:"GET_ENTITY_SIP_INFO",ENITY_TYPE:e,ENITY_ID:i},onsuccess:BX.delegate(this._onSuccess,this)})},_onSuccess:function(t){var e=this._callBack;if(!BX.type.isFunction(e)){return}var i=typeof t["DATA"]!=="undefined"?t["DATA"]:{};var n=BX.type.isNotEmptyString(i["TITLE"])?i["TITLE"]:"";var s=BX.type.isNotEmptyString(i["LEGEND"])?i["LEGEND"]:"";var r=BX.type.isNotEmptyString(i["IMAGE_URL"])?i["IMAGE_URL"]:"";var o=BX.type.isNotEmptyString(i["SHOW_URL"])?i["SHOW_URL"]:"";try{e(this,this._recipient,this._params,this._anchor,{title:n,legend:s,showUrl:o,imageUrl:r})}catch(a){}}};BX.CrmSipRecipientInfoLoader.create=function(t){var e=new BX.CrmSipRecipientInfoLoader;e.initialize(t);return e}}if(typeof BX.CrmPreCallDialog==="undefined"){BX.CrmPreCallDialog=function(){this._id="";this._settings=null;this._recipient=null;this._params=null;this._anchor=null;this._dlg=null;this._isShown=false;this._makeCallButton=null;this._closeCallBack=null;this._onMakeCallButtonClickHandler=BX.delegate(this._onMakeCallButtonClick,this)};BX.CrmPreCallDialog.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:BX.CrmParamBag.create(null);this._recipient=this.getSetting("recipient");if(!this._recipient){this._recipient={}}this._params=this.getSetting("params");if(!this._params){this._params={}}this._anchor=this.getSetting("anchor",null);this._closeCallBack=this.getSetting("closeCallback");if(!BX.type.isFunction(this._closeCallBack)){this._closeCallBack=null}},getSetting:function(t,e){return this._settings.getParam(t,e)},setSetting:function(t,e){return this._settings.setParam(t,e)},getId:function(){return this._id},getMessage:function(t){return BX.CrmSipManager.messages&&BX.CrmSipManager.messages.hasOwnProperty(t)?BX.CrmSipManager.messages[t]:""},show:function(){if(this._isShown){return}this._dlg=BX.PopupWindowManager.create(this._id.toLowerCase()+"-pre-call",this._anchor,{content:this._preparePreCallDialogContent(),closeIcon:true,closeByEsc:true,lightShadow:true,angle:{offset:5},zIndex:200,events:{onPopupClose:BX.delegate(this._onDialogClose,this)}});if(!this._dlg.isShown()){this._dlg.show()}this._isShown=this._dlg.isShown()},close:function(){if(!this._isShown){return}if(this._dlg){this._dlg.close();this._isShown=this._dlg.isShown()}else{this._isShown=false}},_preparePreCallDialogContent:function(){var t=this._recipient;var e=BX.create("DIV",{attrs:{className:"crm-tel-popup"}});var i=BX.create("DIV",{attrs:{className:"crm-tel-popup-user"}});e.appendChild(i);var n=BX.create("DIV",{attrs:{className:"crm-tel-avatar"}});var s=BX.type.isNotEmptyString(t["imageUrl"])?t["imageUrl"]:"";if(s!==""){n.style.background="url("+s+") no-repeat 3px 3px"}i.appendChild(n);i.appendChild(BX.create("DIV",{attrs:{className:"crm-tel-user-alignment"}}));var r=BX.type.isNotEmptyString(t["title"])?t["title"]:this.getMessage("unknownRecipient");var o=BX.type.isNotEmptyString(t["legend"])?t["legend"]:"";var a=BX.type.isNotEmptyString(t["showUrl"])?t["showUrl"]:"#";i.appendChild(BX.create("DIV",{attrs:{className:"crm-tel-user-data"},children:[BX.create("A",{attrs:{className:"crm-tel-user-name",target:"_blank",href:a},text:r}),BX.create("DIV",{attrs:{className:"crm-tel-user-organ"},text:o})]}));var l=BX.type.isNotEmptyString(t["number"])?t["number"]:"-";var h=this._id.toLowerCase()+"_enable_recordind";var c=BX.create("DIV",{attrs:{className:"crm-tel-popup-num-block"},children:[BX.create("DIV",{attrs:{className:"crm-tel-popup-num"},text:l})]});e.appendChild(c);var u=BX.create("DIV",{attrs:{className:"crm-tel-popup-footer"}});e.appendChild(u);this._makeCallButton=BX.create("SPAN",{attrs:{className:"crm-tel-popup-call-btn"},text:this.getMessage("makeCall")});BX.bind(this._makeCallButton,"click",this._onMakeCallButtonClickHandler);u.appendChild(this._makeCallButton);return e},_onMakeCallButtonClick:function(t){if(!this._isShown){return}if(this._dlg){this._dlg.close()}this._isShown=this._dlg?this._dlg.isShown():false;BX.unbind(this._makeCallButton,"click",this._onMakeCallButtonClickHandler);if(this._closeCallBack){try{this._closeCallBack(this,this._recipient,this._params,{})}catch(e){}}},_onDialogClose:function(t){if(this._dlg){this._dlg.destroy();this._dlg=null}this._isShown=false}};BX.CrmPreCallDialog.create=function(t,e){var i=new BX.CrmPreCallDialog;i.initialize(t,e);return i}}if(typeof BX.CrmBizprocDispatcher=="undefined"){BX.CrmBizprocDispatcher=function(){this._id="";this._settings={};this._container=null;this._wrapper=null;this._serviceUrl="";this._entityTypeName="";this._entityId=0;this._formId="";this._tabId="tab_bizproc";this._currentPage="";this._formManager=null;this._isRequestRunning=false;this._isLoaded=false;this._waiter=null;this._scrollHandler=BX.delegate(this._onWindowScroll,this);this._formManagerHandler=BX.delegate(this._onFormManagerCreate,this)};BX.CrmBizprocDispatcher.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"crm_bp_disp_"+Math.random().toString().substring(2);this._settings=e?e:{};this._container=BX(this.getSetting("containerID",""));if(!this._container){throw"BX.CrmBizprocDispatcher. Could not find container."}this._wrapper=BX.findParent(this._container,{tagName:"DIV",className:"bx-edit-tab-inner"});this._serviceUrl=this.getSetting("serviceUrl","");if(!BX.type.isNotEmptyString(this._serviceUrl)){throw"BX.CrmBizprocDispatcher. Could not find service url."}this._entityTypeName=this.getSetting("entityTypeName","");if(!BX.type.isNotEmptyString(this._entityTypeName)){throw"BX.CrmBizprocDispatcher. Could not find entity type name."}this._entityId=parseInt(this.getSetting("entityID",0));if(!BX.type.isNumber(this._entityId)||this._entityId<=0){throw"BX.CrmBizprocDispatcher. Could not find entity id."}this._formId=this.getSetting("formID","");if(!BX.type.isNotEmptyString(this._formId)){throw"BX.CrmBizprocDispatcher. Could not find form id."}var i=window["bxForm_"+this._formId];if(i){this.setFormManager(i)}else{BX.addCustomEvent(window,"CrmInterfaceFormCreated",this._formManagerHandler)}this._currentPage=this.getSetting("currentPage","")},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},setSetting:function(t,e){this._settings[t]=e},getContainerRect:function(){var t=this._container.getBoundingClientRect();return{top:t.top,bottom:t.bottom,left:t.left,right:t.right,width:typeof t.width!=="undefined"?t.width:t.right-t.left,height:typeof t.height!=="undefined"?t.height:t.bottom-t.top}},isContanerInClientRect:function(){return this.getContainerRect().top<=document.documentElement.clientHeight},setFormManager:function(t){if(this._formManager===t){return}this._formManager=t;if(!this._formManager){return}if(this._formManager.GetActiveTabId()!==this._tabId){BX.addCustomEvent(window,"BX_CRM_INTERFACE_FORM_TAB_SELECTED",BX.delegate(this._onFormTabSelect,this));

}else{if(this.isContanerInClientRect()){this.loadIndex()}else{BX.bind(window,"scroll",this._scrollHandler)}}},loadIndex:function(){if(this._isLoaded){return}if(this._currentPage==="index"){return}var t=this._startRequest("INDEX",{FORM_ID:this.getSetting("formID",""),PATH_TO_ENTITY_SHOW:this.getSetting("pathToEntityShow","")});if(t){this._currentPage="index"}},_startRequest:function(t,e){if(this._isRequestRunning){return false}this._isRequestRunning=true;this._waiter=BX.showWait(this._container);BX.ajax({url:this._serviceUrl,method:"POST",dataType:"html",data:{ACTION:t,ENTITY_TYPE_NAME:this._entityTypeName,ENTITY_ID:this._entityId,PARAMS:e},onsuccess:BX.delegate(this._onRequestSuccess,this),onfailure:BX.delegate(this._onRequestFailure,this)});return true},_onRequestSuccess:function(t){this._isRequestRunning=false;if(this._waiter){BX.closeWait(this._container,this._waiter);this._waiter=null}this._container.innerHTML=t;this._isLoaded=true},_onRequestFailure:function(t){this._isRequestRunning=false;if(this._waiter){BX.closeWait(this._container,this._waiter);this._waiter=null}this._isLoaded=true},_onFormManagerCreate:function(t){if(t["name"]===this._formId){BX.removeCustomEvent(window,"CrmInterfaceFormCreated",this._formManagerHandler);this.setFormManager(t)}},_onFormTabSelect:function(t,e,i,n){if(this._formId===e&&(i===this._tabId||this._wrapper===n)){this.loadIndex()}},_onWindowScroll:function(t){if(!this._isLoaded&&!this._isRequestRunning&&this.isContanerInClientRect()){BX.unbind(window,"scroll",this._scrollHandler);this.loadIndex()}}};BX.CrmBizprocDispatcher.items={};BX.CrmBizprocDispatcher.create=function(t,e){var i=new BX.CrmBizprocDispatcher;i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.CrmEntityTreeDispatcher=="undefined"){BX.CrmEntityTreeDispatcher=function(){this._id="";this._settings={};this._container=null;this._subContainer=null;this._wrapper=null;this._serviceUrl="";this._entityTypeName="";this._entityId=0;this._formId="";this._tabId="tab_tree";this._formManager=null;this._isRequestRunning=false;this._isLoaded=false;this._waiter=null;this._scrollHandler=BX.delegate(this._onWindowScroll,this);this._formManagerHandler=BX.delegate(this._onFormManagerCreate,this)};BX.CrmEntityTreeDispatcher.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"crm_tree_disp_"+Math.random().toString().substring(2);this._settings=e?e:{};this._container=BX(this.getSetting("containerID",""));if(!this._container){throw"BX.CrmEntityTreeDispatcher. Could not find container."}this._wrapper=BX.findParent(this._container,{tagName:"DIV",className:"bx-edit-tab-inner"});this._serviceUrl=this.getSetting("serviceUrl","");if(!BX.type.isNotEmptyString(this._serviceUrl)){throw"BX.CrmEntityTreeDispatcher. Could not find service url."}this._entityTypeName=this.getSetting("entityTypeName","");if(!BX.type.isNotEmptyString(this._entityTypeName)){throw"BX.CrmEntityTreeDispatcher. Could not find entity type name."}this._entityId=parseInt(this.getSetting("entityID",0));if(!BX.type.isNumber(this._entityId)||this._entityId<=0){throw"BX.CrmEntityTreeDispatcher. Could not find entity id."}this._formId=this.getSetting("formID","");if(!BX.type.isNotEmptyString(this._formId)){throw"BX.CrmEntityTreeDispatcher. Could not find form id."}var i=window["bxForm_"+this._formId];if(i){this.setFormManager(i);if(e.selected===true){i.SelectTab(this._tabId)}}else{BX.addCustomEvent(window,"CrmInterfaceFormCreated",this._formManagerHandler)}this._moreButtonClickHandler=BX.delegate(this._handleMoreButtonClickHandler,this);this._entityButtonClickHandler=BX.delegate(this._handleEntityButtonClickHandler,this)},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},setSetting:function(t,e){this._settings[t]=e},getContainerRect:function(){var t=this._container.getBoundingClientRect();return{top:t.top,bottom:t.bottom,left:t.left,right:t.right,width:typeof t.width!=="undefined"?t.width:t.right-t.left,height:typeof t.height!=="undefined"?t.height:t.bottom-t.top}},isContanerInClientRect:function(){return this.getContainerRect().top<=document.documentElement.clientHeight},setFormManager:function(t){if(this._formManager===t){return}this._formManager=t;if(!this._formManager){return}if(this._formManager.GetActiveTabId()!==this._tabId){BX.addCustomEvent(window,"BX_CRM_INTERFACE_FORM_TAB_SELECTED",BX.delegate(this._onFormTabSelect,this))}else{if(this.isContanerInClientRect()){this.loadIndex()}else{BX.bind(window,"scroll",this._scrollHandler)}}},_startRequest:function(t){if(this._isRequestRunning){return false}var e={FORM_ID:this.getSetting("formID",""),PATH_TO_LEAD_SHOW:this.getSetting("pathToLeadShow",""),PATH_TO_CONTACT_SHOW:this.getSetting("pathToContactShow",""),PATH_TO_COMPANY_SHOW:this.getSetting("pathToCompanyShow",""),PATH_TO_DEAL_SHOW:this.getSetting("pathToDealShow",""),PATH_TO_QUOTE_SHOW:this.getSetting("pathToQuoteShow",""),PATH_TO_INVOICE_SHOW:this.getSetting("pathToInvoiceShow",""),PATH_TO_USER_PROFILE:this.getSetting("pathToUserProfile","")};e=BX.mergeEx(e,t);this._isRequestRunning=true;this._waiter=BX.showWait(this._container);BX.ajax({url:this._serviceUrl,method:"POST",dataType:"html",data:{ADDITIONAL_PARAMS:"active_tab="+this._tabId,ENTITY_TYPE_NAME:e.ENTITY_TYPE_NAME?e.ENTITY_TYPE_NAME:this._entityTypeName,ENTITY_ID:e.ENTITY_ID?e.ENTITY_ID:this._entityId,PARAMS:e},onsuccess:BX.delegate(this._onRequestSuccess,this),onfailure:BX.delegate(this._onRequestFailure,this)});return true},_onRequestSuccess:function(t){this._isRequestRunning=false;if(this._waiter){BX.closeWait(this._container,this._waiter);this._waiter=null}if(this._subContainer!==null){BX.insertAfter(BX.create("DIV",{html:t}),this._subContainer)}else{this._container.innerHTML=t}this._isLoaded=true;var e=this;var i=BX.findChild(this._container,{"class":"crm-entity-more"},true,true);var n=false;if(i){for(var s=0;s<i.length;s++){BX.bind(i[s],"click",this._moreButtonClickHandler)}}if(n){for(var s=0;s<n.length;s++){BX.bind(n[s],"click",this._entityButtonClickHandler)}}},_onRequestFailure:function(t){this._isRequestRunning=false;if(this._waiter){BX.closeWait(this._container,this._waiter);this._waiter=null}this._isLoaded=true},_handleMoreButtonClickHandler:function(){var t=BX.proxy_context;this._subContainer=BX.findParent(t);BX.remove(t);var e=parseInt(BX.data(t,"page"))+1;BX.data(t,"page",e);this._startRequest({BLOCK:BX.data(t,"block"),BLOCK_PAGE:e})},_handleEntityButtonClickHandler:function(t){var e=BX.proxy_context;this._subContainer=null;this._startRequest({ENTITY_ID:BX.data(e,"id"),ENTITY_TYPE_NAME:BX.data(e,"type")});t.preventDefault()},_onFormManagerCreate:function(t){if(t["name"]===this._formId){BX.removeCustomEvent(window,"CrmInterfaceFormCreated",this._formManagerHandler);this.setFormManager(t)}},_onFormTabSelect:function(t,e,i,n){if(this._formId===e&&(i===this._tabId||this._wrapper===n)){this._startRequest()}},_onWindowScroll:function(t){if(!this._isLoaded&&!this._isRequestRunning&&this.isContanerInClientRect()){BX.unbind(window,"scroll",this._scrollHandler);this._startRequest()}}};BX.CrmEntityTreeDispatcher.items={};BX.CrmEntityTreeDispatcher.create=function(t,e){var i=new BX.CrmEntityTreeDispatcher;i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.CrmLongRunningProcessState=="undefined"){BX.CrmLongRunningProcessState={intermediate:0,running:1,completed:2,stoped:3,error:4}}if(typeof BX.CrmLongRunningProcessDialog=="undefined"){BX.CrmLongRunningProcessDialog=function(){this._id="";this._settings={};this._serviceUrl="";this._params={};this._dlg=null;this._buttons={};this._summary=null;this._isShown=false;this._state=BX.CrmLongRunningProcessState.intermediate;this._cancelRequest=false;this._requestIsRunning=false};BX.CrmLongRunningProcessDialog.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"crm_long_run_proc_"+Math.random().toString().substring(2);this._settings=e?e:{};this._serviceUrl=this.getSetting("serviceUrl","");if(!BX.type.isNotEmptyString(this._serviceUrl)){throw"BX.CrmLongRunningProcess. Could not find service url."}this._action=this.getSetting("action","");if(!BX.type.isNotEmptyString(this._action)){throw"BX.CrmLongRunningProcess. Could not find action."}this._params=this.getSetting("params");if(!this._params){this._params={}}},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},setSetting:function(t,e){this._settings[t]=e},getMessage:function(t){return BX.CrmLongRunningProcessDialog.messages&&BX.CrmLongRunningProcessDialog.messages.hasOwnProperty(t)?BX.CrmLongRunningProcessDialog.messages[t]:""},getState:function(){return this._state},getServiceUrl:function(){return this._serviceUrl},getAction:function(){return this._action},getParams:function(){return this._params},show:function(){if(this._isShown){return}this._dlg=BX.PopupWindowManager.create(this._id.toLowerCase(),this._anchor,{className:"bx-crm-dialog-wrap bx-crm-dialog-long-run-proc",autoHide:false,bindOptions:{forceBindPosition:false},buttons:this._prepareDialogButtons(),closeByEsc:false,closeIcon:false,content:this._prepareDialogContent(),draggable:true,events:{onPopupClose:BX.delegate(this._onDialogClose,this)},offsetLeft:0,offsetTop:0,titleBar:this.getSetting("title","")});if(!this._dlg.isShown()){this._dlg.show()}this._isShown=this._dlg.isShown()},close:function(){if(!this._isShown){return}if(this._dlg){this._dlg.close()}this._isShown=false},start:function(){if(this._state===BX.CrmLongRunningProcessState.intermediate||this._state===BX.CrmLongRunningProcessState.stoped){this._startRequest()}},stop:function(){if(this._state===BX.CrmLongRunningProcessState.running){this._cancelRequest=true}},_prepareDialogContent:function(){this._summary=BX.create("DIV",{attrs:{className:"bx-crm-dialog-long-run-proc-summary"},text:this.getSetting("summary","")});return BX.create("DIV",{attrs:{className:"bx-crm-dialog-long-run-proc-popup"},children:[this._summary]})},_prepareDialogButtons:function(){this._buttons={};var t=this.getMessage("startButton");this._buttons["start"]=new BX.PopupWindowButton({text:t!==""?t:"Start",className:"popup-window-button-accept",events:{click:BX.delegate(this._handleStartButtonClick,this)}});var e=this.getMessage("stopButton");this._buttons["stop"]=new BX.PopupWindowButton({text:e!==""?e:"Stop",className:"popup-window-button-accept-disabled",events:{click:BX.delegate(this._handleStopButtonClick,this)}});var i=this.getMessage("closeButton");this._buttons["close"]=new BX.PopupWindowButtonLink({text:i!==""?i:"Close",className:"popup-window-button-link-cancel",events:{click:BX.delegate(this._handleCloseButtonClick,this)}});return[this._buttons["start"],this._buttons["stop"],this._buttons["close"]]},_onDialogClose:function(t){if(this._dlg){this._dlg.destroy();this._dlg=null}this._setState(BX.CrmLongRunningProcessState.intermediate);this._buttons={};this._summary=null;this._isShown=false;BX.onCustomEvent(this,"ON_CLOSE",[this])},_handleStartButtonClick:function(){this.start()},_handleStopButtonClick:function(){this.stop()},_handleCloseButtonClick:function(){if(this._state!==BX.CrmLongRunningProcessState.running){this._dlg.close()}},_lockButton:function(t,e){var i=typeof this._buttons[t]!=="undefined"?this._buttons[t]:null;if(!i){return}if(!!e){BX.removeClass(i.buttonNode,"popup-window-button-accept");BX.addClass(i.buttonNode,"popup-window-button-accept-disabled")}else{BX.removeClass(i.buttonNode,"popup-window-button-accept-disabled");BX.addClass(i.buttonNode,"popup-window-button-accept")}},_showButton:function(t,e){var i=typeof this._buttons[t]!=="undefined"?this._buttons[t]:null;if(i){i.buttonNode.style.display=!!e?"":"none"}},_setSummary:function(t){if(this._summary){this._summary.innerHTML=BX.util.htmlspecialchars(t)}},_setState:function(t){if(this._state===t){return}this._state=t;if(t===BX.CrmLongRunningProcessState.intermediate||t===BX.CrmLongRunningProcessState.stoped){this._lockButton("start",false);this._lockButton("stop",true);this._showButton("close",true)}else if(t===BX.CrmLongRunningProcessState.running){this._lockButton("start",true);this._lockButton("stop",false);this._showButton("close",false)}else if(t===BX.CrmLongRunningProcessState.completed||t===BX.CrmLongRunningProcessState.error){this._lockButton("start",true);this._lockButton("stop",true);this._showButton("close",true)}BX.onCustomEvent(this,"ON_STATE_CHANGE",[this])},_startRequest:function(){if(this._requestIsRunning){return}this._requestIsRunning=true;this._setState(BX.CrmLongRunningProcessState.running);BX.ajax({url:this._serviceUrl,method:"POST",dataType:"json",data:{ACTION:this._action,PARAMS:this._params},onsuccess:BX.delegate(this._onRequestSuccsess,this),onfailure:BX.delegate(this._onRequestFailure,this)})},_onRequestSuccsess:function(t){this._requestIsRunning=false;if(!t){this._setSummary(this.getMessage("requestError"));this._setState(BX.CrmLongRunningProcessState.error);return}if(BX.type.isNotEmptyString(t["ERROR"])){this._setState(BX.CrmLongRunningProcessState.error);this._setSummary(t["ERROR"]);return}var e=BX.type.isNotEmptyString(t["STATUS"])?t["STATUS"]:"";var i=BX.type.isNotEmptyString(t["SUMMARY"])?t["SUMMARY"]:"";if(e==="PROGRESS"){if(i!==""){this._setSummary(i)}if(this._cancelRequest){this._setState(BX.CrmLongRunningProcessState.stoped);this._cancelRequest=false}else{window.setTimeout(BX.delegate(this._startRequest,this),100)}return}if(e==="NOT_REQUIRED"||e==="COMPLETED"){this._setState(BX.CrmLongRunningProcessState.completed);if(i!==""){this._setSummary(i)}}else{this._setSummary(this.getMessage("requestError"));this._setState(BX.CrmLongRunningProcessState.error)}if(this._cancelRequest){this._cancelRequest=false}},_onRequestFailure:function(t){this._requestIsRunning=false;this._setSummary(this.getMessage("requestError"));this._setState(BX.CrmLongRunningProcessState.error)}};if(typeof BX.CrmLongRunningProcessDialog.messages=="undefined"){BX.CrmLongRunningProcessDialog.messages={}}BX.CrmLongRunningProcessDialog.items={};BX.CrmLongRunningProcessDialog.create=function(t,e){var i=new BX.CrmLongRunningProcessDialog;i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.CrmEntityType=="undefined"){BX.CrmEntityType=function(){};BX.CrmEntityType.enumeration={undefined:0,lead:1,deal:2,contact:3,company:4,invoice:5};BX.CrmEntityType.names={undefined:"",lead:"LEAD",deal:"DEAL",contact:"CONTACT",company:"COMPANY",invoice:"INVOICE",quote:"QUOTE"};BX.CrmEntityType.abbreviations={undefined:"",lead:"L",deal:"D",contact:"C",company:"CO",invoice:"I",quote:"Q"};BX.CrmEntityType.isDefined=function(t){if(!BX.type.isNumber(t)){t=parseInt(t);if(isNaN(t)){t=0}}return t>=0&&t<=5};BX.CrmEntityType.resolveName=function(t){if(!BX.type.isNumber(t)){t=parseInt(t);if(isNaN(t)){t=0}}if(t===BX.CrmEntityType.enumeration.lead){return BX.CrmEntityType.names.lead}else if(t===BX.CrmEntityType.enumeration.deal){return BX.CrmEntityType.names.deal}else if(t===BX.CrmEntityType.enumeration.contact){return BX.CrmEntityType.names.contact}else if(t===BX.CrmEntityType.enumeration.company){return BX.CrmEntityType.names.company}else if(t===BX.CrmEntityType.enumeration.invoice){return BX.CrmEntityType.names.invoice}else{return""}};BX.CrmEntityType.resolveId=function(t){t=t.toUpperCase();if(t===BX.CrmEntityType.names.lead){return this.enumeration.lead}else if(t===BX.CrmEntityType.names.deal){return this.enumeration.deal}else if(t===BX.CrmEntityType.names.contact){return this.enumeration.contact}else if(t===BX.CrmEntityType.names.company){return this.enumeration.company}else if(t===BX.CrmEntityType.names.invoice){return this.enumeration.invoice}else{return this.enumeration.undefined}};BX.CrmEntityType.resolveAbbreviation=function(t){t=t.toUpperCase();if(t===BX.CrmEntityType.names.lead){return this.abbreviations.lead}else if(t===BX.CrmEntityType.names.deal){return this.abbreviations.deal}else if(t===BX.CrmEntityType.names.contact){return this.abbreviations.contact}else if(t===BX.CrmEntityType.names.company){return this.abbreviations.company}else if(t===BX.CrmEntityType.names.invoice){return this.abbreviations.invoice}else{return this.abbreviations.undefined}};BX.CrmEntityType.verifyName=function(t){if(!BX.type.isNotEmptyString(t)){return""}t=t.toUpperCase();return this.resolveId(t)!==this.enumeration.undefined?t:""};BX.CrmEntityType.setCaptions=function(t){if(BX.type.isPlainObject(t)){this.captions=t}};BX.CrmEntityType.getCaption=function(t){var e=this.resolveName(t);return this.captions.hasOwnProperty(e)?this.captions[e]:e};BX.CrmEntityType.getCaptionByName=function(t){if(!BX.type.isNotEmptyString(t)){return""}t=t.toUpperCase();return this.captions.hasOwnProperty(t)?this.captions[t]:t};BX.CrmEntityType.prepareEntityKey=function(t,e){var i=this.resolveAbbreviation(t);return i!==""?i+"_"+e.toString():""};if(typeof BX.CrmEntityType.captions==="undefined"){BX.CrmEntityType.captions={}}if(typeof BX.CrmEntityType.categoryCaptions==="undefined"){BX.CrmEntityType.categoryCaptions={}}}if(typeof BX.CrmDuplicateManager=="undefined"){BX.CrmDuplicateManager=function(){this._id="";this._settings={};this._entityTypeName="";this._processDialogs={}};BX.CrmDuplicateManager.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"crm_dp_mgr_"+Math.random().toString().substring(2);this._settings=e?e:{};this._entityTypeName=this.getSetting("entityTypeName","");if(!BX.type.isNotEmptyString(this._entityTypeName)){throw"BX.CrmDuplicateManager. Could not find entity type name."}this._entityTypeName=this._entityTypeName.toUpperCase()},getId:function(){return this._id},getEntityTypeName:function(){return this._entityTypeName},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},setSetting:function(t,e){this._settings[t]=e},getMessage:function(t){return BX.CrmDuplicateManager.messages&&BX.CrmDuplicateManager.messages.hasOwnProperty(t)?BX.CrmDuplicateManager.messages[t]:""},rebuildIndex:function(){var t=this.getSetting("serviceUrl","");if(!BX.type.isNotEmptyString(t)){throw"BX.CrmDuplicateManager. Could not find service url."}var e=this._entityTypeName.toLowerCase().replace(/(?:^)\S/,function(t){return t.toUpperCase()});var i="rebuild"+e+"Index";var n=null;if(typeof this._processDialogs[i]!=="undefined"){n=this._processDialogs[i]}else{n=BX.CrmLongRunningProcessDialog.create(i,{serviceUrl:t,action:"REBUILD_DUPLICATE_INDEX",params:{ENTITY_TYPE_NAME:this._entityTypeName},title:this.getMessage(i+"DlgTitle"),summary:this.getMessage(i+"DlgSummary")});this._processDialogs[i]=n;BX.addCustomEvent(n,"ON_STATE_CHANGE",BX.delegate(this._onProcessStateChange,this))}n.show()},_onProcessStateChange:function(t){var e=t.getId();if(typeof this._processDialogs[e]!=="undefined"){var i=this._processDialogs[e];if(i.getState()===BX.CrmLongRunningProcessState.completed){BX.onCustomEvent(this,"ON_"+this._entityTypeName+"_INDEX_REBUILD_COMPLETE",[this])}}}};if(typeof BX.CrmDuplicateManager.messages=="undefined"){BX.CrmDuplicateManager.messages={}}BX.CrmDuplicateManager.items={};BX.CrmDuplicateManager.create=function(t,e){var i=new BX.CrmDuplicateManager;i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.CrmDupController=="undefined"){BX.CrmDupController=function(){this._id="";this._settings={};this._entityTypeName="";this._enable=true;this._groups={};this._requestIsRunning=false;this._request=null;this._searchData={};this._searchSummary=null;this._warningDialog=null;this._submits=[];this._lastSummaryGroupId="";this._lastSummaryFieldId="";this._lastSubmit=null;this._onFormSubmitHandler=BX.delegate(this._onFormSubmit,this)};BX.CrmDupController.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"crm_dp_ctrl_"+Math.random().toString().substring(2);this._settings=e?e:{};this._serviceUrl=this.getSetting("serviceUrl","");if(!BX.type.isNotEmptyString(this._serviceUrl)){throw"BX.CrmDupController. Could not find service url."}this._bind();this._entityTypeName=this.getSetting("entityTypeName","");var i=this.getSetting("groups",null);var n=null;if(i){for(var s in i){if(!i.hasOwnProperty(s)){continue}n=i[s];var r=BX.type.isNotEmptyString(n["groupType"])?n["groupType"]:"";var o=null;try{if(r==="single"){o=BX.CrmDupCtrlSingleField.create(s,n)}else if(r==="fullName"){o=BX.CrmDupCtrlFullName.create(s,n)}else if(r==="communication"){o=BX.CrmDupCtrlCommunication.create(s,n)}}catch(a){}if(o){this.addGroup(o)}}}this._afterInitialize();var l=[];for(var h in this._groups){if(!this._groups.hasOwnProperty(h)){continue}n=this._groups[h];var c=n.prepareSearchParams();if(!c){continue}c["GROUP_ID"]=h;c["HASH_CODE"]=n.getSearchHashCode();c["FIELD_ID"]=n.getDefaultSearchSummaryFieldId();l.push(c)}if(l.length>0){this._search({GROUPS:l})}},_afterInitialize:function(){},getId:function(){return this._id},getEntityTypeName:function(){return this._entityTypeName},isEnabled:function(){return this._enable},enable:function(t){this._enable=!!t},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},setSetting:function(t,e){this._settings[t]=e},addGroup:function(t){this._groups[t.getId()]=t;t.setController(this);return t},getGroup:function(t){return this._groups.hasOwnProperty(t)?this._groups[t]:null},getDuplicateData:function(){return this._searchData},hasDuplicates:function(){for(var t in this._searchData){if(!this._searchData.hasOwnProperty(t)){continue}var e=this._searchData[t];if(e.hasOwnProperty("items")&&e["items"].length>0){return true}}return false},processGroupChange:function(t,e){var i=t.getId();var n=t.prepareSearchParams();if(!n){if(typeof this._searchData[i]!=="undefined"){delete this._searchData[i];this._refreshSearchSummary(i,e.getId())}return}var s=t.getSearchHashCode();if(s!==this._getGroupSearchHashCode(i)){n["GROUP_ID"]=i;if(e){n["FIELD_ID"]=e.getId()}n["HASH_CODE"]=s;this._search({GROUPS:[n]})}},_bind:function(){var t=this.getSetting("submits",[]);if(BX.type.isArray(t)){for(var e=0;e<t.length;e++){var i=BX(t[e]);if(BX.type.isElementNode(i)){this._submits.push(i);BX.bind(i,"click",this._onFormSubmitHandler)}}}},_unbind:function(){for(var t=0;t<this._submits.length;t++){BX.unbind(this._submits[t],"click",this._onFormSubmitHandler)}},_search:function(t){if(this._requestIsRunning){this._stopSearchRequest()}t["ENTITY_TYPE_NAME"]=this._entityTypeName;this._startSearchRequest(t)},_startSearchRequest:function(t){if(this._requestIsRunning){return}BX.showWait();this._requestIsRunning=true;this._request=BX.ajax({url:this._serviceUrl,method:"POST",dataType:"json",data:{ACTION:"FIND_DUPLICATES",PARAMS:t},onsuccess:BX.delegate(this._onSearchRequestSuccsess,this),onfailure:BX.delegate(this._onSearchRequestFailure,this)})},_stopSearchRequest:function(){if(!this._requestIsRunning){return}this._requestIsRunning=false;if(this._request){this._request.abort();this._request=null}BX.closeWait()},_onSearchRequestSuccsess:function(t){BX.closeWait();this._requestIsRunning=false;if(!t){return}if(BX.type.isNotEmptyString(t["ERROR"])){return}var e="";var i="";var n=BX.type.isArray(t["GROUP_RESULTS"])?t["GROUP_RESULTS"]:[];for(var s=0;s<n.length;s++){var r=n[s];var o=typeof r["GROUP_ID"]!=="undefined"?r["GROUP_ID"]:"";if(!BX.type.isNotEmptyString(o)){return}var a=this.getGroup(o);if(!a){return}if(typeof this._searchData[o]==="undefined"){this._searchData[o]={}}var l=BX.type.isArray(r["DUPLICATES"])?r["DUPLICATES"]:[];if(l.length>0){this._searchData[o]["items"]=BX.type.isArray(r["DUPLICATES"])?r["DUPLICATES"]:[];this._searchData[o]["totalText"]=BX.type.isNotEmptyString(r["ENTITY_TOTAL_TEXT"])?r["ENTITY_TOTAL_TEXT"]:"";var h=0;if(typeof r["HASH_CODE"]!=="undefined"){h=parseInt(r["HASH_CODE"]);if(isNaN(h)){h=0}}this._searchData[o]["hash"]=h;if(BX.type.isNotEmptyString(r["FIELD_ID"])){e=o;i=r["FIELD_ID"]}}else{delete this._searchData[o]}}this._refreshSearchSummary(e,i)},_refreshSearchSummary:function(t,e){if(!BX.type.isNotEmptyString(t)){t=""}if(!BX.type.isNotEmptyString(e)){e=""}if(this.hasDuplicates()){var i=null;if(t===""||e===""){t=this._lastSummaryGroupId;e=this._lastSummaryFieldId}if(t!==""&&e!==""){var n=this.getGroup(t);if(n){i=n.getField(e)}this._lastSummaryGroupId=t;this._lastSummaryFieldId=e}this._showSearchSummary(i)}else{this._closeSearchSummary()}},_onSearchRequestFailure:function(t){BX.closeWait();this._requestIsRunning=false},_onFormSubmit:function(t){if(!this.hasDuplicates()){return true}var e=null;if(t){if(t.target){e=t.target}else if(t.srcElement){e=t.srcElement}}if(BX.type.isElementNode(e)){this._lastSubmit=e}window.setTimeout(BX.delegate(this._openWarningDialog,this),100);return BX.PreventDefault(t)},_openWarningDialog:function(){if(!this.hasDuplicates()){this._unbind();this._submitForm()}else{this._warningDialog=BX.CrmDuplicateWarningDialog.create(this._id+"_warn",{controller:this,onClose:BX.delegate(this._onWarningDialogClose,this),onCancel:BX.delegate(this._onWarningDialogCancel,this),onAccept:BX.delegate(this._onWarningDialogAccept,this)});this._warningDialog.show()}},_getGroupSearchData:function(t){return this._searchData.hasOwnProperty(t)?this._searchData[t]:null},_getGroupSearchHashCode:function(t){var e=this._getGroupSearchData(t);return e&&e.hasOwnProperty("hash")?e["hash"]:0},_showSearchSummary:function(t){this._closeSearchSummary();var e=null;if(t){e=t?t.getElementTitle():null;if(!e){e=t.getElement()}}this._searchSummary=BX.CrmDuplicateSummaryPopup.create(this._id+"_summary",{controller:this,anchor:e});this._searchSummary.show()},_isSearchSummaryShown:function(){return this._searchSummary&&this._searchSummary.isShown()},_closeSearchSummary:function(){if(this._searchSummary){this._searchSummary.close();this._searchSummary=null}},_onWarningDialogClose:function(t){if(this._warningDialog===t){this._warningDialog=null}},_onWarningDialogCancel:function(t){if(this._warningDialog===t){this._warningDialog.close()}},_onWarningDialogAccept:function(t){if(this._warningDialog===t){this._warningDialog.close();this._unbind();this._submitForm()}},_submitForm:function(){if(BX.type.isElementNode(this._lastSubmit)){this._lastSubmit.click()}else{var t=BX(this.getSetting("form",""));if(BX.type.isElementNode(t)){t.submit()}}}};BX.CrmDupController.create=function(t,e){var i=new BX.CrmDupController;i.initialize(t,e);return i}}if(typeof BX.CrmDupCtrlField=="undefined"){BX.CrmDupCtrlField=function(){this._id="";this._group=null;this._element=null;this._elementTitle=null;this._value="";this._hasFosus=false;this._elementTimeoutId=0;this._elementTimeoutHandler=BX.delegate(this._onElementTimeout,this);this._elementKeyUpHandler=BX.delegate(this._onElementKeyUp,this);this._elementFocusHandler=BX.delegate(this._onElementFocus,this);this._elementBlurHandler=BX.delegate(this._onElementBlur,this);this._initialized=false};BX.CrmDupCtrlField.prototype={initialize:function(t,e,i){if(!BX.type.isNotEmptyString(t)){throw"BX.CrmDupCtrlField. Invalid parameter 'id': is not defined."}this._id=t;if(!BX.type.isElementNode(e)){throw"BX.CrmDupCtrlField. Invalid parameter 'element': is not defined."}this._element=e;this._value=e.value;BX.bind(this._element,"keyup",this._elementKeyUpHandler);BX.bind(this._element,"focus",this._elementFocusHandler);BX.bind(this._element,"blur",this._elementBlurHandler);if(BX.type.isElementNode(i)){this._elementTitle=i}this._initialized=true},release:function(){BX.unbind(this._element,"keyup",this._elementKeyUpHandler);BX.unbind(this._element,"focus",this._elementFocusHandler);BX.unbind(this._element,"blur",this._elementBlurHandler);this._element=null;this._initialized=false},getId:function(){return this._id},getGroup:function(){return this._group},setGroup:function(t){this._group=t},hasFocus:function(){return this._hasFosus},getElement:function(){return this._element},getElementTitle:function(){return this._elementTitle},getValue:function(){return this._element.value},_onElementKeyUp:function(t){var e=t.keyCode;if(e===13||e===27||e>=37&&e<=40||e>=112&&e<=123){return}if(this._value===this._element.value){return}this._value=this._element.value;if(this._elementTimeoutId>0){window.clearTimeout(this._elementTimeoutId);this._elementTimeoutId=0}this._elementTimeoutId=window.setTimeout(this._elementTimeoutHandler,1500);if(!this._hasFosus){this._hasFosus=true}},_onElementFocus:function(t){this._hasFosus=true;if(this._group){this._group.processFieldFocusGain(this)}},_onElementBlur:function(t){if(this._elementTimeoutId>0){window.clearTimeout(this._elementTimeoutId);this._elementTimeoutId=0}this._hasFosus=false;if(this._group){this._group.processFieldFocusLoss(this)}},_onElementTimeout:function(){if(this._elementTimeoutId<=0){return}this._elementTimeoutId=0;if(this._group){this._group.processFieldDelay(this)}}};BX.CrmDupCtrlField.create=function(t,e,i){var n=new BX.CrmDupCtrlField;n.initialize(t,e,i);return n}}if(typeof BX.CrmDupCtrlFieldGroup=="undefined"){BX.CrmDupCtrlFieldGroup=function(){this._id="";this._settings={};this._controller=null;this._fields={}};BX.CrmDupCtrlFieldGroup.prototype={initialize:function(t,e){if(!BX.type.isNotEmptyString(t)){throw"BX.CrmDupCtrlFieldGroup. Invalid parameter 'id': is not defined."}this._id=t;this._settings=e?e:{};this._afterInitialize()},_afterInitialize:function(){},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},setSetting:function(t,e){this._settings[t]=e},getController:function(){return this._controller},setController:function(t){this._controller=t},addField:function(t){this._fields[t.getId()]=t;t.setGroup(this);return t},getField:function(t){return this._fields.hasOwnProperty(t)?this._fields[t]:null},getFieldValues:function(){var t=[];for(var e in this._fields){if(this._fields.hasOwnProperty(e)){var i=BX.util.trim(this._fields[e].getValue());if(i!==""){t.push(i)}}}return t},clearFields:function(){for(var t in this._fields){if(this._fields.hasOwnProperty(t)){this._fields[t].release()}}this._fields={}},getSummaryTitle:function(){return this.getSetting("groupSummaryTitle","")},prepareSearchParams:function(){return null},getSearchHashCode:function(){return 0},getDefaultSearchSummaryFieldId:function(){return""},processFieldDelay:function(t){},processFieldFocusGain:function(t){},processFieldFocusLoss:function(t){}}}if(typeof BX.CrmDupCtrlSingleField=="undefined"){BX.CrmDupCtrlSingleField=function(){BX.CrmDupCtrlSingleField.superclass.constructor.apply(this);this._paramName="";this._field=null};BX.extend(BX.CrmDupCtrlSingleField,BX.CrmDupCtrlFieldGroup);BX.CrmDupCtrlSingleField.prototype._afterInitialize=function(){this._paramName=this.getSetting("parameterName","");if(!BX.type.isNotEmptyString(this._paramName)){throw"BX.CrmDupCtrlSingleField. Could not find parameter name."}var t=BX(this.getSetting("element",null));if(BX.type.isDomNode(t)){this._field=this.addField(BX.CrmDupCtrlField.create(this._paramName,t,BX(this.getSetting("elementCaption",null))))}};BX.CrmDupCtrlSingleField.prototype.getValue=function(){return this._field?BX.util.trim(this._field.getValue()):""};BX.CrmDupCtrlSingleField.prototype.prepareSearchParams=function(){var t=this.getValue();if(t===""){return null}var e={};e[this._paramName]=t;return e};BX.CrmDupCtrlSingleField.prototype.getSearchHashCode=function(){var t=this.getValue();if(t===""){return 0}return BX.util.hashCode(t)};BX.CrmDupCtrlSingleField.prototype.getDefaultSearchSummaryFieldId=function(){return this._field?this._field.getId():""};BX.CrmDupCtrlSingleField.prototype.processFieldDelay=function(t){this._fireChangeEvent(t)};BX.CrmDupCtrlSingleField.prototype.processFieldFocusLoss=function(t){this._fireChangeEvent(t)};BX.CrmDupCtrlSingleField.prototype._fireChangeEvent=function(t){if(this._controller){this._controller.processGroupChange(this,t)}};BX.CrmDupCtrlSingleField.create=function(t,e){var i=new BX.CrmDupCtrlSingleField;i.initialize(t,e);return i}}if(typeof BX.CrmDupCtrlFullName=="undefined"){BX.CrmDupCtrlFullName=function(){BX.CrmDupCtrlFullName.superclass.constructor.apply(this);
this._nameField=null;this._secondNameField=null;this._lastNameField=null};BX.extend(BX.CrmDupCtrlFullName,BX.CrmDupCtrlFieldGroup);BX.CrmDupCtrlFullName.prototype._afterInitialize=function(){var t=BX(this.getSetting("name",null));if(BX.type.isDomNode(t)){this._nameField=this.addField(BX.CrmDupCtrlField.create("NAME",t,BX(this.getSetting("nameCaption",null))))}t=BX(this.getSetting("secondName",null));if(BX.type.isDomNode(t)){this._secondNameField=this.addField(BX.CrmDupCtrlField.create("SECOND_NAME",t,BX(this.getSetting("secondNameCaption",null))))}t=BX(this.getSetting("lastName",null));if(BX.type.isDomNode(t)){this._lastNameField=this.addField(BX.CrmDupCtrlField.create("LAST_NAME",t,BX(this.getSetting("lastNameCaption",null))))}};BX.CrmDupCtrlFullName.prototype.getName=function(){return this._nameField?BX.util.trim(this._nameField.getValue()):""};BX.CrmDupCtrlFullName.prototype.getSecondName=function(){return this._secondNameField?BX.util.trim(this._secondNameField.getValue()):""};BX.CrmDupCtrlFullName.prototype.getLastName=function(){return this._lastNameField?BX.util.trim(this._lastNameField.getValue()):""};BX.CrmDupCtrlFullName.prototype.prepareSearchParams=function(){var t=this.getLastName();if(t===""){return null}var e={LAST_NAME:t};var i=this.getName();if(i!==""){e["NAME"]=i}var n=this.getSecondName();if(n!==""){e["SECOND_NAME"]=n}return e};BX.CrmDupCtrlFullName.prototype.getSearchHashCode=function(){var t=this.getLastName();if(t===""){return 0}var e=t.toLowerCase();var i=this.getName();if(i!==""){e+="$"+i.toLowerCase()}var n=this.getSecondName();if(n!==""){e+="$"+n.toLowerCase()}return BX.util.hashCode(e)};BX.CrmDupCtrlFullName.prototype.getDefaultSearchSummaryFieldId=function(){return this._lastNameField?this._lastNameField.getId():""};BX.CrmDupCtrlFullName.prototype.processFieldDelay=function(t){this._fireChangeEvent(t)};BX.CrmDupCtrlFullName.prototype.processFieldFocusLoss=function(t){this._fireChangeEvent(t)};BX.CrmDupCtrlFullName.prototype._fireChangeEvent=function(t){if(this._controller){this._controller.processGroupChange(this,t)}};BX.CrmDupCtrlFullName.create=function(t,e){var i=new BX.CrmDupCtrlFullName;i.initialize(t,e);return i}}if(typeof BX.CrmDupCtrlCommunication=="undefined"){BX.CrmDupCtrlCommunication=function(){this._communicationType="";this._container=null;this._editorCreateItemHandler=BX.delegate(this.onCommunicaionEditorItemCreate,this);this._editorDeleteItemHandler=BX.delegate(this.onCommunicaionEditorItemDelete,this);this._firstField=null;this._lastField=null;BX.CrmDupCtrlCommunication.superclass.constructor.apply(this)};BX.extend(BX.CrmDupCtrlCommunication,BX.CrmDupCtrlFieldGroup);BX.CrmDupCtrlCommunication.prototype._afterInitialize=function(){this._communicationType=this.getSetting("communicationType","");if(!BX.type.isNotEmptyString(this._communicationType)){throw"BX.CrmDupCtrlCommunication. Could not find communication type."}this._editorId=this.getSetting("editorId","");if(!BX.type.isNotEmptyString(this._editorId)){throw"BX.CrmDupCtrlCommunication. Could not find editor Id."}this._container=this.getSetting("container",null);if(BX.type.isNotEmptyString(this._container)){this._container=BX(this._container)}if(!BX.type.isElementNode(this._container)){this._container=BX(this._editorId)}if(!BX.type.isElementNode(this._container)){throw"BX.CrmDupCtrlCommunication. Could not find container."}BX.addCustomEvent(window,"CrmFieldMultiEditorItemCreated",this._editorCreateItemHandler);BX.addCustomEvent(window,"CrmFieldMultiEditorItemDeleted",this._editorDeleteItemHandler);this._initializeFields()};BX.CrmDupCtrlCommunication.prototype._initializeFields=function(){this.clearFields();var t=BX(this.getSetting("editorCaption",null));var e=BX.findChildren(this._container,{tagName:"input",className:"bx-crm-edit-input"},true);var i=e.length;for(var n=0;n<i;n++){var s=this.addField(BX.CrmDupCtrlField.create("VALUE_"+(n+1).toString(),e[n],t));if(n===0){this._firstField=s}if(n===i-1){this._lastField=s}}};BX.CrmDupCtrlCommunication.prototype.prepareSearchParams=function(){var t=this.getFieldValues();var e=t.length;if(e===0){return null}var i={};if(this._communicationType!=="PHONE"){i[this._communicationType]=t;return i}var n=[];for(var s=0;s<e;s++){var r=t[s];if(r.length>=5){n.push(r)}}if(n.length===0){return null}i["PHONE"]=n;return i};BX.CrmDupCtrlCommunication.prototype.getSearchHashCode=function(){var t=this.getFieldValues();return t.length>0?BX.util.hashCode(t.join("$")):0};BX.CrmDupCtrlCommunication.prototype.getDefaultSearchSummaryFieldId=function(){return this._firstField?this._firstField.getId():""};BX.CrmDupCtrlCommunication.prototype.processFieldDelay=function(t){if(this._controller){this._controller.processGroupChange(this,t)}};BX.CrmDupCtrlCommunication.prototype.processFieldFocusLoss=function(t){if(this._controller){this._controller.processGroupChange(this,t)}};BX.CrmDupCtrlCommunication.prototype.onCommunicaionEditorItemCreate=function(t,e){if(this._editorId!==e){return}this._initializeFields()};BX.CrmDupCtrlCommunication.prototype.onCommunicaionEditorItemDelete=function(t,e){if(this._editorId!==e){return}this._initializeFields();if(this._controller){this._controller.processGroupChange(this,this._lastField)}};BX.CrmDupCtrlCommunication.create=function(t,e){var i=new BX.CrmDupCtrlCommunication;i.initialize(t,e);return i}}if(typeof BX.CrmDuplicateSummaryItem=="undefined"){BX.CrmDuplicateSummaryItem=function(){this._id="";this._settings={};this._groupId="";this._controller=null;this._container=null};BX.CrmDuplicateSummaryItem.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._controller=this.getSetting("controller",null);if(!this._controller){throw"BX.CrmDuplicateListPopup. Parameter 'controller' is not found."}this._container=this.getSetting("container",null);if(!this._controller){throw"BX.CrmDuplicateSummaryItem. Parameter 'container' is not found."}this._link=this.getSetting("link",null);if(!this._link){throw"BX.CrmDuplicateSummaryItem. Parameter 'link' is not found."}BX.bind(this._link,"click",BX.delegate(this._onLinkClick,this));this._groupId=this.getSetting("groupId",null)},getSetting:function(t,e){return typeof this._settings[t]!="undefined"?this._settings[t]:e},setSetting:function(t,e){this._settings[t]=e},_onLinkClick:function(t){if(this._groupId!==""){var e=BX.CrmDuplicateListPopup.create(this._id,{controller:this._controller,groupId:this._groupId});e.show()}}};BX.CrmDuplicateSummaryItem.create=function(t,e){var i=new BX.CrmDuplicateSummaryItem;i.initialize(t,e);return i}}if(typeof BX.CrmDuplicateSummaryPopup=="undefined"){BX.CrmDuplicateSummaryPopup=function(){this._id="";this._settings={};this._controller=null;this._items={};this._popup=null};BX.CrmDuplicateSummaryPopup.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._controller=this.getSetting("controller",null);if(!this._controller){throw"BX.CrmDuplicateSummaryPopup. Parameter 'controller' is not found."}},getSetting:function(t,e){return typeof this._settings[t]!="undefined"?this._settings[t]:e},setSetting:function(t,e){this._settings[t]=e},getId:function(){return this._id},show:function(){if(this.isShown()){return}var t=this.getId();if(BX.CrmDuplicateSummaryPopup.windows[t]){BX.CrmDuplicateSummaryPopup.windows[t].destroy()}var e=this.getSetting("anchor",null);this._popup=new BX.PopupWindow(t,e,{autoHide:false,draggable:true,bindOptions:{forceBindPosition:false},closeByEsc:false,events:{onPopupClose:BX.delegate(this._onPopupClose,this),onPopupDestroy:BX.delegate(this._onPopupDestroy,this)},content:this._prepareContent(),className:"crm-tip-popup",angle:{position:"right"},lightShadow:true});BX.CrmDuplicateSummaryPopup.windows[t]=this._popup;this._popup.show();var i=BX.pos(e);var n=BX.pos(this._popup.angle.element);var s=BX.pos(this._popup.popupContainer);var r=this._popup.popupContainer.offsetWidth+n.width+5;var o=i.height+(n.height+this._popup.angle.element.offsetTop)/2;if(r<s.left&&o<s.top){this._popup.move(-r,-o)}},close:function(){if(!(this._popup&&this._popup.isShown())){return}this._popup.close()},isShown:function(){return this._popup&&this._popup.isShown()},getMessage:function(t){return BX.CrmDuplicateSummaryPopup.messages&&BX.CrmDuplicateSummaryPopup.messages.hasOwnProperty(t)?BX.CrmDuplicateSummaryPopup.messages[t]:""},_prepareContent:function(){this._items={};var t={};var e=this._controller.getDuplicateData();var i;for(i in e){if(!e.hasOwnProperty(i)){continue}var n=e[i];if(BX.type.isNotEmptyString(n["totalText"])){t[i]={total:n["totalText"]}}}var s=BX.create("DIV",{attrs:{className:"crm-tip-popup-cont"}});var r=false;for(i in t){if(!t.hasOwnProperty(i)){continue}var o=this._controller.getGroup(i);if(!o){continue}var a=BX.create("SPAN",{attrs:{className:"crm-tip-popup-link"},text:t[i]["total"]});var l=BX.create("DIV",{attrs:{className:"crm-tip-popup-item"}});if(!r){l.appendChild(BX.create("SPAN",{text:this.getMessage("title")+" "}));r=true}l.appendChild(a);l.appendChild(BX.create("SPAN",{text:" "+o.getSummaryTitle()}));s.appendChild(l);this._items[i]=BX.CrmDuplicateSummaryItem.create(i,{controller:this._controller,container:l,link:a,groupId:i})}return s},_onPopupClose:function(){if(this._popup){this._popup.destroy()}},_onPopupDestroy:function(){if(this._popup){this._popup=null}}};BX.CrmDuplicateSummaryPopup.windows={};if(typeof BX.CrmDuplicateSummaryPopup.messages=="undefined"){BX.CrmDuplicateSummaryPopup.messages={}}BX.CrmDuplicateSummaryPopup.create=function(t,e){var i=new BX.CrmDuplicateSummaryPopup;i.initialize(t,e);return i}}if(typeof BX.CrmDuplicateWarningDialog=="undefined"){BX.CrmDuplicateWarningDialog=function(){this._id="";this._settings={};this._controller=null;this._popup=null;this._contentWrapper=null};BX.CrmDuplicateWarningDialog.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._controller=this.getSetting("controller",null);if(!this._controller){throw"BX.CrmDuplicateWarningDialog. Parameter 'controller' is not found."}},getSetting:function(t,e){return typeof this._settings[t]!="undefined"?this._settings[t]:e},setSetting:function(t,e){this._settings[t]=e},getId:function(){return this._id},show:function(){if(this.isShown()){return}var t=this.getId();if(BX.CrmDuplicateWarningDialog.windows[t]){BX.CrmDuplicateWarningDialog.windows[t].destroy()}var e=this.getSetting("anchor",null);this._popup=new BX.PopupWindow(t,e,{autoHide:false,draggable:true,bindOptions:{forceBindPosition:false},closeByEsc:true,closeIcon:{marginRight:"4px",marginTop:"9px"},titleBar:this.getMessage("title"),events:{onPopupShow:BX.delegate(this._onPopupShow,this),onPopupClose:BX.delegate(this._onPopupClose,this),onPopupDestroy:BX.delegate(this._onPopupDestroy,this)},content:this._prepareContent(),className:"crm-tip-popup",lightShadow:true,buttons:[new BX.PopupWindowButton({text:this.getMessage("acceptButtonTitle"),className:"popup-window-button-create",events:{click:BX.delegate(this._onAcceptButtonClick,this)}}),new BX.PopupWindowButtonLink({text:this.getMessage("cancelButtonTitle"),className:"webform-button-link-cancel",events:{click:BX.delegate(this._onCancelButtonClick,this)}})]});BX.CrmDuplicateWarningDialog.windows[t]=this._popup;this._popup.show();this._contentWrapper.tabIndex="1";this._contentWrapper.focus()},close:function(){if(!(this._popup&&this._popup.isShown())){return}this._popup.close()},isShown:function(){return this._popup&&this._popup.isShown()},getMessage:function(t){return BX.CrmDuplicateWarningDialog.messages&&BX.CrmDuplicateWarningDialog.messages.hasOwnProperty(t)?BX.CrmDuplicateWarningDialog.messages[t]:""},_prepareContent:function(){this._contentWrapper=BX.CrmDuplicateRenderer.prepareListContent(this._controller.getDuplicateData());return this._contentWrapper},_onCancelButtonClick:function(){var t=this.getSetting("onCancel",null);if(BX.type.isFunction(t)){t(this)}},_onAcceptButtonClick:function(){var t=this.getSetting("onAccept",null);if(BX.type.isFunction(t)){t(this)}},_onPopupShow:function(){if(!this._contentWrapper){return}var t=BX.findChildren(this._contentWrapper,{className:"crm-info-popup-user"},true);if(t){for(var e=0;e<t.length;e++){var i=t[e];BX.tooltip(i.getAttribute("data-userid"),i,"")}}BX.bind(this._contentWrapper,"keyup",BX.delegate(this._onKeyUp,this))},_onPopupClose:function(){var t=this.getSetting("onClose",null);if(BX.type.isFunction(t)){t(this)}if(this._popup){this._popup.destroy()}},_onPopupDestroy:function(){if(this._popup){this._popup=null}},_onKeyUp:function(t){var e=t.keyCode;if(e===13){var i=this.getSetting("onAccept",null);if(BX.type.isFunction(i)){i(this)}}}};BX.CrmDuplicateWarningDialog.windows={};if(typeof BX.CrmDuplicateWarningDialog.messages==="undefined"){BX.CrmDuplicateWarningDialog.messages={}}BX.CrmDuplicateWarningDialog.create=function(t,e){var i=new BX.CrmDuplicateWarningDialog;i.initialize(t,e);return i}}if(typeof BX.CrmDuplicateListPopup==="undefined"){BX.CrmDuplicateListPopup=function(){this._id="";this._settings={};this._controller=null;this._groupId="";this._popup=null;this._contentWrapper=null};BX.CrmDuplicateListPopup.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._controller=this.getSetting("controller",null);if(!this._controller){throw"BX.CrmDuplicateListPopup. Parameter 'controller' is not found."}this._groupId=this.getSetting("groupId",null)},getSetting:function(t,e){return typeof this._settings[t]!="undefined"?this._settings[t]:e},setSetting:function(t,e){this._settings[t]=e},getId:function(){return this._id},show:function(){if(this.isShown()){return}var t=this.getId();if(BX.CrmDuplicateListPopup.windows[t]){BX.CrmDuplicateListPopup.windows[t].destroy()}var e=this.getSetting("anchor",null);this._popup=new BX.PopupWindow(t,e,{autoHide:true,draggable:false,bindOptions:{forceBindPosition:false},closeByEsc:true,closeIcon:{marginRight:"-2px",marginTop:"3px"},events:{onPopupShow:BX.delegate(this._onPopupShow,this),onPopupClose:BX.delegate(this._onPopupClose,this),onPopupDestroy:BX.delegate(this._onPopupDestroy,this)},content:this._prepareContent(),lightShadow:true,className:"crm-tip-popup"});BX.CrmDuplicateListPopup.windows[t]=this._popup;this._popup.show()},close:function(){if(!(this._popup&&this._popup.isShown())){return}this._popup.close()},isShown:function(){return this._popup&&this._popup.isShown()},getMessage:function(t){return BX.CrmDuplicateListPopup.messages&&BX.CrmDuplicateListPopup.messages.hasOwnProperty(t)?BX.CrmDuplicateListPopup.messages[t]:""},_prepareContent:function(){this._contentWrapper=BX.CrmDuplicateRenderer.prepareListContent(this._controller.getDuplicateData(),{groupId:this._groupId,classes:["crm-cont-info-popup-light"]});return this._contentWrapper},_onPopupShow:function(){if(!this._contentWrapper){return}var t=BX.findChildren(this._contentWrapper,{className:"crm-info-popup-user"},true);if(t){for(var e=0;e<t.length;e++){var i=t[e];BX.tooltip(i.getAttribute("data-userid"),i,"")}}},_onPopupClose:function(){var t=this.getSetting("onClose",null);if(BX.type.isFunction(t)){t(this)}if(this._popup){this._popup.destroy()}},_onPopupDestroy:function(){if(this._popup){this._popup=null}}};BX.CrmDuplicateListPopup.windows={};if(typeof BX.CrmDuplicateListPopup.messages=="undefined"){BX.CrmDuplicateListPopup.messages={}}BX.CrmDuplicateListPopup.create=function(t,e){var i=new BX.CrmDuplicateListPopup;i.initialize(t,e);return i}}if(typeof BX.CrmDuplicateRenderer==="undefined"){BX.CrmDuplicateRenderer=function(){};BX.CrmDuplicateRenderer._onCommunicationBlockClick=function(t){var e=null;if(t){if(t.target){e=t.target}else if(t.srcElement){e=t.srcElement}}if(BX.type.isElementNode(e)){if(BX.hasClass(e,"crm-info-popup-block-main")){BX.removeClass(e,"crm-info-popup-block-main")}var i=BX.findParent(e,{className:"crm-info-popup-block"});if(BX.type.isElementNode(i)&&!BX.hasClass(i,"crm-info-popup-block-open")){BX.addClass(i,"crm-info-popup-block-open")}BX.unbind(e,"click",BX.CrmDuplicateRenderer._onCommunicationBlockClickHandler)}};BX.CrmDuplicateRenderer._onCommunicationBlockClickHandler=BX.delegate(BX.CrmDuplicateRenderer._onCommunicationBlockClick,BX.CrmDuplicateRenderer);BX.CrmDuplicateRenderer._prepareCommunications=function(t){if(!BX.type.isArray(t)||t.length===0){return null}var e=t.length;if(e===1){return BX.util.htmlspecialchars(t[0])}var i=BX.create("DIV",{attrs:{className:"crm-info-popup-block"}});var n=BX.create("DIV",{attrs:{className:"crm-info-popup-block-main"},text:t[0]});i.appendChild(n);BX.bind(n,"click",this._onCommunicationBlockClickHandler);var s=BX.create("DIV",{attrs:{className:"crm-info-popup-block-inner"}});for(var r=1;r<e;r++){s.appendChild(BX.create("DIV",{text:t[r]}))}i.appendChild(s);return i};BX.CrmDuplicateRenderer.prepareListContent=function(t,e){if(!e){e={}}var i=BX.type.isNotEmptyString(e["groupId"])?e["groupId"]:"";var n={};for(var s in t){if(!t.hasOwnProperty(s)){continue}if(i!==""&&i!==s){continue}var r=t[s];var o=BX.type.isArray(r["items"])?r["items"]:[];var a=o.length;for(var l=0;l<a;l++){var h=o[l];var c=BX.type.isArray(h["ENTITIES"])?h["ENTITIES"]:[];var u=c.length;for(var p=0;p<u;p++){var m=c[p];var d=BX.type.isNotEmptyString(m["ENTITY_TYPE_ID"])?parseInt(m["ENTITY_TYPE_ID"]):0;if(!BX.CrmEntityType.isDefined(d)){continue}var f=BX.CrmEntityType.resolveName(d);if(typeof n[f]==="undefined"){n[f]=[m]}else{var _=BX.type.isNotEmptyString(m["ENTITY_ID"])?parseInt(m["ENTITY_ID"]):0;var g=false;for(var C=0;C<n[f].length;C++){var B=n[f][C];var y=BX.type.isNotEmptyString(B["ENTITY_ID"])?parseInt(B["ENTITY_ID"]):0;if(y===_){g=true;break}}if(!g){n[f].push(m)}}}}}var X=BX.create("DIV",{attrs:{className:"crm-cont-info-popup"}});var S=typeof e["classes"]!=="undefined"?e["classes"]:null;if(BX.type.isArray(S)){for(var v=0;v<S.length;v++){BX.addClass(X,S[v])}}var E=BX.create("TABLE",{attrs:{className:"crm-cont-info-table"}});X.appendChild(E);var N=false;var D=false;for(var I in n){if(!n.hasOwnProperty(I)){continue}var w=E.insertRow(-1);w.className="crm-cont-info-table-title";var P=w.insertCell(-1);P.colspan=4;P.innerHTML=BX.util.htmlspecialchars(BX.CrmEntityType.categoryCaptions[I]);var T=n[I];var b=T.length;for(var L=0;L<b;L++){var R=T[L];var O=E.insertRow(-1);var M=O.insertCell(-1);if(BX.type.isNotEmptyString(R["URL"])){M.appendChild(BX.create("A",{attrs:{href:R["URL"],target:"_blank"},text:BX.type.isNotEmptyString(R["TITLE"])?R["TITLE"]:"[Untitled]"}))}else{M.innerHTML=BX.type.isNotEmptyString(R["TITLE"])?BX.util.htmlspecialchars(R["TITLE"]):"[Untitled]"}var F=false;var A=O.insertCell(-1);var k=BX.type.isArray(R["EMAIL"])?this._prepareCommunications(R["EMAIL"]):null;if(BX.type.isElementNode(k)){A.appendChild(k);F=true}else if(BX.type.isNotEmptyString(k)){A.innerHTML=k;F=true}else if(!N){N=true}var U=false;var x=O.insertCell(-1);x.className="crm-cont-info-table-tel";var H=BX.type.isArray(R["PHONE"])?this._prepareCommunications(R["PHONE"]):null;if(BX.type.isElementNode(H)){x.appendChild(H);U=true}else if(BX.type.isNotEmptyString(H)){x.innerHTML=H;U=true}else if(!N){N=true}if(F&&U&&!D){D=true}var q=O.insertCell(-1);var z=BX.type.isNotEmptyString(R["RESPONSIBLE_ID"])?parseInt(R["RESPONSIBLE_ID"]):0;if(z>0){var W=BX.create("DIV",{attrs:{className:"crm-info-popup-user"}});q.appendChild(W);W.className="crm-info-popup-user";W.setAttribute("data-userid",z.toString());var j={};if(BX.type.isNotEmptyString(R["RESPONSIBLE_PHOTO_URL"])){j["background"]="url("+R["RESPONSIBLE_PHOTO_URL"]+") repeat scroll center center"}W.appendChild(BX.create("SPAN",{attrs:{className:"crm-info-popup-user-img"},style:j}));W.appendChild(BX.create("A",{attrs:{target:"_blank",href:BX.type.isNotEmptyString(R["RESPONSIBLE_URL"])?R["RESPONSIBLE_URL"]:"#",className:"crm-info-popup-user-name"},text:BX.type.isNotEmptyString(R["RESPONSIBLE_FULL_NAME"])?R["RESPONSIBLE_FULL_NAME"]:"["+z+"]"}))}}}if(!D){BX.addClass(E,"crm-cont-info-table-empty")}return X}}if(typeof BX.NotificationPopup=="undefined"){BX.NotificationPopup=function(){this._id="";this._settings={};this._popup=null;this._contentWrapper=null;this._title="";this._timeout=3e3;this._timeoutId=null;this._messages=[]};BX.NotificationPopup.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._messages=this.getSetting("messages",null);if(!BX.type.isArray(this._messages)||this._messages.length===0){throw"BX.NotificationPopup. Parameter 'messages' is not defined or empty."}var i=parseInt(this.getSetting("timeout",3e3));if(isNaN(i)||i<=0){i=3e3}this._timeout=i},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},setSetting:function(t,e){this._settings[t]=e},getId:function(){return this._id},show:function(){if(this.isShown()){return}var t=this.getId();if(BX.NotificationPopup.windows[t]){BX.NotificationPopup.windows[t].destroy()}this._popup=new BX.PopupWindow(t,null,{autoHide:true,draggable:false,zIndex:10200,className:"bx-notification-popup",closeByEsc:true,events:{onPopupClose:BX.delegate(this.onPopupClose,this),onPopupDestroy:BX.delegate(this.onPopupDestroy,this)},content:this.prepareContent()});BX.NotificationPopup.windows[t]=this._popup;this._popup.show();this._timeoutId=setTimeout(BX.delegate(this.close,this),this._timeout);BX.bind(this._contentWrapper,"mouseover",BX.delegate(this._onMouseOver,this));BX.bind(this._contentWrapper,"mouseout",BX.delegate(this._onMouseOut,this))},_onMouseOver:function(t){if(this._timeoutId!==null){clearTimeout(this._timeoutId)}},_onMouseOut:function(t){this._timeoutId=setTimeout(BX.delegate(this.close,this),this._timeout)},close:function(){if(!(this._popup&&this._popup.isShown())){return}this._popup.close()},isShown:function(){return this._popup&&this._popup.isShown()},prepareContent:function(){this._contentWrapper=BX.create("DIV",{attrs:{className:"bx-notification"}});var t=this.getSetting("align","");if(t==="justify"){BX.addClass(this._contentWrapper,"bx-notification-content-justify")}this._contentWrapper.appendChild(BX.create("SPAN",{attrs:{className:"bx-notification-aligner"}}));for(var e=0;e<this._messages.length;e++){this._contentWrapper.appendChild(BX.create("SPAN",{props:{className:"bx-notification-text"},text:this._messages[e]}))}this._contentWrapper.appendChild(BX.create("DIV",{props:{className:"bx-notification-footer"}}));return this._contentWrapper},onPopupClose:function(){if(this._popup){this._popup.destroy()}},onPopupDestroy:function(){if(this._popup){this._popup=null}if(this._contentWrapper){this._contentWrapper=null}}};BX.NotificationPopup.windows={};BX.NotificationPopup.create=function(t,e){var i=new BX.NotificationPopup;i.initialize(t,e);return i};BX.NotificationPopup.show=function(t,e){this.create(t,e).show()}}if(typeof BX.CrmInterfaceMode==="undefined"){BX.CrmInterfaceMode={edit:1,view:2}}if(typeof BX.GridAjaxLoader==="undefined"){BX.GridAjaxLoader=function(){this._id="";this._settings={};this._url="";this._method="";this._data={};this._dataType="html";this._ajaxId="";this._ajaxInsertHandler=BX.delegate(this._onAjaxInsert,this)};BX.GridAjaxLoader.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._url=this.getSetting("url","");this._method=this.getSetting("method","GET");this._data=this.getSetting("data",{});this._dataType=this.getSetting("dataType","html");this._ajaxId=this.getSetting("ajaxId","");this._urlAjaxIdRegex=/bxajaxid\s*=\s*([a-z0-9]+)/i;this._urlPageNumRegexes=[/(PAGEN_[0-9]+)\s*=\s*([0-9]+)/i,/(page)\s*=\s*(-?[0-9]+)/i];BX.addCustomEvent(window,"onAjaxInsertToNode",this._ajaxInsertHandler)},release:function(){BX.removeCustomEvent(window,"onAjaxInsertToNode",this._ajaxInsertHandler)},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getId:function(){return this._id},reload:function(t,e){if(!BX.type.isNotEmptyString(t)){t=this._url}t=BX.util.add_url_param(t,{bxajaxid:this._ajaxId});var i={url:t,dataType:this._dataType};if(this._method==="POST"){i["method"]="POST";i["data"]=this._data}else{i["method"]="GET"}if(BX.type.isFunction(e)){i["onsuccess"]=e}BX.ajax(i)},loadPage:function(t,e){var i={bxajaxid:this._ajaxId};i[t]=e;var n={url:BX.util.add_url_param(this._url,i),dataType:this._dataType};if(this._method==="POST"){n["method"]="POST";n["data"]=this._data}else{n["method"]="GET"}n["onsuccess"]=BX.delegate(this._onPageLoadSuccess,this);BX.ajax(n)},setupFormAction:function(t,e){if(!BX.type.isNotEmptyString(e)){e=this._url}e=BX.util.add_url_param(e,{bxajaxid:this._ajaxId});t.action=e},setupForm:function(t,e){this.setupFormAction(t,e);BX.util.addObjectToForm(this._data,t)},_onAjaxInsert:function(t){if(typeof t.eventArgs==="undefined"){return}var e=this._urlAjaxIdRegex.exec(t.url);if(BX.type.isArray(e)&&e.length>1&&e[1]===this._ajaxId){var i=this._urlPageNumRegexes.length;for(var n=0;n<i;n++){e=this._urlPageNumRegexes[n].exec(t.url);if(!(BX.type.isArray(e)&&e.length>2)){continue}this.loadPage(e[1],e[2]);t.eventArgs.cancel=true;return}}},_onPageLoadSuccess:function(t){var e=BX("comp_"+this._ajaxId);if(e){e.innerHTML=t}}};BX.GridAjaxLoader.items={};BX.GridAjaxLoader.create=function(t,e){var i=new BX.GridAjaxLoader;i.initialize(t,e);this.items[t]=i;return i};BX.GridAjaxLoader.remove=function(t){if(typeof this.items[t]==="undefined"){return}this.items[t].release();delete this.items[t]}}if(typeof BX.AddressFormatSelector==="undefined"){BX.AddressFormatSelector=function(){this._id="";this._settings={};this._controlPrefix="";this._descrContainer=null;this._typeInfos={}};BX.AddressFormatSelector.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._controlPrefix=this.getSetting("controlPrefix");this._typeInfos=this.getSetting("typeInfos",{});for(var i in this._typeInfos){if(!this._typeInfos.hasOwnProperty(i)){continue}var n=BX(this._controlPrefix+i.toLowerCase());if(n){BX.bind(n,"change",BX.delegate(this._onControlChange,this))}}this._descrContainer=BX(this.getSetting("descrContainerId"))},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},_onControlChange:function(t){if(!t){t=window.event}var e=BX.getEventTarget(t);if(e&&BX.type.isNotEmptyString(this._typeInfos[e.value])&&this._descrContainer){this._descrContainer.innerHTML=this._typeInfos[e.value]}}};BX.AddressFormatSelector.create=function(t,e){var i=new BX.AddressFormatSelector;i.initialize(t,e);return i}}if(typeof BX.CrmLongRunningProcessManager=="undefined"){BX.CrmLongRunningProcessManager=function(){this._id="";this._settings={};this._serviceUrl="";this._actionName="";this._dialog=null};BX.CrmLongRunningProcessManager.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"crm_lrp_mgr_"+Math.random().toString().substring(2);this._settings=e?e:{};this._serviceUrl=this.getSetting("serviceUrl","");if(!BX.type.isNotEmptyString(this._serviceUrl)){throw"BX.CrmLongRunningProcessManager. Could not find 'serviceUrl' parameter in settings."}this._actionName=this.getSetting("actionName","");if(!BX.type.isNotEmptyString(this._actionName)){throw"BX.CrmLongRunningProcessManager. Could not find 'actionName' parameter in settings."}},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},setSetting:function(t,e){this._settings[t]=e},getMessage:function(t){var e=BX.CrmLongRunningProcessManager.messages;return e.hasOwnProperty(t)?e[t]:t},getServiceUrl:function(){return this._serviceUrl},getActionName:function(){return this._actionName},run:function(){if(!this._dialog){var t=this.getSetting("dialogTitle",this.getMessage("dialogTitle"));var e=this.getSetting("dialogSummary",this.getMessage("dialogSummary"));this._dialog=BX.CrmLongRunningProcessDialog.create(this.getId(),{serviceUrl:this.getServiceUrl(),action:this.getActionName(),title:t,summary:e})}BX.addCustomEvent(this._dialog,"ON_STATE_CHANGE",BX.delegate(this._onProcessStateChange,this));this._dialog.show()},_onProcessStateChange:function(t){if(t===this._dialog){if(this._dialog.getState()===BX.CrmLongRunningProcessState.completed){BX.onCustomEvent(this,"ON_LONG_RUNNING_PROCESS_COMPLETE",[this])}}}};if(typeof BX.CrmLongRunningProcessManager.messages=="undefined"){BX.CrmLongRunningProcessManager.messages={}}BX.CrmLongRunningProcessManager.items={};BX.CrmLongRunningProcessManager.create=function(t,e){var i=new BX.CrmLongRunningProcessManager;i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.CrmLongRunningProcessPanel==="undefined"){BX.CrmLongRunningProcessPanel=function(){this._id="";this._settings={};this._prefix="";this._hasLayout=false;this._active=false;this._container=null;this._wrapper=null;this._link=null;this._manager=null;this._clickHandler=BX.delegate(this.onClick,this);this._processCompleteHandler=BX.delegate(this.onProcessComplete,this)};BX.CrmLongRunningProcessPanel.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._container=BX(this.getSetting("containerId"));if(!this._container){throw"CrmLongRunningProcessPanel: Could not find container."}this._active=!!this.getSetting("active",false);this._prefix=this.getSetting("prefix");this._message=this.getSetting("message");this._manager=BX.CrmLongRunningProcessManager.create(this._id,this.getSetting("manager"))},layout:function(){if(this._hasLayout){return}this._wrapper=BX.create("DIV",{props:{className:"crm-view-message"}});this._container.appendChild(this._wrapper);if(!this._active){this._wrapper.style.display="none"}var t=(this._prefix!==""?this._prefix:this._id)+"_link";var e=this._message.replace(/#ID#/gi,t).replace(/#URL#/gi,"#");this._wrapper.appendChild(BX.create("SPAN",{html:e}));this._link=BX(t);if(this._link){BX.bind(this._link,"click",this._clickHandler)}this._hasLayout=true},cleanLayout:function(){if(!this._hasLayout){return}if(this._link){BX.unbind(this._link,"click",this._clickHandler);this._link=null}BX.cleanNode(this._wrapper,true);this._wrapper=null;this._hasLayout=false},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},isActive:function(){return this._active},setActive:function(t){t=!!t;if(this._active===t){return}this._active=t;this._wrapper.style.display=t?"":"none"},onClick:function(t){BX.addCustomEvent(this._manager,"ON_LONG_RUNNING_PROCESS_COMPLETE",this._processCompleteHandler);this._manager.run();return BX.PreventDefault(t)},onProcessComplete:function(t){if(t!==this._manager){return}BX.removeCustomEvent(this._manager,"ON_LONG_RUNNING_PROCESS_COMPLETE",this._processCompleteHandler);this.setActive(false)}};BX.CrmLongRunningProcessPanel.create=function(t,e){var i=new BX.CrmLongRunningProcessPanel;i.initialize(t,e);return i}}if(typeof BX.InterfaceFilterFieldInfoProvider==="undefined"){BX.InterfaceFilterFieldInfoProvider=function(){this._id="";this._settings={};this._infos=null;this._setFildsHandler=BX.delegate(this.onSetFilterFields,this);this._getFildsHandler=BX.delegate(this.onGetFilterFields,this)};BX.InterfaceFilterFieldInfoProvider.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._infos=this.getSetting("infos",null);BX.onCustomEvent(window,"InterfaceFilterFieldInfoProviderCreate",[this])},getId:function(){return this._id},getSetting:function(t,e){return typeof this._settings[t]!="undefined"?this._settings[t]:e},registerFilter:function(t){BX.addCustomEvent(t,"AFTER_SET_FILTER_FIELDS",this._setFildsHandler);BX.addCustomEvent(t,"AFTER_GET_FILTER_FIELDS",this._getFildsHandler)},getFieldInfos:function(){return this._infos},onSetFilterFields:function(t,e,i){var n=this._infos;if(!BX.type.isArray(n)){return}var s=e.name.indexOf("flt_settings")===0;var r=n.length;var o="";for(var a=0;a<r;a++){var l=n[a];var h=BX.type.isNotEmptyString(l["id"])?l["id"]:"";var c=BX.type.isNotEmptyString(l["typeName"])?l["typeName"].toUpperCase():"";var u=l["params"]?l["params"]:{};if(c==="USER"){var p=u["data"]?u["data"]:{};this.setElementByFilter(p[s?"settingsElementId":"elementId"],p["paramName"],i);var m=u["search"]?u["search"]:{};this.setElementByFilter(m[s?"settingsElementId":"elementId"],m["paramName"],i)}}},onGetFilterFields:function(t,e,i){
var n=this._infos;if(!BX.type.isArray(n)){return}var s=e.name.indexOf("flt_settings")===0;var r=n.length;for(var o=0;o<r;o++){var a=n[o];var l=BX.type.isNotEmptyString(a["id"])?a["id"]:"";var h=BX.type.isNotEmptyString(a["typeName"])?a["typeName"].toUpperCase():"";var c=a["params"]?a["params"]:{};if(h==="USER"){var u=c["data"]?c["data"]:{};this.setFilterByElement(u[s?"settingsElementId":"elementId"],u["paramName"],i);var p=c["search"]?c["search"]:{};this.setFilterByElement(p[s?"settingsElementId":"elementId"],p["paramName"],i)}}},setElementByFilter:function(t,e,i){var n=BX.type.isNotEmptyString(t)?BX(t):null;if(BX.type.isElementNode(n)){n.value=BX.type.isNotEmptyString(e)&&i[e]?i[e]:""}},setFilterByElement:function(t,e,i){var n=BX.type.isNotEmptyString(t)?BX(t):null;if(BX.type.isElementNode(n)&&BX.type.isNotEmptyString(e)){i[e]=n.value}}};BX.InterfaceFilterFieldInfoProvider.items={};BX.InterfaceFilterFieldInfoProvider.create=function(t,e){var i=new BX.InterfaceFilterFieldInfoProvider;i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.CrmConversionSchemeSelector==="undefined"){BX.CrmConversionSchemeSelector=function(){this._id="";this._settings={};this._entityId=0;this._scheme="";this._isMenuShown=false;this._menuId="";this._container=null;this._containerClickHandler=BX.delegate(this.onContainerClick,this);this._label=null;this._button=null;this._buttonClickHandler=BX.delegate(this.onButtonClick,this);this._menuIiemClickHandler=BX.delegate(this.onMenuItemClick,this);this._menuCloseHandler=BX.delegate(this.onMenuClose,this);this._hint=null};BX.CrmConversionSchemeSelector.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._entityId=parseInt(this.getSetting("entityId",0));if(!BX.type.isNumber(this._entityId)){throw"BX.CrmConversionSchemeSelector: entity id is not found!"}this._scheme=this.getSetting("scheme","");this._container=BX(this.getSetting("containerId"));if(!BX.type.isElementNode(this._container)){throw"BX.CrmConversionSchemeSelector: container element is not found!"}BX.bind(this._container,"click",this._containerClickHandler);this._menuId="crm_menu_popup_"+this._id.toLowerCase();this._button=BX(this.getSetting("buttonId"));if(!BX.type.isElementNode(this._button)){throw"BX.CrmConversionSchemeSelector: button element is not found!"}BX.bind(this._button,"click",this._buttonClickHandler);var i=this.getSetting("labelId","");if(BX.type.isNotEmptyString(i)){this._label=BX(i)}if(this.getSetting("enableHint",false)){this.createHint(this.getSetting("hintMessages",null))}this.doInitialize()},doInitialize:function(){},release:function(){this.closeMenu();BX.unbind(this._container,"click",this._containerClickHandler);BX.unbind(this._button,"click",this._buttonClickHandler)},getSetting:function(t,e){return typeof this._settings[t]!="undefined"?this._settings[t]:e},getId:function(){return this._id},getScheme:function(){return this._scheme},setScheme:function(t){this._scheme=t;this.processSchemeChange()},processSchemeChange:function(){if(this._label){this._label.innerHTML=BX.util.htmlspecialchars(this.getSchemeDescription(this._scheme))}window.setTimeout(BX.delegate(this.convert,this),250)},getSchemeDescription:function(t){return"["+t+"]"},showMenu:function(){if(this._isMenuShown){return}var t=[];var e=this.prepareItems();for(var i=0;i<e.length;i++){var n=e[i];t.push({text:n["text"],value:n["value"],href:"#",className:"crm-convert-item",onclick:this._menuIiemClickHandler})}if(typeof BX.PopupMenu.Data[this._menuId]!=="undefined"){BX.PopupMenu.Data[this._menuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._menuId]}var s=this._button;var r=BX.pos(s);BX.PopupMenu.show(this._menuId,s,t,{autoHide:true,offsetLeft:r["width"]/2,angle:{position:"top",offset:0},events:{onPopupClose:this._menuCloseHandler}});this._isMenuShown=true},closeMenu:function(){if(!this._isMenuShown){return}BX.PopupMenu.destroy(this._menuId);this._isMenuShown=false},prepareItems:function(){},prepareConfig:function(){},processContainerClick:function(){this.convert()},processMenuItemClick:function(t){this.setScheme(t["value"]);this.closeMenu()},createHint:function(t){if(!t){return}this._hint=BX.PopupWindowManager.create(this._id+"_hint",this._container,{offsetTop:-8,autoHide:true,closeByEsc:false,angle:{position:"bottom",offset:42},events:{onPopupClose:BX.delegate(this.onHintClose,this)},content:BX.create("DIV",{attrs:{className:"crm-conv-selector-popup-contents"},children:[BX.create("SPAN",{attrs:{className:"crm-popup-title"},text:t["title"]}),BX.create("P",{text:t["content"]}),BX.create("P",{children:[BX.create("A",{props:{href:"#"},text:t["disabling"],events:{click:BX.delegate(this.onDisableHint,this)}})]})]})});this._hint.show()},onDisableHint:function(t){if(this._hint){this._hint.close();BX.userOptions.save("crm.interface.toobar","conv_scheme_selector","enable_"+this.getId().toLowerCase()+"_hint","N",false)}return BX.PreventDefault(t)},onHintClose:function(){if(this._hint){this._hint.destroy();this._hint=null}},onButtonClick:function(t){this.showMenu()},onContainerClick:function(t){this.processContainerClick()},onMenuItemClick:function(t,e){this.processMenuItemClick(e);return BX.PreventDefault(t)},onMenuClose:function(){this._isMenuShown=false},convert:function(){}}}if(typeof BX.CrmEntityConversionScheme==="undefined"){BX.CrmEntityConversionScheme=function(){};BX.CrmEntityConversionScheme.mergeConfigs=function(t,e){this.mergeEntityConfigs(BX.CrmEntityType.names.deal,t,e);this.mergeEntityConfigs(BX.CrmEntityType.names.contact,t,e);this.mergeEntityConfigs(BX.CrmEntityType.names.company,t,e);this.mergeEntityConfigs(BX.CrmEntityType.names.invoice,t,e);this.mergeEntityConfigs(BX.CrmEntityType.names.quote,t,e)};BX.CrmEntityConversionScheme.mergeEntityConfigs=function(t,e,i){var n=t.toLowerCase();if(typeof e[n]==="undefined"){return}if(typeof i[n]==="undefined"){i[n]={}}if(BX.type.isNotEmptyString(e[n]["active"])){i[n]["active"]=e[n]["active"]}if(BX.type.isNotEmptyString(e[n]["enableSync"])){i[n]["enableSync"]=e[n]["enableSync"]}if(BX.type.isPlainObject(e[n]["initData"])){i[n]["initData"]=e[n]["initData"]}};BX.CrmEntityConversionScheme.removeEntityConfigs=function(t,e){var i=t.toLowerCase();if(typeof e[i]!=="undefined"){delete e[i]}}}if(typeof BX.CrmLeadConversionScheme==="undefined"){BX.CrmLeadConversionScheme={undefined:"",dealcontactcompany:"DEAL_CONTACT_COMPANY",dealcontact:"DEAL_CONTACT",dealcompany:"DEAL_COMPANY",deal:"DEAL",contactcompany:"CONTACT_COMPANY",contact:"CONTACT",company:"COMPANY",getListItems:function(t){var e=[];for(var i=0;i<t.length;i++){var n=t[i];e.push({value:n,text:this.getDescription(n)})}return e},getDescription:function(t){var e=this.messages;return e.hasOwnProperty(t)?e[t]:t},fromConfig:function(t){var e=this.undefined;var i=this.isEntityActive(t,"deal");var n=this.isEntityActive(t,"contact");var s=this.isEntityActive(t,"company");if(i){if(n&&s){e=this.dealcontactcompany}else if(n){e=this.dealcontact}else if(s){e=this.dealcompany}else{e=this.deal}}else if(n&&s){e=this.contactcompany}else if(n){e=this.contact}else if(s){e=this.company}return e},toConfig:function(t,e){this.markEntityAsActive(e,BX.CrmEntityType.names.deal,t===this.dealcontactcompany||t===this.dealcontact||t===this.dealcompany||t===this.deal);this.markEntityAsActive(e,BX.CrmEntityType.names.contact,t===this.dealcontactcompany||t===this.dealcontact||t===this.contactcompany||t===this.contact);this.markEntityAsActive(e,BX.CrmEntityType.names.company,t===this.dealcontactcompany||t===this.dealcompany||t===this.contactcompany||t===this.company)},createConfig:function(t){var e={};this.toConfig(t,e);return e},isEntityActive:function(t,e){var i=e.toLowerCase();var n=typeof t[i]!=="undefined"?t[i]:{};return BX.type.isNotEmptyString(n["active"])&&n["active"]==="Y"},markEntityAsActive:function(t,e,i){var n=e.toLowerCase();if(typeof t[n]==="undefined"){t[n]={}}t[n]["active"]=i?"Y":"N"},mergeConfigs:function(t,e){BX.CrmEntityConversionScheme.mergeEntityConfigs(BX.CrmEntityType.names.deal,t,e);BX.CrmEntityConversionScheme.mergeEntityConfigs(BX.CrmEntityType.names.contact,t,e);BX.CrmEntityConversionScheme.mergeEntityConfigs(BX.CrmEntityType.names.company,t,e);BX.CrmEntityConversionScheme.removeEntityConfigs(BX.CrmEntityType.names.invoice,e);BX.CrmEntityConversionScheme.removeEntityConfigs(BX.CrmEntityType.names.quote,e)}};if(typeof BX.CrmLeadConversionScheme.messages==="undefined"){BX.CrmLeadConversionScheme.messages={}}}if(typeof BX.CrmDealConversionScheme==="undefined"){BX.CrmDealConversionScheme={undefined:"",invoice:"INVOICE",quote:"QUOTE",getListItems:function(t){var e=[];for(var i=0;i<t.length;i++){var n=t[i];e.push({value:n,text:this.getDescription(n)})}return e},getDescription:function(t){var e=this.messages;return e.hasOwnProperty(t)?e[t]:t},fromConfig:function(t){var e=this.undefined;if(this.isEntityActive(t,"invoice")){e=this.invoice}else if(this.isEntityActive(t,"quote")){e=this.quote}return e},toConfig:function(t,e){this.markEntityAsActive(e,"invoice",t===this.invoice);this.markEntityAsActive(e,"quote",t===this.quote)},createConfig:function(t){var e={};this.toConfig(t,e);return e},isEntityActive:function(t,e){var i=typeof t[e]!=="undefined"?t[e]:{};return BX.type.isNotEmptyString(i["active"])&&i["active"]==="Y"},markEntityAsActive:function(t,e,i){if(typeof t[e]==="undefined"){t[e]={}}t[e]["active"]=i?"Y":"N"},mergeConfigs:function(t,e){BX.CrmEntityConversionScheme.mergeEntityConfigs(BX.CrmEntityType.names.invoice,t,e);BX.CrmEntityConversionScheme.mergeEntityConfigs(BX.CrmEntityType.names.quote,t,e);BX.CrmEntityConversionScheme.removeEntityConfigs(BX.CrmEntityType.names.deal,e);BX.CrmEntityConversionScheme.removeEntityConfigs(BX.CrmEntityType.names.contact,e);BX.CrmEntityConversionScheme.removeEntityConfigs(BX.CrmEntityType.names.company,e)}};if(typeof BX.CrmDealConversionScheme.messages==="undefined"){BX.CrmDealConversionScheme.messages={}}}if(typeof BX.CrmQuoteConversionScheme==="undefined"){BX.CrmQuoteConversionScheme={undefined:"",deal:"DEAL",invoice:"INVOICE",getListItems:function(t){var e=[];for(var i=0;i<t.length;i++){var n=t[i];e.push({value:n,text:this.getDescription(n)})}return e},getDescription:function(t){var e=this.messages;return e.hasOwnProperty(t)?e[t]:t},fromConfig:function(t){var e=this.undefined;if(this.isEntityActive(t,"deal")){e=this.deal}else if(this.isEntityActive(t,"invoice")){e=this.invoice}return e},toConfig:function(t,e){this.markEntityAsActive(e,"deal",t===this.deal);this.markEntityAsActive(e,"invoice",t===this.invoice)},createConfig:function(t){var e={};this.toConfig(t,e);return e},isEntityActive:function(t,e){var i=typeof t[e]!=="undefined"?t[e]:{};return BX.type.isNotEmptyString(i["active"])&&i["active"]==="Y"},markEntityAsActive:function(t,e,i){if(typeof t[e]==="undefined"){t[e]={}}t[e]["active"]=i?"Y":"N"},mergeConfigs:function(t,e){BX.CrmEntityConversionScheme.mergeEntityConfigs(BX.CrmEntityType.names.deal,t,e);BX.CrmEntityConversionScheme.mergeEntityConfigs(BX.CrmEntityType.names.invoice,t,e);BX.CrmEntityConversionScheme.removeEntityConfigs(BX.CrmEntityType.names.quote,e);BX.CrmEntityConversionScheme.removeEntityConfigs(BX.CrmEntityType.names.contact,e);BX.CrmEntityConversionScheme.removeEntityConfigs(BX.CrmEntityType.names.company,e)}};if(typeof BX.CrmQuoteConversionScheme.messages==="undefined"){BX.CrmQuoteConversionScheme.messages={}}}if(typeof BX.CrmEntityConverterMode==="undefined"){BX.CrmEntityConverterMode={intermediate:0,schemeSetup:1,syncSetup:2,request:3}}if(typeof BX.CrmEntityConverter==="undefined"){BX.CrmEntityConverter=function(){this._id="";this._settings={};this._config={};this._contextData=null;this._mode=BX.CrmEntityConverterMode.intermediate;this._entityId=0;this._originUrl="";this._syncEditor=null;this._syncEditorClosingListener=BX.delegate(this.onSyncEditorClose,this);this._enableSync=false;this._enablePageRefresh=true;this._enableRedirectToShowPage=true;this._requestIsRunning=false;this._dealCategorySelectDialog=null;this._dealCategorySelectListener=BX.delegate(this.onDealCategorySelect,this)};BX.CrmEntityConverter.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._config=this.getSetting("config",{});this._serviceUrl=this.getSetting("serviceUrl","");this._enablePageRefresh=this.getSetting("enablePageRefresh",true);this._enableRedirectToShowPage=this.getSetting("enableRedirectToShowPage",true)},getSetting:function(t,e){return typeof this._settings[t]!="undefined"?this._settings[t]:e},setSetting:function(t,e){this._settings[t]=e},getId:function(){return this._id},getMessage:function(t){return t},getConfig:function(){return this._config},setupSynchronization:function(t){this._mode=BX.CrmEntityConverterMode.syncSetup;if(this._syncEditor){this._syncEditor.setConfig(this._config);this._syncEditor.setFieldNames(t)}else{this._syncEditor=BX.CrmEntityFieldSynchronizationEditor.create(this._id+"_config",{converter:this,config:this._config,title:this.getMessage("dialogTitle"),fieldNames:t,legend:this.getMessage("syncEditorLegend"),fieldListTitle:this.getMessage("syncEditorFieldListTitle"),entityListTitle:this.getMessage("syncEditorEntityListTitle"),continueButton:this.getMessage("continueButton"),cancelButton:this.getMessage("cancelButton")});this._syncEditor.addClosingListener(this._syncEditorClosingListener)}this._syncEditor.show()},convert:function(t,e,i,n){if(!BX.type.isPlainObject(e)){return}this._entityId=t;this._contextData=BX.type.isPlainObject(n)?n:null;this._originUrl=i;this.registerConfig(e);if(!BX.CrmLeadConversionScheme.isEntityActive(this._config,BX.CrmEntityType.names.deal)){this.startRequest()}else{var s=BX.type.isPlainObject(this._config["deal"]["initData"])?this._config["deal"]["initData"]["categoryId"]:0;if(!this._dealCategorySelectDialog){this._dealCategorySelectDialog=BX.CrmDealCategorySelectDialog.create(this._id,{value:s});this._dealCategorySelectDialog.addCloseListener(this._dealCategorySelectListener)}this._dealCategorySelectDialog.open()}},registerConfig:function(t){BX.CrmEntityConversionScheme.mergeConfigs(t,this._config)},onDealCategorySelect:function(t,e){if(!(BX.type.isBoolean(e["isCanceled"])&&e["isCanceled"]===false)){return}if(!BX.type.isPlainObject(this._config["deal"]["initData"])){this._config["deal"]["initData"]={}}this._config["deal"]["initData"]["categoryId"]=t.getValue();this.startRequest()},onSyncEditorClose:function(t,e){this._mode=BX.CrmEntityConverterMode.intermediate;if(!(BX.type.isBoolean(e["isCanceled"])&&e["isCanceled"]===false)){return}this._enableSync=true;this._config=this._syncEditor.getConfig();this._contextData=null;this.startRequest()},startRequest:function(){if(this._requestIsRunning){return}this._requestIsRunning=true;BX.showWait();BX.ajax({url:this._serviceUrl,method:"POST",dataType:"json",data:{MODE:"CONVERT",ENTITY_ID:this._entityId,ENABLE_SYNCHRONIZATION:this._enableSync?"Y":"N",ENABLE_REDIRECT_TO_SHOW:this._enableRedirectToShowPage?"Y":"N",CONFIG:this._config,CONTEXT:this._contextData,ORIGIN_URL:this._originUrl},onsuccess:BX.delegate(this.onRequestSuccsess,this),onfailure:BX.delegate(this.onRequestFailure,this)});this._mode=BX.CrmEntityConverterMode.request},onRequestSuccsess:function(t){BX.closeWait();this._requestIsRunning=false;this._mode=BX.CrmEntityConverterMode.intermediate;if(BX.type.isPlainObject(t["ERROR"])){this.showError(t["ERROR"]);return}var e;if(BX.type.isPlainObject(t["REQUIRED_ACTION"])){var i=t["REQUIRED_ACTION"];var n=BX.type.isNotEmptyString(i["NAME"])?i["NAME"]:"";e=BX.type.isPlainObject(i["DATA"])?i["DATA"]:{};if(n==="SYNCHRONIZE"){if(BX.type.isPlainObject(e["CONFIG"])){this._config=e["CONFIG"]}this.setupSynchronization(BX.type.isArray(e["FIELD_NAMES"])?e["FIELD_NAMES"]:[])}return}if(BX.type.isPlainObject(t["DATA"])){e=t["DATA"];if(BX.type.isNotEmptyString(e["URL"])){window.location.href=e["URL"]}else if(this._enablePageRefresh){window.location.reload()}}},onRequestFailure:function(t){BX.closeWait();this._requestIsRunning=false;this._mode=BX.CrmEntityConverterMode.intermediate},showError:function(t){if(BX.type.isPlainObject(t)){alert(BX.type.isNotEmptyString(t["MESSAGE"])?t["MESSAGE"]:this.getMessage("generalError"))}}};BX.CrmEntityConverter.create=function(t,e){var i=new BX.CrmEntityConverter;i.initialize(t,e);return i}}if(typeof BX.CrmLeadConverter==="undefined"){BX.CrmLeadConverter=function(){BX.CrmLeadConverter.superclass.constructor.apply(this);this._entitySelectorId="lead_converter";this._entitySelectHandler=BX.delegate(this.onEntitySelect,this);this._entitySelectCallback=null};BX.extend(BX.CrmLeadConverter,BX.CrmEntityConverter);BX.CrmLeadConverter.prototype.registerConfig=function(t){BX.CrmLeadConversionScheme.mergeConfigs(t,this._config)};BX.CrmLeadConverter.prototype.getMessage=function(t){var e=BX.CrmLeadConverter.messages;return e.hasOwnProperty(t)?e[t]:t};if(typeof BX.CrmLeadConverter.messages==="undefined"){BX.CrmLeadConverter.messages={}}BX.CrmLeadConverter.prototype.openEntitySelector=function(t){this._entitySelectCallback=BX.type.isFunction(t)?t:null;var e=this._entitySelectorId;if(typeof obCrm[e]==="undefined"){obCrm[e]=new CRM(e,null,null,e,[],false,true,["contact","company"],{contact:this.getMessage("contact"),company:this.getMessage("company"),ok:this.getMessage("selectButton"),cancel:BX.message("JS_CORE_WINDOW_CANCEL"),close:BX.message("JS_CORE_WINDOW_CLOSE"),wait:BX.message("JS_CORE_LOADING"),noresult:this.getMessage("noresult"),search:this.getMessage("search"),last:this.getMessage("last")},true);obCrm[e].Init();obCrm[e].AddOnSaveListener(this._entitySelectHandler)}obCrm[e].Open({closeIcon:{top:"10px",right:"15px"},closeByEsc:true,titleBar:this.getMessage("entitySelectorTitle")})};BX.CrmLeadConverter.prototype.onEntitySelect=function(t){var e=this._entitySelectorId;obCrm[e].RemoveOnSaveListener(this._entitySelectHandler);obCrm[e].Clear();delete obCrm[e];if(!this._entitySelectCallback){return}var i;var n=null;for(i in t){if(t.hasOwnProperty(i)&&BX.type.isPlainObject(t[i])&&BX.type.isPlainObject(t[i][0])){var s=t[i][0];var r=typeof s["id"]?parseInt(s["id"]):0;if(r>0){if(n===null){n={}}n[i]=r}}}if(n===null){this._entitySelectCallback({config:null,data:null})}else{var o={deal:{active:"N"},contact:{active:"N"},company:{active:"N"}};for(i in n){if(n.hasOwnProperty(i)&&typeof o[i]!=="undefined"){o[i]["active"]="Y"}}this._entitySelectCallback({config:o,data:n})}};BX.CrmLeadConverter.create=function(t,e){var i=new BX.CrmLeadConverter;i.initialize(t,e);return i};BX.CrmLeadConverter.current=null;if(typeof(BX.CrmLeadConverter.settings==="undefined")){BX.CrmLeadConverter.settings={}}if(typeof(BX.CrmLeadConverter.permissions==="undefined")){BX.CrmLeadConverter.permissions={contact:false,company:false,deal:false}}BX.CrmLeadConverter.getCurrent=function(){if(!this.current){this.current=BX.CrmLeadConverter.create("current",this.settings)}return this.current}}if(typeof BX.CrmDealConverter==="undefined"){BX.CrmDealConverter=function(){BX.CrmDealConverter.superclass.constructor.apply(this)};BX.extend(BX.CrmDealConverter,BX.CrmEntityConverter);BX.CrmDealConverter.prototype.registerConfig=function(t){BX.CrmDealConversionScheme.mergeConfigs(t,this._config)};BX.CrmDealConverter.prototype.getMessage=function(t){var e=BX.CrmDealConverter.messages;return e.hasOwnProperty(t)?e[t]:t};if(typeof BX.CrmDealConverter.messages==="undefined"){BX.CrmDealConverter.messages={}}BX.CrmDealConverter.create=function(t,e){var i=new BX.CrmDealConverter;i.initialize(t,e);return i};BX.CrmDealConverter.current=null;if(typeof(BX.CrmDealConverter.settings==="undefined")){BX.CrmDealConverter.settings={}}if(typeof(BX.CrmDealConverter.permissions==="undefined")){BX.CrmDealConverter.permissions={invoice:false,quote:false}}BX.CrmDealConverter.getCurrent=function(){if(!this.current){this.current=BX.CrmDealConverter.create("current",this.settings)}return this.current}}if(typeof BX.CrmQuoteConverter==="undefined"){BX.CrmQuoteConverter=function(){BX.CrmQuoteConverter.superclass.constructor.apply(this)};BX.extend(BX.CrmQuoteConverter,BX.CrmEntityConverter);BX.CrmQuoteConverter.prototype.registerConfig=function(t){BX.CrmQuoteConversionScheme.mergeConfigs(t,this._config)};BX.CrmQuoteConverter.prototype.getMessage=function(t){var e=BX.CrmQuoteConverter.messages;return e.hasOwnProperty(t)?e[t]:t};if(typeof BX.CrmQuoteConverter.messages==="undefined"){BX.CrmQuoteConverter.messages={}}BX.CrmQuoteConverter.create=function(t,e){var i=new BX.CrmQuoteConverter;i.initialize(t,e);return i};BX.CrmQuoteConverter.current=null;if(typeof(BX.CrmQuoteConverter.settings==="undefined")){BX.CrmQuoteConverter.settings={}}if(typeof(BX.CrmQuoteConverter.permissions==="undefined")){BX.CrmQuoteConverter.permissions={invoice:false,quote:false}}BX.CrmQuoteConverter.getCurrent=function(){if(!this.current){this.current=BX.CrmQuoteConverter.create("current",this.settings)}return this.current}}if(typeof BX.CrmEntityFieldSynchronizationEditor==="undefined"){BX.CrmEntityFieldSynchronizationEditor=function(){this._id="";this._settings={};this._converter=null;this._config={};this._fieldNames=[];this._closingNotifier=null;this._contentWrapper=null;this._fieldWrapper=null;this._foldButton=null;this._foldButtonClickHandler=BX.delegate(this.onFoldButtonClick,this);this._checkBoxes={};this._resizer=null;this._popup=null};BX.CrmEntityFieldSynchronizationEditor.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._converter=this.getSetting("converter");this._config=this.getSetting("config",{});this._fieldNames=this.getSetting("fieldNames",[]);this._closingNotifier=BX.CrmNotifier.create(this)},getSetting:function(t,e){return typeof this._settings[t]!="undefined"?this._settings[t]:e},setSetting:function(t,e){this._settings[t]=e},getId:function(){return this._id},getConfig:function(){return this._config},setConfig:function(t){this._config=t},getFieldNames:function(){return this._fieldNames},setFieldNames:function(t){this._fieldNames=t},show:function(){if(this.isShown()){return}var t=this.getId();if(BX.CrmEntityFieldSynchronizationEditor.windows[t]){BX.CrmEntityFieldSynchronizationEditor.windows[t].destroy();delete BX.CrmEntityFieldSynchronizationEditor.windows[t]}var e=this.getSetting("anchor",null);this._popup=new BX.PopupWindow(t,e,{autoHide:false,draggable:true,zIndex:100,bindOptions:{forceBindPosition:false},closeByEsc:true,closeIcon:{marginRight:"-2px",marginTop:"3px"},events:{onPopupShow:BX.delegate(this.onPopupShow,this),onPopupClose:BX.delegate(this.onPopupClose,this),onPopupDestroy:BX.delegate(this.onPopupDestroy,this)},titleBar:this.getSetting("title"),content:this.prepareContent(),buttons:this.prepareButtons(),lightShadow:true,className:"crm-tip-popup"});BX.CrmEntityFieldSynchronizationEditor.windows[t]=this._popup;this._popup.show()},close:function(){if(!(this._popup&&this._popup.isShown())){return}this._popup.close()},isShown:function(){return this._popup&&this._popup.isShown()},addClosingListener:function(t){this._closingNotifier.addListener(t)},removeClosingListener:function(t){this._closingNotifier.removeListener(t)},getMessage:function(t){var e=BX.CrmEntityFieldSynchronizationEditor.messages;return e.hasOwnProperty(t)?e.messages[t]:t},prepareButtons:function(){return[new BX.PopupWindowButton({text:this.getSetting("continueButton"),className:"popup-window-button-accept",events:{click:BX.delegate(this.onContinueBtnClick,this)}}),new BX.PopupWindowButtonLink({text:this.getSetting("cancelButton"),className:"popup-window-button-link-cancel",events:{click:BX.delegate(this.onCancelBtnClick,this)}})]},prepareContent:function(){this._contentWrapper=BX.create("DIV",{attrs:{className:"crm-popup-setting-fields"}});var t=BX.create("UL",{attrs:{className:"crm-p-s-f-items-list"}});for(var e=0;e<this._fieldNames.length;e++){t.appendChild(BX.create("LI",{attrs:{className:"crm-p-s-f-item"},text:this._fieldNames[e]}))}var i=this._fieldWrapper=BX.create("DIV",{attrs:{className:"crm-p-s-f-block-wrap crm-p-s-f-block-hide"}});this._contentWrapper.appendChild(i);var n=BX.create("DIV",{attrs:{className:"crm-p-s-f-top-block"},children:[BX.create("DIV",{attrs:{className:"crm-p-s-f-title"},text:this.getSetting("fieldListTitle")+":"}),t]});var s=this._foldButton=BX.create("DIV",{attrs:{className:"crm-p-s-f-open-btn"}});if(t.children.length>6){BX.bind(s,"click",this._foldButtonClickHandler)}else{i.classList.toggle("crm-p-s-f-block-open")}var r=BX.create("DIV",{attrs:{className:"crm-p-s-f-block-hide-inner"},children:[BX.create("DIV",{attrs:{className:"crm-p-s-f-text"},text:this.getSetting("legend")}),n,s]});i.appendChild(r);this._resizer=BX.AnimatedResize.create(r,i);var o=BX.create("DIV",{attrs:{className:"crm-p-s-f-block-wrap"}});this._contentWrapper.appendChild(o);o.appendChild(BX.create("DIV",{attrs:{className:"crm-p-s-f-title"},text:this.getSetting("entityListTitle")+":"}));var a=this.getId();this._checkBoxes={};var l=BX.create("UL",{attrs:{className:"crm-p-s-f-checkbox-items-list"}});for(var h in this._config){if(!this._config.hasOwnProperty(h)){continue}var c=this._config[h];var u=BX.type.isNotEmptyString(c["enableSync"])&&c["enableSync"]==="Y";if(!u){continue}var p=a+"_"+h;var m=BX.create("INPUT",{props:{id:p,type:"checkbox",checked:true}});this._checkBoxes[h]=m;var d=BX.create("LABEL",{props:{htmlFor:p},text:BX.CrmEntityType.getCaptionByName(h)});l.appendChild(BX.create("LI",{attrs:{className:"crm-p-s-f-checkbox-item"},children:[m,d]}))}o.appendChild(l);return this._contentWrapper},saveConfig:function(){for(var t in this._checkBoxes){if(this._checkBoxes.hasOwnProperty(t)&&this._config.hasOwnProperty(t)){this._config[t]["enableSync"]=this._checkBoxes[t].checked?"Y":"N"}}},onFoldButtonClick:function(){this._fieldWrapper.classList.toggle("crm-p-s-f-block-open");this._resizer.run()},onContinueBtnClick:function(){this.saveConfig();this._closingNotifier.notify([{isCanceled:false}]);this.close()},onCancelBtnClick:function(){this._closingNotifier.notify([{isCanceled:true}]);this.close()},onPopupShow:function(){},onPopupClose:function(){if(this._popup){this._contentWrapper=null;this._popup.destroy()}},onPopupDestroy:function(){if(!this._popup){return}this._fieldWrapper=null;this._foldButton=null;this._contentWrapper=null;this._checkBoxes={};this._resizer=null;this._popup=null;delete BX.CrmEntityFieldSynchronizationEditor.windows[this.getId()]}};BX.CrmEntityFieldSynchronizationEditor.windows={};if(typeof BX.CrmEntityFieldSynchronizationEditor.messages=="undefined"){BX.CrmEntityFieldSynchronizationEditor.messages={}}BX.CrmEntityFieldSynchronizationEditor.create=function(t,e){var i=new BX.CrmEntityFieldSynchronizationEditor;i.initialize(t,e);return i}}if(typeof BX.AnimatedResize==="undefined"){BX.AnimatedResize=function(){this._innerBlock=null;this._mainBlock=null;this._isOpen=false};BX.AnimatedResize.prototype={initialize:function(t,e){this._innerBlock=t;this._mainBlock=e},run:function(){this._isOpen=this._mainBlock.offsetHeight==this._innerBlock.offsetHeight;this.ease(this._isOpen?{start:this._innerBlock.offsetHeight,finish:0}:{start:this._mainBlock.offsetHeight,finish:this._innerBlock.offsetHeight});this._isOpen=!this._isOpen},step:function(t){this._mainBlock.style.height=t.height+"px"},complete:function(){if(this._isOpen){this._mainBlock.style.height="auto"}},ease:function(t){new BX.easing({duration:300,start:{height:t["start"]},finish:{height:t["finish"]},transition:BX.easing.makeEaseOut(BX.easing.transitions.circ),step:BX.delegate(this.step,this),complete:BX.delegate(this.complete,this)}).animate()}};BX.AnimatedResize.create=function(t,e){var i=new BX.AnimatedResize;i.initialize(t,e);return i}}if(typeof BX.CrmLeadConversionSchemeSelector==="undefined"){BX.CrmLeadConversionSchemeSelector=function(){BX.CrmLeadConversionSchemeSelector.superclass.constructor.apply(this)};BX.extend(BX.CrmLeadConversionSchemeSelector,BX.CrmConversionSchemeSelector);BX.CrmLeadConversionSchemeSelector.prototype.prepareItems=function(){var t=BX.CrmLeadConverter.permissions["deal"];var e=BX.CrmLeadConverter.permissions["contact"];var i=BX.CrmLeadConverter.permissions["company"];var n=[];if(t){if(e&&i){n.push(BX.CrmLeadConversionScheme.dealcontactcompany)}if(e){n.push(BX.CrmLeadConversionScheme.dealcontact)}if(i){n.push(BX.CrmLeadConversionScheme.dealcompany)}n.push(BX.CrmLeadConversionScheme.deal)}if(e&&i){n.push(BX.CrmLeadConversionScheme.contactcompany)}if(e){n.push(BX.CrmLeadConversionScheme.contact)}if(i){n.push(BX.CrmLeadConversionScheme.company)}var s=BX.CrmLeadConversionScheme.getListItems(n);if(e||i){s.push({value:"CUSTOM",text:BX.CrmLeadConverter.getCurrent().getMessage("openEntitySelector")})}return s};BX.CrmLeadConversionSchemeSelector.prototype.prepareConfig=function(){return BX.CrmLeadConversionScheme.createConfig(this._scheme)};BX.CrmLeadConversionSchemeSelector.prototype.getSchemeDescription=function(t){return BX.CrmLeadConversionScheme.getDescription(t)};BX.CrmLeadConversionSchemeSelector.prototype.processMenuItemClick=function(t){var e=t["value"];if(e==="CUSTOM"){BX.CrmLeadConverter.getCurrent().openEntitySelector(BX.delegate(this.onEntitySelect,this))}else{this.setScheme(e)}this.closeMenu()};BX.CrmLeadConversionSchemeSelector.prototype.onEntitySelect=function(t){if(!BX.type.isPlainObject(t)){return}BX.CrmLeadConverter.getCurrent().convert(this._entityId,t["config"],this.getSetting("originUrl"),t["data"])};BX.CrmLeadConversionSchemeSelector.prototype.convert=function(){BX.CrmLeadConverter.getCurrent().convert(this._entityId,this.prepareConfig(),this.getSetting("originUrl"))};BX.CrmLeadConversionSchemeSelector.create=function(t,e){var i=new BX.CrmLeadConversionSchemeSelector;i.initialize(t,e);return i}}if(typeof BX.CrmDealConversionSchemeSelector==="undefined"){BX.CrmDealConversionSchemeSelector=function(){BX.CrmDealConversionSchemeSelector.superclass.constructor.apply(this)};BX.extend(BX.CrmDealConversionSchemeSelector,BX.CrmConversionSchemeSelector);BX.CrmDealConversionSchemeSelector.prototype.prepareItems=function(){var t=[];if(BX.CrmDealConverter.permissions["invoice"]){t.push(BX.CrmDealConversionScheme.invoice)}if(BX.CrmDealConverter.permissions["quote"]){t.push(BX.CrmDealConversionScheme.quote)}return BX.CrmDealConversionScheme.getListItems(t)};BX.CrmDealConversionSchemeSelector.prototype.prepareConfig=function(){return BX.CrmDealConversionScheme.createConfig(this._scheme)};BX.CrmDealConversionSchemeSelector.prototype.getSchemeDescription=function(t){return BX.CrmDealConversionScheme.getDescription(t)};BX.CrmDealConversionSchemeSelector.prototype.convert=function(){BX.CrmDealConverter.getCurrent().convert(this._entityId,this.prepareConfig(),this.getSetting("originUrl",""))};BX.CrmDealConversionSchemeSelector.create=function(t,e){var i=new BX.CrmDealConversionSchemeSelector;i.initialize(t,e);return i}}if(typeof BX.CrmQuoteConversionSchemeSelector==="undefined"){BX.CrmQuoteConversionSchemeSelector=function(){BX.CrmQuoteConversionSchemeSelector.superclass.constructor.apply(this)};BX.extend(BX.CrmQuoteConversionSchemeSelector,BX.CrmConversionSchemeSelector);BX.CrmQuoteConversionSchemeSelector.prototype.prepareItems=function(){var t=[];if(BX.CrmQuoteConverter.permissions["deal"]){t.push(BX.CrmQuoteConversionScheme.deal)}if(BX.CrmQuoteConverter.permissions["invoice"]){t.push(BX.CrmQuoteConversionScheme.invoice)}return BX.CrmQuoteConversionScheme.getListItems(t)};BX.CrmQuoteConversionSchemeSelector.prototype.prepareConfig=function(){return BX.CrmQuoteConversionScheme.createConfig(this._scheme)};BX.CrmQuoteConversionSchemeSelector.prototype.getSchemeDescription=function(t){return BX.CrmQuoteConversionScheme.getDescription(t)};BX.CrmQuoteConversionSchemeSelector.prototype.convert=function(){BX.CrmQuoteConverter.getCurrent().convert(this._entityId,this.prepareConfig(),this.getSetting("originUrl",""))};BX.CrmQuoteConversionSchemeSelector.items={};BX.CrmQuoteConversionSchemeSelector.create=function(t,e){var i=new BX.CrmQuoteConversionSchemeSelector;i.initialize(t,e);this.items[i.getId()]=i;return i}}BX.CrmRequisitePresetListLoader=function(){
this._id="";this._settings={};this._entityTypeName="";this._serviceUrl="";this._callback=null;this._isRequestRunning=false;this._waiter=null;this._resultData=null};BX.CrmRequisitePresetListLoader.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"crm_rq_prest_loader"+Math.random().toString().substring(2);this._settings=e?e:{};this._entityTypeName=this.getSetting("entityTypeName","");if(!BX.type.isNotEmptyString(this._entityTypeName)){throw"BX.CrmRequisitePresetListLoader. Could not find 'entityTypeName' parameter."}this._entityTypeName=this._entityTypeName.toUpperCase();this._serviceUrl=this.getSetting("serviceUrl","");if(!BX.type.isNotEmptyString(this._serviceUrl)){throw"BX.CrmRequisitePresetListLoader. Could not find 'serviceUrl' parameter."}var i=this.getSetting("callback");if(BX.type.isFunction(i)){this._callback=i}},getId:function(){return this._id},getSetting:function(t,e){return typeof this._settings[t]!="undefined"?this._settings[t]:e},getResultData:function(){return this._resultData},start:function(){if(this._isRequestRunning){return false}this._isRequestRunning=true;this._waiter=BX.showWait();BX.ajax({url:this._serviceUrl,method:"POST",dataType:"json",data:{ENTITY_TYPE_NAME:this._entityTypeName,ACTION:"GET_REQUISITE_PRESETS"},onsuccess:BX.delegate(this.onRequestSuccess,this),onfailure:BX.delegate(this.onRequestFailure,this)});return true},onRequestSuccess:function(t){this._isRequestRunning=false;if(this._waiter){BX.closeWait(null,this._waiter);this._waiter=null}var e=BX.type.isPlainObject(t["RESULT"])?t["RESULT"]:{};this._resultData=BX.type.isArray(e["ITEMS"])?e["ITEMS"]:[];if(this._callback){this._callback(this,{isSuccessed:true,resultData:this._resultData})}},onRequestFailure:function(t){this._isRequestRunning=false;if(this._waiter){BX.closeWait(null,this._waiter);this._waiter=null}this._resultData=[];if(this._callback){this._callback(this,{isSuccessed:false,resultData:this._resultData})}}};BX.CrmRequisitePresetListLoader.create=function(t,e){var i=new BX.CrmRequisitePresetListLoader;i.initialize(t,e);return i};BX.CrmRequisitePresetSelectDialog=function(){this._id="";this._settings={};this._popup=null;this._contentWrapper=null;this._list=null;this._selector=null;this._callback=null};BX.CrmRequisitePresetSelectDialog.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._list=this.getSetting("list");if(!BX.type.isArray(this._list)){throw"BX.CrmRequisitePresetSelectDialog. Could not find 'list' parameter."}var i=this.getSetting("callback");if(BX.type.isFunction(i)){this._callback=i}},getId:function(){return this._id},getSetting:function(t,e){return typeof this._settings[t]!="undefined"?this._settings[t]:e},getMessage:function(t){var e=BX.CrmRequisitePresetSelectDialog.messages;return e.hasOwnProperty(t)?e[t]:t},show:function(){if(this.isShown()){return}var t=this.getId();if(BX.CrmRequisitePresetSelectDialog.windows[t]){BX.CrmRequisitePresetSelectDialog.windows[t].destroy()}this._popup=new BX.PopupWindow(t,this.getSetting("anchor",null),{autoHide:false,draggable:true,bindOptions:{forceBindPosition:false},closeByEsc:true,closeIcon:{top:"10px",right:"15px"},zIndex:0,titleBar:this.getMessage("title"),content:this.prepareContent(),className:"crm-tip-popup",lightShadow:true,buttons:[new BX.PopupWindowButton({text:BX.message("JS_CORE_WINDOW_CONTINUE"),className:"popup-window-button-accept",events:{click:BX.delegate(this.onAcceptButtonClick,this)}}),new BX.PopupWindowButtonLink({text:BX.message("JS_CORE_WINDOW_CANCEL"),className:"popup-window-button-link-cancel",events:{click:BX.delegate(this.onCancelButtonClick,this)}})],events:{onPopupShow:BX.delegate(this.onPopupShow,this),onPopupClose:BX.delegate(this.onPopupClose,this),onPopupDestroy:BX.delegate(this.onPopupDestroy,this)}});(BX.CrmRequisitePresetSelectDialog.windows[t]=this._popup).show()},close:function(){if(!(this._popup&&this._popup.isShown())){return}this._popup.close()},isShown:function(){return this._popup&&this._popup.isShown()},getSelectedValue:function(){return this._selector?this._selector.value:""},prepareContent:function(){var t=this._contentWrapper=BX.create("DIV",{attrs:{className:"bx-requisite-dialog"}});var e=BX.create("DIV",{attrs:{className:"container-item"}});t.appendChild(e);var i=this._selector=BX.create("SELECT",{});var n=[];for(var s=0;s<this._list.length;s++){var r=this._list[s];n.push({value:r["ID"],text:r["NAME"]})}BX.HtmlHelper.setupSelectOptions(i,n);e.appendChild(BX.create("DIV",{attrs:{className:"field-container field-container-left"},children:[BX.create("LABEL",{attrs:{className:"field-container-title"},text:this.getMessage("presetField")+":"}),BX.create("SPAN",{attrs:{className:"select-container"},children:[i]})]}));return this._contentWrapper},onCancelButtonClick:function(){if(this._callback){this._callback(this,{isAccepted:false,selectedValue:this.getSelectedValue()})}},onAcceptButtonClick:function(){if(this._callback){this._callback(this,{isAccepted:true,selectedValue:this.getSelectedValue()})}},onPopupShow:function(){},onPopupClose:function(){if(this._popup){this._popup.destroy()}if(this._callback){this._callback(this,{isAccepted:false,selectedValue:this.getSelectedValue()})}},onPopupDestroy:function(){if(this._popup){this._popup=null}}};if(typeof BX.CrmRequisitePresetSelectDialog.messages==="undefined"){BX.CrmRequisitePresetSelectDialog.messages={}}BX.CrmRequisitePresetSelectDialog.windows={};BX.CrmRequisitePresetSelectDialog.create=function(t,e){var i=new BX.CrmRequisitePresetSelectDialog;i.initialize(t,e);return i};BX.CrmRequisiteConverter=function(){this._id="";this._settings={};this._entityTypeName="";this._serviceUrl="";this._presetId=0;this._presetList=null;this._presetListLoader=null;this._presetListLoadHandler=BX.delegate(this.onPresetListLoad,this);this._presetSelector=null;this._presetSelectHandler=BX.delegate(this.onPresetSelect,this);this._processDialog=null;this._processStateChangeHandler=BX.delegate(this.onProcessStateChange,this)};BX.CrmRequisiteConverter.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._entityTypeName=this.getSetting("entityTypeName","");if(!BX.type.isNotEmptyString(this._entityTypeName)){throw"BX.CrmRequisiteConverter. Could not find 'entityTypeName' parameter."}this._entityTypeName=this._entityTypeName.toUpperCase();this._serviceUrl=this.getSetting("serviceUrl","");if(!BX.type.isNotEmptyString(this._serviceUrl)){throw"BX.CrmRequisiteConverter. Could not find 'serviceUrl' parameter."}},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){var e=BX.CrmRequisiteConverter.messages;return e.hasOwnProperty(t)?e[t]:t},convert:function(){if(this._presetId>0){this.openProcessDialog()}else{if(this._presetList===null){this.openPresetListLoader()}else{this.openPresetSelector()}}},skip:function(){BX.ajax({url:this._serviceUrl,method:"POST",dataType:"json",data:{ACTION:"SKIP_CONVERT_REQUISITES",PARAMS:{}},onsuccess:BX.delegate(this._onRequestSuccsess,this),onfailure:BX.delegate(this._onRequestFailure,this)})},openPresetListLoader:function(){if(!this._presetListLoader){this._presetListLoader=BX.CrmRequisitePresetListLoader.create(this._id,{entityTypeName:this._entityTypeName,serviceUrl:this._serviceUrl,callback:this._presetListLoadHandler})}this._presetListLoader.start()},onPresetListLoad:function(t,e){this._presetList=e["isSuccessed"]?e["resultData"]:[];this.openPresetSelector()},openPresetSelector:function(){if(!this._presetSelector){this._presetSelector=BX.CrmRequisitePresetSelectDialog.create(this._id,{list:this._presetList,callback:this._presetSelectHandler})}this._presetSelector.show()},onPresetSelect:function(t,e){if(this._presetSelector){if(e["isAccepted"]){this._presetId=parseInt(e["selectedValue"]);this.openProcessDialog()}this._presetSelector.close()}},openProcessDialog:function(){if(!this._processDialog){var t=this._entityTypeName.toLowerCase().replace(/(?:^)\S/,function(t){return t.toUpperCase()});var e="convert"+t+"Requisites";this._processDialog=BX.CrmLongRunningProcessDialog.create(e,{serviceUrl:this._serviceUrl,action:"CONVERT_REQUISITES",params:{ENTITY_TYPE_NAME:this._entityTypeName,PRESET_ID:this._presetId},title:this.getMessage("processDialogTitle"),summary:this.getMessage("processDialogSummary")});BX.addCustomEvent(this._processDialog,"ON_STATE_CHANGE",this._processStateChangeHandler)}this._processDialog.show()},closeProcessDialog:function(){if(this._processDialog){this._processDialog.close();this._processDialog=null}},onProcessStateChange:function(t){if(t.getState()===BX.CrmLongRunningProcessState.completed){BX.onCustomEvent(this,"ON_"+this._entityTypeName+"_REQUISITE_TRANFER_COMPLETE",[this])}}};if(typeof BX.CrmRequisiteConverter.messages==="undefined"){BX.CrmRequisiteConverter.messages={}}BX.CrmRequisiteConverter.create=function(t,e){var i=new BX.CrmRequisiteConverter;i.initialize(t,e);return i};BX.CrmPSRequisiteConverter=function(){this._id="";this._settings={};this._serviceUrl="";this._processDialog=null;this._processStateChangeHandler=BX.delegate(this.onProcessStateChange,this)};BX.CrmPSRequisiteConverter.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._serviceUrl=this.getSetting("serviceUrl","");if(!BX.type.isNotEmptyString(this._serviceUrl)){throw"BX.CrmPSRequisiteConverter. Could not find 'serviceUrl' parameter."}},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){var e=BX.CrmPSRequisiteConverter.messages;return e.hasOwnProperty(t)?e[t]:t},convert:function(){this.openProcessDialog()},skip:function(){BX.ajax({url:this._serviceUrl,method:"POST",dataType:"json",data:{ACTION:"SKIP_CONVERT_PS_REQUISITES",PARAMS:{}},onsuccess:BX.delegate(this._onRequestSuccsess,this),onfailure:BX.delegate(this._onRequestFailure,this)})},openProcessDialog:function(){if(!this._processDialog){this._processDialog=BX.CrmLongRunningProcessDialog.create("convertPSRequisites",{serviceUrl:this._serviceUrl,action:"CONVERT_PS_REQUISITES",params:{ENTITY_TYPE_NAME:this._entityTypeName,PRESET_ID:this._presetId},title:this.getMessage("processDialogTitle"),summary:this.getMessage("processDialogSummary")});BX.addCustomEvent(this._processDialog,"ON_STATE_CHANGE",this._processStateChangeHandler)}this._processDialog.show()},closeProcessDialog:function(){if(this._processDialog){this._processDialog.close();this._processDialog=null}},onProcessStateChange:function(t){if(t.getState()===BX.CrmLongRunningProcessState.completed){BX.onCustomEvent(this,"ON_PS_REQUISITE_TRANFER_COMPLETE",[this])}}};if(typeof BX.CrmPSRequisiteConverter.messages==="undefined"){BX.CrmPSRequisiteConverter.messages={}}BX.CrmPSRequisiteConverter.create=function(t,e){var i=new BX.CrmPSRequisiteConverter;i.initialize(t,e);return i};if(typeof BX.CrmDealCategory=="undefined"){BX.CrmDealCategory=function(){};BX.CrmDealCategory.getDefaultValue=function(){return"0"};BX.CrmDealCategory.getListItems=function(t){if(!BX.type.isArray(t)){t=BX.CrmDealCategory.infos}var e=[];for(var i=0,n=t.length;i<n;i++){var s=t[i];e.push({value:s["id"],text:s["name"]})}return e};if(typeof BX.CrmDealCategory.infos==="undefined"){BX.CrmDealCategory.infos=[]}}if(typeof BX.CrmDealCategorySelector=="undefined"){BX.CrmDealCategorySelector=function(){this._id="";this._settings={};this._selectorMenu=null;this._menuItemSelectHandler=BX.delegate(this.onMenuItemSelect,this);this._canCreateCategory=false;this._createUrl="";this._categoryListUrl="";this._categoryCreateUrl=""};BX.CrmDealCategorySelector.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._canCreateCategory=!!this.getSetting("canCreateCategory",false);this._createUrl=this.getSetting("createUrl","");this._categoryListUrl=this.getSetting("categoryListUrl","");this._categoryCreateUrl=this.getSetting("categoryCreateUrl","")},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){var e=BX.CrmDealCategorySelector.messages;return e.hasOwnProperty(t)?e[t]:t},redirectToCreateUrl:function(t){if(this._createUrl===""){return}window.location=t>0?BX.util.add_url_param(this._createUrl,{category_id:t}):this._createUrl},openMenu:function(t){if(!this._selectorMenu){var e=BX.CrmDealCategory.getListItems();if(this._canCreateCategory){e.push({text:this.getMessage("create"),value:"new"})}this._selectorMenu=BX.CmrSelectorMenu.create(this._id,{items:e});this._selectorMenu.addOnSelectListener(this._menuItemSelectHandler)}if(!this._selectorMenu.isOpened()){this._selectorMenu.open(t)}},onMenuItemSelect:function(t,e){var i=e.getValue();if(this._selectorMenu.isOpened()){this._selectorMenu.close()}if(i==="new"){window.location=this._categoryCreateUrl}else{this.redirectToCreateUrl(parseInt(i))}}};if(typeof BX.CrmDealCategorySelector.messages==="undefined"){BX.CrmDealCategorySelector.messages={}}BX.CrmDealCategorySelector.items={};BX.CrmDealCategorySelector.create=function(t,e){var i=new BX.CrmDealCategorySelector;i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.CrmDealCategorySelectDialog==="undefined"){BX.CrmDealCategorySelectDialog=function(){this._id="";this._settings={};this._popup=null;this._selector=null;this._value="";this._isOpened=false;this._closeNotifier=null};BX.CrmDealCategorySelectDialog.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._value=parseInt(this.getSetting("value",0));if(isNaN(this._value)){this._value=0}this._closeNotifier=BX.CrmNotifier.create(this)},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){var e=BX.CrmDealCategorySelectDialog.messages;return e.hasOwnProperty(t)?e[t]:t},isOpened:function(){return this._isOpened},open:function(){if(this._isOpened){return}this._popup=new BX.PopupWindow(this._id,null,{autoHide:false,draggable:true,offsetLeft:0,offsetTop:0,bindOptions:{forceBindPosition:true},closeByEsc:true,closeIcon:{top:"10px",right:"15px"},titleBar:this.getMessage("title"),content:this.prepareContent(),events:{onPopupShow:BX.delegate(this.onPopupShow,this),onPopupClose:BX.delegate(this.onPopupClose,this),onPopupDestroy:BX.delegate(this.onPopupDestroy,this)},buttons:this.prepareButtons()});this._popup.show()},close:function(){if(this._popup){this._popup.close()}},addCloseListener:function(t){this._closeNotifier.addListener(t)},removeCloseListener:function(t){this._closeNotifier.removeListener(t)},prepareContent:function(){var t=BX.create("TABLE",{attrs:{className:"bx-crm-deal-category-selector-dialog",cellspacing:"2"}});var e,i;e=t.insertRow(-1);i=e.insertCell(-1);i.appendChild(BX.create("LABEL",{text:this.getMessage("field")+":"}));i=e.insertCell(-1);this._selector=BX.create("SELECT",{});BX.HtmlHelper.setupSelectOptions(this._selector,BX.CrmDealCategory.getListItems());this._selector.value=this._value;i.appendChild(this._selector);return t},prepareButtons:function(){return[new BX.PopupWindowButton({text:this.getMessage("saveButton"),className:"popup-window-button-accept",events:{click:BX.delegate(this.processSave,this)}}),new BX.PopupWindowButtonLink({text:this.getMessage("cancelButton"),className:"popup-window-button-link-cancel",events:{click:BX.delegate(this.processCancel,this)}})]},getValue:function(){return this._value},setValue:function(t){t=parseInt(t);if(isNaN(t)){t=0}this._value=t},processSave:function(){this._value=parseInt(this._selector.value);if(isNaN(this._value)){this._value=0}this._closeNotifier.notify([{isCanceled:false}]);this.close()},processCancel:function(){this._closeNotifier.notify([{isCanceled:true}]);this.close()},onPopupShow:function(){this._isOpened=true},onPopupClose:function(){if(this._popup){this._popup.destroy()}},onPopupDestroy:function(){this._isOpened=false;this._popup=null}};if(typeof BX.CrmDealCategorySelectDialog.messages==="undefined"){BX.CrmDealCategorySelectDialog.messages={}}BX.CrmDealCategorySelectDialog.create=function(t,e){var i=new BX.CrmDealCategorySelectDialog;i.initialize(t,e);return i}}if(typeof BX.CrmHtmlLoader=="undefined"){BX.CrmHtmlLoader=function(){this._id="";this._settings={};this._params={};this._serviceUrl="";this._requestIsRunning=false;this._button=null;this._wrapper=null;this._buttonClickHandler=BX.delegate(this.onButtonClick,this)};BX.CrmHtmlLoader.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._serviceUrl=this.getSetting("serviceUrl");if(!BX.type.isNotEmptyString(this._serviceUrl)){throw"BX.CrmHtmlLoader: service url not found!"}this._action=this.getSetting("action");if(!BX.type.isNotEmptyString(this._action)){throw"BX.CrmHtmlLoader: action not found!"}this._params=this.getSetting("params",{});this._button=BX(this.getSetting("button"));if(!BX.type.isElementNode(this._button)){throw"BX.CrmHtmlLoader: button element not found!"}BX.bind(this._button,"click",this._buttonClickHandler);this._wrapper=BX(this.getSetting("wrapper"));if(!BX.type.isElementNode(this._wrapper)){throw"BX.CrmHtmlLoader: wrapper element not found!"}},release:function(){BX.unbind(this._button,"click",this._buttonClickHandler)},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},onButtonClick:function(t){this.startRequest();return BX.PreventDefault(t)},startRequest:function(){if(this._requestIsRunning){return}this._requestIsRunning=true;BX.showWait();BX.ajax({url:this._serviceUrl,method:"POST",dataType:"json",data:{ACTION:this._action,PARAMS:this._params},onsuccess:BX.delegate(this.onRequestSuccsess,this),onfailure:BX.delegate(this.onRequestFailure,this)})},onRequestSuccsess:function(t){BX.closeWait();this._requestIsRunning=false;if(BX.type.isPlainObject(t["ERROR"])){this.showError(t["ERROR"]);return}if(BX.type.isPlainObject(t["DATA"])){var e=t["DATA"];if(BX.type.isNotEmptyString(e["HTML"])){this._wrapper.innerHTML=e["HTML"]}else if(BX.type.isNotEmptyString(e["TEXT"])){this._wrapper.innerHTML=BX.util.htmlspecialchars(e["TEXT"])}}},onRequestFailure:function(t){BX.closeWait();this._requestIsRunning=false},showError:function(t){if(BX.type.isPlainObject(t)&&BX.type.isNotEmptyString(t["MESSAGE"])){alert(t["MESSAGE"])}}};BX.CrmHtmlLoader.create=function(t,e){var i=new BX.CrmHtmlLoader;i.initialize(t,e);return i}}if(typeof BX.CrmDataLoader=="undefined"){BX.CrmDataLoader=function(){this._id="";this._settings={};this._params={};this._serviceUrl="";this._requestIsRunning=false;this._notifier=null;this._result=null};BX.CrmDataLoader.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._serviceUrl=this.getSetting("serviceUrl");if(!BX.type.isNotEmptyString(this._serviceUrl)){throw"BX.CrmDataLoader: service url not found!"}this._action=this.getSetting("action");if(!BX.type.isNotEmptyString(this._action)){throw"BX.CrmDataLoader: action not found!"}this._params=this.getSetting("params",{});this._notifier=BX.CrmNotifier.create(this)},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getResult:function(){return this._result},isRequestRunning:function(){return this._requestIsRunning},addCallBack:function(t){if(!BX.type.isFunction(t)){return}for(var e=0;this._callbacks.length;e++){if(this._callbacks[e]===t){return}}this._callbacks.push(t)},load:function(t){if(!BX.type.isFunction(t)){t=null}if(this._result===null){this._notifier.addListener(t);this.startRequest()}else if(t!==null){t(this._result)}},startRequest:function(){if(this._requestIsRunning){return}this._requestIsRunning=true;BX.showWait();BX.ajax({url:this._serviceUrl,method:"POST",dataType:"json",data:{ACTION:this._action,PARAMS:this._params},onsuccess:BX.delegate(this.onRequestSuccsess,this),onfailure:BX.delegate(this.onRequestFailure,this)})},onRequestSuccsess:function(t){BX.closeWait();this._requestIsRunning=false;this._result=BX.type.isPlainObject(t)?t:{};this._notifier.notify([this._result]);this._notifier.resetListeners()},onRequestFailure:function(t){BX.closeWait();this._requestIsRunning=false;this._result=BX.type.isPlainObject(t)?t:{};this._notifier.notify([this._result]);this._notifier.resetListeners()}};BX.CrmDataLoader.create=function(t,e){var i=new BX.CrmDataLoader;i.initialize(t,e);return i}}if(typeof BX.CrmRemoteAction){BX.CrmRemoteAction=function(){this._id="";this._settings={};this._serviceUrl="";this._redirectUrl=""};BX.CrmRemoteAction.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._serviceUrl=this.getSetting("serviceUrl","");if(!BX.type.isNotEmptyString(this._serviceUrl)){throw"BX.CrmRemoteAction: service url not found!"}this._redirectUrl=this.getSetting("redirectUrl","")},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},execute:function(t){if(BX.type.isNotEmptyString(t)){this._redirectUrl=t}BX.ajax({method:"POST",dataType:"html",url:this._serviceUrl,data:this.getSetting("data",{}),onsuccess:BX.delegate(this.onActionSuccess,this)})},onActionSuccess:function(t){if(BX.type.isNotEmptyString(this._redirectUrl)){document.location.href=this._redirectUrl}}};BX.CrmRemoteAction.items={};BX.CrmRemoteAction.create=function(t,e){var i=new BX.CrmRemoteAction;i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.CrmDeletionConfirmDialog==="undefined"){BX.CrmDeletionConfirmDialog=function(){this._id="";this._settings={};this._name="";this._path="";this._messages={};this._dlg=null;this._closeNotifier=null};BX.CrmDeletionConfirmDialog.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._name=this.getSetting("name","");this._path=this.getSetting("path","");if(!BX.type.isNotEmptyString(this._path)){throw"BX.CrmDeletionConfirmDialog: Could not find parameter 'path'."}this._messages=this.getSetting("messages",{});this._closeNotifier=BX.CrmNotifier.create(this)},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){return this._messages.hasOwnProperty(t)?this._messages[t]:t},open:function(){this._dlg=new BX.CDialog({title:this.getMessage("title"),head:"",content:this.getMessage("confirm").replace(/#NAME#/gi,this._name),resizable:false,draggable:true,height:70,width:300});this._dlg.SetButtons([{title:this.getMessage("deleteButton"),id:"delete",action:BX.delegate(this.onAction,this)},BX.CDialog.btnClose]);this._dlg.Show()},close:function(){if(this._dlg){this._dlg.Close()}},onAction:function(){this.close();window.location.href=this._path}};BX.CrmDeletionConfirmDialog.create=function(t,e){var i=new BX.CrmDeletionConfirmDialog;i.initialize(t,e);return i}}if(typeof BX.FilterUserSelector=="undefined"){BX.FilterUserSelector=function(){this._id="";this._settings={};this._fieldId="";this._control=null;this._currentUser=null;this._componentName=null;this._componentObj=null;this._componentContainer=null;this._serviceContainer=null;this._zIndex=1100;this._isDialogDisplayed=false;this._dialog=null;this._inputKeyPressHandler=BX.delegate(this.onInputKeyPress,this)};BX.FilterUserSelector.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._fieldId=this.getSetting("fieldId","");this._componentName=this.getSetting("componentName","");this._componentContainer=BX(this._componentName+"_selector_content");this._serviceContainer=this.getSetting("serviceContainer",null);if(!BX.type.isDomNode(this._serviceContainer)){this._serviceContainer=document.body}BX.addCustomEvent(window,"BX.Main.Filter:customEntityFocus",BX.delegate(this.onCustomEntitySelectorOpen,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityBlur",BX.delegate(this.onCustomEntitySelectorClose,this))},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getSearchInput:function(){return this._control?this._control.getLabelNode():null},isOpened:function(){return this._isDialogDisplayed},open:function(){if(this._componentObj===null){var t="O_"+this._componentName;if(!window[t]){throw"BX.FilterUserSelector: Could not find '"+t+"' user selector."}this._componentObj=window[t]}var e=this.getSearchInput();if(this._componentObj.searchInput){BX.unbind(this._componentObj.searchInput,"keyup",BX.proxy(this._componentObj.search,this._componentObj))}this._componentObj.searchInput=e;BX.bind(this._componentObj.searchInput,"keyup",BX.proxy(this._componentObj.search,this._componentObj));this._componentObj.onSelect=BX.delegate(this.onSelect,this);BX.bind(e,"keyup",this._inputKeyPressHandler);if(this._currentUser){this._componentObj.setSelected([this._currentUser])}else{var i=this._componentObj.getSelected();if(i){for(var n in i){if(i.hasOwnProperty(n)){this._componentObj.unselect(n)}}}}if(this._dialog===null){this._componentContainer.style.display="";this._dialog=new BX.PopupWindow(this._id,this.getSearchInput(),{autoHide:false,draggable:false,closeByEsc:true,offsetLeft:0,offsetTop:0,zIndex:this._zIndex,bindOptions:{forceBindPosition:true},content:this._componentContainer,events:{onPopupShow:BX.delegate(this.onDialogShow,this),onPopupClose:BX.delegate(this.onDialogClose,this),onPopupDestroy:BX.delegate(this.onDialogDestroy,this)}})}this._dialog.show();this._componentObj._onFocus();if(this._control){this._control.setPopupContainer(this._componentContainer)}},close:function(){var t=this.getSearchInput();if(t){BX.unbind(t,"keyup",this._inputKeyPressHandler)}if(this._dialog){this._dialog.close()}if(this._control){this._control.setPopupContainer(null)}},closeSiblings:function(){var t=BX.FilterUserSelector.items;for(var e in t){if(t.hasOwnProperty(e)&&t[e]!==this){t[e].close()}}},onCustomEntitySelectorOpen:function(t){var e=t.getId();if(this._fieldId!==e){this._control=null;this.close()}else{this._control=t;if(this._control){var i=this._control.getCurrentValues();this._currentUser={id:i["value"]}}this.closeSiblings();this.open()}},onCustomEntitySelectorClose:function(t){if(this._fieldId===t.getId()){this._control=null;this.close()}},onDialogShow:function(){this._isDialogDisplayed=true},onDialogClose:function(){this._componentContainer.parentNode.removeChild(this._componentContainer);this._serviceContainer.appendChild(this._componentContainer);this._componentContainer.style.display="none";this._dialog.destroy();this._isDialogDisplayed=false},onDialogDestroy:function(){this._dialog=null},onInputKeyPress:function(t){if(!this._dialog||!this._isDialogDisplayed){this.open()}if(this._componentObj){this._componentObj.search()}},onSelect:function(t){this._currentUser=t;if(this._control){var e=this._control.getLabelNode();e.value="";this._control.setData(t["name"],t["id"])}this.close()}};BX.FilterUserSelector.closeAll=function(){for(var t in this.items){if(this.items.hasOwnProperty(t)){this.items[t].close()}}};BX.FilterUserSelector.items={};BX.FilterUserSelector.create=function(t,e){var i=new BX.FilterUserSelector(t,e);i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.FilterUserSelector2=="undefined"){BX.FilterUserSelector2=function(){this._id="";this._settings={};this._fieldId="";this._control=null;this._currentUser=null;this._componentName=null;this._componentObj=null;this._componentContainer=null;this._serviceContainer=null;this._zIndex=1100;this._isDialogDisplayed=false;this._dialog=null;this._mainWindow=null;this._inputKeyPressHandler=BX.delegate(this.onInputKeyPress,this)};BX.FilterUserSelector2.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._fieldId=this.getSetting("fieldId","");this._componentName=this.getSetting("componentName","");this._componentContainer=BX(this._componentName+"_selector_content");BX.addCustomEvent(window,"BX.Main.Filter:customEntityFocus",BX.delegate(this.onCustomEntitySelectorOpen,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityBlur",BX.delegate(this.onCustomEntitySelectorClose,this))},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getSearchInput:function(){return this._control?this._control.getLabelNode():null},onCustomEntitySelectorOpen:function(t){var e=t.getId();if(this._fieldId!==e){this._control=null;this.close()}else{this._control=t;if(this._control){var i=this._control.getCurrentValues();this._currentUser={entityId:i["value"]}}this.open()}},onCustomEntitySelectorClose:function(t){if(this._fieldId===t.getId()){this._control=null;this.close()}},open:function(){if(this._mainWindow&&this._mainWindow===BX.SocNetLogDestination.popupWindow){return}var t=this._id;var e=this.getSearchInput();e.id=e.name;var i=this.getSetting("users",{});var n=this.getSetting("last",{});var s=this.getSetting("department",{});var r=BX.SocNetLogDestination.buildDepartmentRelation(s);BX.SocNetLogDestination.init({name:t,searchInput:e,extranetUser:false,bindMainPopup:{node:e,offsetTop:"5px",offsetLeft:"15px"},bindSearchPopup:{node:e,offsetTop:"5px",offsetLeft:"15px"},callback:{select:BX.delegate(this.onSelect,this)},showSearchInput:false,departmentSelectDisable:true,items:{users:i,groups:{},sonetgroups:{},department:s,departmentRelation:r},itemsLast:this.getSetting("last",{}),itemsSelected:{},isCrmFeed:false,useClientDatabase:false,destSort:{},allowAddUser:false,allowSearchCrmEmailUsers:false,allowUserSearch:true});BX.bind(e,"keyup",BX.delegate(BX.SocNetLogDestination.BXfpSearch,{formName:t,inputName:e.id}));BX.bind(e,"keydown",BX.delegate(BX.SocNetLogDestination.BXfpSearchBefore,{formName:t,inputName:e.id}));BX.SocNetLogDestination.openDialog(t);this._mainWindow=BX.SocNetLogDestination.popupWindow;if(this._control&&this._mainWindow){this._control.setPopupContainer(this._mainWindow.contentContainer)}},close:function(){if(this._mainWindow&&this._mainWindow===BX.SocNetLogDestination.popupWindow){BX.SocNetLogDestination.closeDialog();this._mainWindow=null}},onSelect:function(t,e,i,n){if(e!=="users"){return}this._currentUser=t;if(this._control){this._control.setData(t["name"],t["entityId"])}this.close()}};BX.FilterUserSelector2.items={};BX.FilterUserSelector2.create=function(t,e){var i=new BX.FilterUserSelector2(t,e);i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.CrmSearchContentManager=="undefined"){BX.CrmSearchContentManager=function(){this._id="";this._settings={};this._entityTypeName="";this._processDialogs={}};BX.CrmSearchContentManager.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"crm_search_content_mgr_"+Math.random().toString().substring(2);this._settings=e?e:{};this._entityTypeName=this.getSetting("entityTypeName","");if(!BX.type.isNotEmptyString(this._entityTypeName)){throw"BX.CrmSearchContentManager. Could not find entity type name."}this._entityTypeName=this._entityTypeName.toUpperCase()},getId:function(){return this._id},getEntityTypeName:function(){return this._entityTypeName},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},setSetting:function(t,e){this._settings[t]=e},getMessage:function(t){var e=BX.CrmSearchContentManager.messages;return e.hasOwnProperty(t)?e[t]:t},rebuildIndex:function(){var t=this.getSetting("serviceUrl","");if(!BX.type.isNotEmptyString(t)){throw"BX.CrmSearchContentManager. Could not find service url."}var e=this._entityTypeName.toLowerCase().replace(/(?:^)\S/,function(t){return t.toUpperCase()});var i="rebuild"+e;var n=null;if(typeof this._processDialogs[i]!=="undefined"){n=this._processDialogs[i]}else{n=BX.CrmLongRunningProcessDialog.create(i,{serviceUrl:t,action:"REBUILD_SEARCH_CONTENT",params:{ENTITY_TYPE_NAME:this._entityTypeName},title:this.getMessage(i+"DlgTitle"),summary:this.getMessage(i+"DlgSummary")});this._processDialogs[i]=n;BX.addCustomEvent(n,"ON_STATE_CHANGE",BX.delegate(this._onProcessStateChange,this))}n.show()},_onProcessStateChange:function(t){var e=t.getId();if(typeof this._processDialogs[e]!=="undefined"){var i=this._processDialogs[e];if(i.getState()===BX.CrmLongRunningProcessState.completed){BX.onCustomEvent(this,"ON_"+this._entityTypeName+"_SEARCH_CONTENT_REBUILD_COMPLETE",[this]);

}}}};if(typeof BX.CrmSearchContentManager.messages=="undefined"){BX.CrmSearchContentManager.messages={}}BX.CrmSearchContentManager.items={};BX.CrmSearchContentManager.create=function(t,e){var i=new BX.CrmSearchContentManager;i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof cssQuery!=="function"){eval(function(t,e,i,n,s,r){s=function(t){return(t<e?"":s(parseInt(t/e)))+((t=t%e)>35?String.fromCharCode(t+29):t.toString(36))};if(!"".replace(/^/,String)){while(i--)r[s(i)]=n[i]||s(i);n=[function(t){return r[t]}];s=function(){return"\\w+"};i=1}while(i--)if(n[i])t=t.replace(new RegExp("\\b"+s(i)+"\\b","g"),n[i]);return t}('7 x=6(){7 1D="2.0.2";7 C=/\\s*,\\s*/;7 x=6(s,A){33{7 m=[];7 u=1z.32.2c&&!A;7 b=(A)?(A.31==22)?A:[A]:[1g];7 1E=18(s).1l(C),i;9(i=0;i<1E.y;i++){s=1y(1E[i]);8(U&&s.Z(0,3).2b("")==" *#"){s=s.Z(2);A=24([],b,s[1])}1A A=b;7 j=0,t,f,a,c="";H(j<s.y){t=s[j++];f=s[j++];c+=t+f;a="";8(s[j]=="("){H(s[j++]!=")")a+=s[j];a=a.Z(0,-1);c+="("+a+")"}A=(u&&V[c])?V[c]:21(A,t,f,a);8(u)V[c]=A}m=m.30(A)}2a x.2d;5 m}2Z(e){x.2d=e;5[]}};x.1Z=6(){5"6 x() {\\n  [1D "+1D+"]\\n}"};7 V={};x.2c=L;x.2Y=6(s){8(s){s=1y(s).2b("");2a V[s]}1A V={}};7 29={};7 19=L;x.15=6(n,s){8(19)1i("s="+1U(s));29[n]=12 s()};x.2X=6(c){5 c?1i(c):o};7 D={};7 h={};7 q={P:/\\[([\\w-]+(\\|[\\w-]+)?)\\s*(\\W?=)?\\s*([^\\]]*)\\]/};7 T=[];D[" "]=6(r,f,t,n){7 e,i,j;9(i=0;i<f.y;i++){7 s=X(f[i],t,n);9(j=0;(e=s[j]);j++){8(M(e)&&14(e,n))r.z(e)}}};D["#"]=6(r,f,i){7 e,j;9(j=0;(e=f[j]);j++)8(e.B==i)r.z(e)};D["."]=6(r,f,c){c=12 1t("(^|\\\\s)"+c+"(\\\\s|$)");7 e,i;9(i=0;(e=f[i]);i++)8(c.l(e.1V))r.z(e)};D[":"]=6(r,f,p,a){7 t=h[p],e,i;8(t)9(i=0;(e=f[i]);i++)8(t(e,a))r.z(e)};h["2W"]=6(e){7 d=Q(e);8(d.1C)9(7 i=0;i<d.1C.y;i++){8(d.1C[i]==e)5 K}};h["2V"]=6(e){};7 M=6(e){5(e&&e.1c==1&&e.1f!="!")?e:23};7 16=6(e){H(e&&(e=e.2U)&&!M(e))28;5 e};7 G=6(e){H(e&&(e=e.2T)&&!M(e))28;5 e};7 1r=6(e){5 M(e.27)||G(e.27)};7 1P=6(e){5 M(e.26)||16(e.26)};7 1o=6(e){7 c=[];e=1r(e);H(e){c.z(e);e=G(e)}5 c};7 U=K;7 1h=6(e){7 d=Q(e);5(2S d.25=="2R")?/\\.1J$/i.l(d.2Q):2P(d.25=="2O 2N")};7 Q=6(e){5 e.2M||e.1g};7 X=6(e,t){5(t=="*"&&e.1B)?e.1B:e.X(t)};7 17=6(e,t,n){8(t=="*")5 M(e);8(!14(e,n))5 L;8(!1h(e))t=t.2L();5 e.1f==t};7 14=6(e,n){5!n||(n=="*")||(e.2K==n)};7 1e=6(e){5 e.1G};6 24(r,f,B){7 m,i,j;9(i=0;i<f.y;i++){8(m=f[i].1B.2J(B)){8(m.B==B)r.z(m);1A 8(m.y!=23){9(j=0;j<m.y;j++){8(m[j].B==B)r.z(m[j])}}}}5 r};8(![].z)22.2I.z=6(){9(7 i=0;i<1z.y;i++){o[o.y]=1z[i]}5 o.y};7 N=/\\|/;6 21(A,t,f,a){8(N.l(f)){f=f.1l(N);a=f[0];f=f[1]}7 r=[];8(D[t]){D[t](r,A,f,a)}5 r};7 S=/^[^\\s>+~]/;7 20=/[\\s#.:>+~()@]|[^\\s#.:>+~()@]+/g;6 1y(s){8(S.l(s))s=" "+s;5 s.P(20)||[]};7 W=/\\s*([\\s>+~(),]|^|$)\\s*/g;7 I=/([\\s>+~,]|[^(]\\+|^)([#.:@])/g;7 18=6(s){5 s.O(W,"$1").O(I,"$1*$2")};7 1u={1Z:6(){5"\'"},P:/^(\'[^\']*\')|("[^"]*")$/,l:6(s){5 o.P.l(s)},1S:6(s){5 o.l(s)?s:o+s+o},1Y:6(s){5 o.l(s)?s.Z(1,-1):s}};7 1s=6(t){5 1u.1Y(t)};7 E=/([\\/()[\\]?{}|*+-])/g;6 R(s){5 s.O(E,"\\\\$1")};x.15("1j-2H",6(){D[">"]=6(r,f,t,n){7 e,i,j;9(i=0;i<f.y;i++){7 s=1o(f[i]);9(j=0;(e=s[j]);j++)8(17(e,t,n))r.z(e)}};D["+"]=6(r,f,t,n){9(7 i=0;i<f.y;i++){7 e=G(f[i]);8(e&&17(e,t,n))r.z(e)}};D["@"]=6(r,f,a){7 t=T[a].l;7 e,i;9(i=0;(e=f[i]);i++)8(t(e))r.z(e)};h["2G-10"]=6(e){5!16(e)};h["1x"]=6(e,c){c=12 1t("^"+c,"i");H(e&&!e.13("1x"))e=e.1n;5 e&&c.l(e.13("1x"))};q.1X=/\\\\:/g;q.1w="@";q.J={};q.O=6(m,a,n,c,v){7 k=o.1w+m;8(!T[k]){a=o.1W(a,c||"",v||"");T[k]=a;T.z(a)}5 T[k].B};q.1Q=6(s){s=s.O(o.1X,"|");7 m;H(m=s.P(o.P)){7 r=o.O(m[0],m[1],m[2],m[3],m[4]);s=s.O(o.P,r)}5 s};q.1W=6(p,t,v){7 a={};a.B=o.1w+T.y;a.2F=p;t=o.J[t];t=t?t(o.13(p),1s(v)):L;a.l=12 2E("e","5 "+t);5 a};q.13=6(n){1d(n.2D()){F"B":5"e.B";F"2C":5"e.1V";F"9":5"e.2B";F"1T":8(U){5"1U((e.2A.P(/1T=\\\\1v?([^\\\\s\\\\1v]*)\\\\1v?/)||[])[1]||\'\')"}}5"e.13(\'"+n.O(N,":")+"\')"};q.J[""]=6(a){5 a};q.J["="]=6(a,v){5 a+"=="+1u.1S(v)};q.J["~="]=6(a,v){5"/(^| )"+R(v)+"( |$)/.l("+a+")"};q.J["|="]=6(a,v){5"/^"+R(v)+"(-|$)/.l("+a+")"};7 1R=18;18=6(s){5 1R(q.1Q(s))}});x.15("1j-2z",6(){D["~"]=6(r,f,t,n){7 e,i;9(i=0;(e=f[i]);i++){H(e=G(e)){8(17(e,t,n))r.z(e)}}};h["2y"]=6(e,t){t=12 1t(R(1s(t)));5 t.l(1e(e))};h["2x"]=6(e){5 e==Q(e).1H};h["2w"]=6(e){7 n,i;9(i=0;(n=e.1F[i]);i++){8(M(n)||n.1c==3)5 L}5 K};h["1N-10"]=6(e){5!G(e)};h["2v-10"]=6(e){e=e.1n;5 1r(e)==1P(e)};h["2u"]=6(e,s){7 n=x(s,Q(e));9(7 i=0;i<n.y;i++){8(n[i]==e)5 L}5 K};h["1O-10"]=6(e,a){5 1p(e,a,16)};h["1O-1N-10"]=6(e,a){5 1p(e,a,G)};h["2t"]=6(e){5 e.B==2s.2r.Z(1)};h["1M"]=6(e){5 e.1M};h["2q"]=6(e){5 e.1q===L};h["1q"]=6(e){5 e.1q};h["1L"]=6(e){5 e.1L};q.J["^="]=6(a,v){5"/^"+R(v)+"/.l("+a+")"};q.J["$="]=6(a,v){5"/"+R(v)+"$/.l("+a+")"};q.J["*="]=6(a,v){5"/"+R(v)+"/.l("+a+")"};6 1p(e,a,t){1d(a){F"n":5 K;F"2p":a="2n";1a;F"2o":a="2n+1"}7 1m=1o(e.1n);6 1k(i){7 i=(t==G)?1m.y-i:i-1;5 1m[i]==e};8(!Y(a))5 1k(a);a=a.1l("n");7 m=1K(a[0]);7 s=1K(a[1]);8((Y(m)||m==1)&&s==0)5 K;8(m==0&&!Y(s))5 1k(s);8(Y(s))s=0;7 c=1;H(e=t(e))c++;8(Y(m)||m==1)5(t==G)?(c<=s):(s>=c);5(c%m)==s}});x.15("1j-2m",6(){U=1i("L;/*@2l@8(@\\2k)U=K@2j@*/");8(!U){X=6(e,t,n){5 n?e.2i("*",t):e.X(t)};14=6(e,n){5!n||(n=="*")||(e.2h==n)};1h=1g.1I?6(e){5/1J/i.l(Q(e).1I)}:6(e){5 Q(e).1H.1f!="2g"};1e=6(e){5 e.2f||e.1G||1b(e)};6 1b(e){7 t="",n,i;9(i=0;(n=e.1F[i]);i++){1d(n.1c){F 11:F 1:t+=1b(n);1a;F 3:t+=n.2e;1a}}5 t}}});19=K;5 x}();',62,190,"|||||return|function|var|if|for||||||||pseudoClasses||||test|||this||AttributeSelector|||||||cssQuery|length|push|fr|id||selectors||case|nextElementSibling|while||tests|true|false|thisElement||replace|match|getDocument|regEscape||attributeSelectors|isMSIE|cache||getElementsByTagName|isNaN|slice|child||new|getAttribute|compareNamespace|addModule|previousElementSibling|compareTagName|parseSelector|loaded|break|_0|nodeType|switch|getTextContent|tagName|document|isXML|eval|css|_1|split|ch|parentNode|childElements|nthChild|disabled|firstElementChild|getText|RegExp|Quote|x22|PREFIX|lang|_2|arguments|else|all|links|version|se|childNodes|innerText|documentElement|contentType|xml|parseInt|indeterminate|checked|last|nth|lastElementChild|parse|_3|add|href|String|className|create|NS_IE|remove|toString|ST|select|Array|null|_4|mimeType|lastChild|firstChild|continue|modules|delete|join|caching|error|nodeValue|textContent|HTML|prefix|getElementsByTagNameNS|end|x5fwin32|cc_on|standard||odd|even|enabled|hash|location|target|not|only|empty|root|contains|level3|outerHTML|htmlFor|class|toLowerCase|Function|name|first|level2|prototype|item|scopeName|toUpperCase|ownerDocument|Document|XML|Boolean|URL|unknown|typeof|nextSibling|previousSibling|visited|link|valueOf|clearCache|catch|concat|constructor|callee|try".split("|"),0,{}))}
//# sourceMappingURL=common.map.js