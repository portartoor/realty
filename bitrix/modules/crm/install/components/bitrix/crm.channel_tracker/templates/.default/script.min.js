if(typeof BX.CrmChannelTracker==="undefined"){BX.CrmChannelTracker=function(){this._id="";this._settings={};this._config={};this._container=null;this._bodyContainer=null;this._toggleButton=null;this._helpButton=null;this._helpPopup=null;this._groups=null;this._toggle=null;this._isExpanded=true};BX.CrmChannelTracker.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:Math.random().toString().substring(2);this._settings=e?e:{};this._config=this.getSetting("config",{});this._isExpanded=this._config["expanded"]==="Y";this._container=BX(this.getSetting("containerId",""));if(!BX.type.isElementNode(this._container)){throw"BX.CrmChannelTracker. Could not find container."}this._bodyContainer=this._container.querySelector(".startpage-table-data-body");if(!BX.type.isElementNode(this._bodyContainer)){throw"BX.CrmChannelTracker. Could not find body container."}this._toggleButton=BX(this.getSetting("toggleButtonId",""));if(BX.type.isElementNode(this._toggleButton)){BX.bind(this._toggleButton,"click",BX.delegate(this.onToggleButtonClick,this))}this._helpButton=BX(this.getSetting("helpButtonId",""));if(BX.type.isElementNode(this._helpButton)){BX.bind(this._helpButton,"click",BX.delegate(this.onHelpButtonClick,this))}this._serviceUrl=this.getSetting("serviceUrl","");this._groups={};var i=this._container.querySelectorAll("[data-group]");for(var n=0,s=i.length;n<s;n++){var r=i[n];var o=r.getAttribute("data-group");if(BX.type.isNotEmptyString(o)){this._groups[o]=BX.CrmChannelTrackerGroup.create(o,{parent:this,container:r})}}this._toggle=BX.CrmChannelTrackerToggle.create({target:this});this.ajustFontSize(this._container.querySelectorAll(".startpage-table-header-block-count-wrapper"));BX.bind(window,"resize",BX.delegate(this.onWidowResize,this))},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){var e=BX.CrmChannelTracker.messages;return e.hasOwnProperty(t)?e[t]:t},getContainer:function(){return this._container},getBodyContainer:function(){return this._bodyContainer},isExpanded:function(){return this._isExpanded},setExpanded:function(t){t=!!t;if(this._isExpanded===t){return}this._config["expanded"]=(this._isExpanded=t)?"Y":"N";if(t){this._toggleButton.innerHTML=this.getMessage("minimize")}else{this._toggleButton.innerHTML=this.getMessage("maximize")}this._toggle.toggle();this.saveConfig()},saveConfig:function(){var t={guid:this._id,action:"saveconfig",config:this._config};BX.ajax.post(this._serviceUrl,t)},ajustFontSize:function(t){var e=0;var i=0;var n=true;var s=true;var r=31;if(!t){return}var o=50;for(var a=0;a<t.length;a++){e=parseInt(BX.style(t[a],"font-size"));n=t[a].offsetWidth>t[a].parentNode.offsetWidth-o;s=t[a].offsetWidth<t[a].parentNode.offsetWidth-o;while(t[a].offsetWidth>t[a].parentNode.offsetWidth-o&&n){e-=2;t[a].style.fontSize=e+"px";t[a].style.lineHeight=e+8+"px";s=false}while(t[a].offsetWidth<t[a].parentNode.offsetWidth-o&&e<r&&s){e+=2;t[a].style.fontSize=e+"px";t[a].style.lineHeight=e+8+"px";n=false}if(!i&&a>0)i=e;if(a>0)i=Math.min(i,e)}for(var l=0;l<t.length;l++){t[l].style.opacity=1;if(l>0){t[l].style.fontSize=i+"px";t[l].style.lineHeight=i+8+"px"}}},ajustInterlacing:function(){var t=this._container.querySelectorAll(".startpage-table-interlacing");for(var e=0,i=t.length;e<i;e++){var n=t[e];if((e+1)%2===0){if(!BX.hasClass(n,"even")){BX.addClass(n,"even");BX.removeClass(n,"odd")}}else{if(!BX.hasClass(n,"odd")){BX.addClass(n,"odd");BX.removeClass(n,"even")}}}},onToggleButtonClick:function(t){if(!t){t=window.event}this.setExpanded(!this.isExpanded());return BX.PreventDefault(t)},onToggleStart:function(t){if(this._isExpanded){BX.removeClass(this._container,"collapse")}},onToggleFinish:function(t){if(!this._isExpanded){BX.addClass(this._container,"collapse")}},onHelpButtonClick:function(t){if(!t){t=window.event}if(!this.isHelpPopupOpened()){this.openHelpPopup()}else{this.closeHelpPopup()}return BX.PreventDefault(t)},isHelpPopupOpened:function(){return this._helpPopup!==null&&this._helpPopup.isShown()},openHelpPopup:function(){if(this._helpPopup===null){this._helpPopup=BX.PopupWindowManager.create(this._id+"_help",this._helpButton,{autoHide:true,closeByEsc:false,offsetTop:-5,offsetLeft:18,bindOptions:{position:"bottom"},angle:{position:"top"},events:{onPopupClose:BX.delegate(this.onHelpPopupClose,this)},content:BX.create("DIV",{attrs:{className:"crm-popup-contents"},children:[BX.create("SPAN",{attrs:{className:"startpage-help-popup-title"},text:this.getMessage("helpTitle")}),BX.create("DIV",{attrs:{className:"startpage-help-popup-content"},html:this.getMessage("helpContent")})]})})}this._helpPopup.show()},closeHelpPopup:function(){if(this._helpPopup!==null){this._helpPopup.close()}},onHelpPopupClose:function(){if(this._helpPopup){this._helpPopup.destroy();this._helpPopup=null}},onWidowResize:function(t){this.ajustFontSize(this._container.querySelectorAll(".startpage-table-header-block-count-wrapper"))}};if(typeof BX.CrmChannelTracker.messages==="undefined"){BX.CrmChannelTracker.messages={}}BX.CrmChannelTracker.create=function(t,e){var i=new BX.CrmChannelTracker;i.initialize(t,e);return i}}if(typeof BX.CrmChannelTrackerGroup==="undefined"){BX.CrmChannelTrackerGroup=function(){this._id="";this._settings={};this._parent=null;this._container=null;this._itemContainer=null;this._toggleButton=null;this._toggle=null;this._isExpanded=false};BX.CrmChannelTrackerGroup.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._parent=this.getSetting("parent",null);if(!(this._parent instanceof BX.CrmChannelTracker)){throw"BX.CrmChannelTrackerGroup. Could not find 'parent' parameter."}this._container=this.getSetting("container",null);if(!BX.type.isElementNode(this._container)){this._container=this._parent.getContainer().querySelector("[data-group='"+this._id+"']");if(!BX.type.isElementNode(this._container)){throw"BX.CrmChannelTrackerGroup. Could not find group container."}}this._itemContainer=this.getSetting("itemContainer",null);if(!BX.type.isElementNode(this._itemContainer)){this._itemContainer=this._parent.getContainer().querySelector("[data-group-items='"+this._id+"']");if(!BX.type.isElementNode(this._itemContainer)){throw"BX.CrmChannelTrackerGroup. Could not find group item container."}}this._toggleButton=this._container.querySelector(".startpage-table-data-children-toggle");if(!BX.type.isElementNode(this._toggleButton)){throw"BX.CrmChannelTrackerGroup. Could not find toggle button."}BX.bind(this._toggleButton,"click",BX.delegate(this.onToggleButtonClick,this));this._toggle=BX.CrmChannelTrackerGroupToggle.create({target:this})},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getContainer:function(){return this._container},getItemContainer:function(){return this._itemContainer},isExpanded:function(){return this._isExpanded},ajustInterlacing:function(){var t,e;var i=this._itemContainer.querySelectorAll(".startpage-table-data");if(this._isExpanded){for(t=0,e=i.length;t<e;t++){BX.addClass(i[t],"startpage-table-interlacing")}}else{for(t=0,e=i.length;t<e;t++){BX.removeClass(i[t],"startpage-table-interlacing")}}this._parent.ajustInterlacing()},toggle:function(){this._isExpanded=!this._isExpanded;this.ajustInterlacing();this._toggle.toggle()},onToggleButtonClick:function(t){this.toggle()},onToggleStart:function(t){if(this._isExpanded){BX.removeClass(this._container,"collapse");BX.removeClass(this._itemContainer,"collapse")}},onToggleFinish:function(t){if(!this._isExpanded){BX.addClass(this._container,"collapse");BX.addClass(this._itemContainer,"collapse")}}};BX.CrmChannelTrackerGroup.create=function(t,e){var i=new BX.CrmChannelTrackerGroup;i.initialize(t,e);return i}}if(typeof BX.CrmChannelTrackerToggle==="undefined"){BX.CrmChannelTrackerToggle=function(){this._settings={};this._target=null};BX.CrmChannelTrackerToggle.prototype={initialize:function(t){this._settings=t?t:{};this._target=this.getSetting("target");if(!(this._target instanceof BX.CrmChannelTracker)){throw"BX.CrmChannelTrackerToggle. Could not find 'target' parameter."}},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},easing:function(t){this._target.onToggleStart(this);new BX.easing({duration:1e3,start:{height:t.start},finish:{height:t.finish},transition:BX.easing.makeEaseOut(BX.easing.transitions.circ),step:BX.delegate(this.step,this),complete:BX.proxy(this.complete,this)}).animate()},toggle:function(){var t=this._target.getBodyContainer();t.style.overflow="hidden";if(this._target.isExpanded()){this.easing({start:0,finish:t.scrollHeight})}else{this.easing({start:t.offsetHeight,finish:0})}},step:function(t){this._target.getBodyContainer().style.height=t.height+"px"},complete:function(){this._target.onToggleFinish(this);var t=this._target.getBodyContainer();t.style.overflow="";t.style.height=""}};BX.CrmChannelTrackerToggle.create=function(t){var e=new BX.CrmChannelTrackerToggle;e.initialize(t);return e}}if(typeof BX.CrmChannelTrackerGroupToggle==="undefined"){BX.CrmChannelTrackerGroupToggle=function(){this._settings={};this._target=null};BX.CrmChannelTrackerGroupToggle.prototype={initialize:function(t){this._settings=t?t:{};this._target=this.getSetting("target");if(!(this._target instanceof BX.CrmChannelTrackerGroup)){throw"BX.CrmChannelTrackerGroupToggle. Could not find 'target' parameter."}},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},easing:function(t){this._target.onToggleStart(this);new BX.easing({duration:500,start:{height:t.start},finish:{height:t.finish},transition:BX.easing.makeEaseOut(BX.easing.transitions.circ),step:BX.delegate(this.step,this),complete:BX.proxy(this.complete,this)}).animate()},toggle:function(){var t=this._target.getItemContainer();if(this._target.isExpanded()){this.easing({start:0,finish:t.scrollHeight})}else{this.easing({start:t.offsetHeight,finish:0})}},step:function(t){this._target.getItemContainer().style.height=t.height+"px"},complete:function(){this._target.onToggleFinish(this);var t=this._target.getItemContainer();t.style.height=""}};BX.CrmChannelTrackerGroupToggle.create=function(t){var e=new BX.CrmChannelTrackerGroupToggle;e.initialize(t);return e}}
//# sourceMappingURL=script.map.js