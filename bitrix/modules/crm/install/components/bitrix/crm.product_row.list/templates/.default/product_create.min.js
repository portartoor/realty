if(typeof BX.CrmProductCreateDialog==="undefined"){BX.CrmProductCreateDialog=function(t){this.settings=t;this.messages=t["messages"];this.random=Math.random().toString().substring(2);this.popupContentId="";this.errorContainerId="";this.popup=null;this.initialControl=this.settings["initialControl"]};BX.CrmProductCreateDialog.prototype={show:function(){var t=this;var e=996;var a=BX.create("TABLE",{attrs:{id:this.random+"_table",cellspacing:"7"}});var i=this.settings["fields"];var r=this.settings["messages"];var s,o,n,c,l,d,p,u,f;var h=[],m,g;f={};u=this.settings["customValues"]&&typeof this.settings["customValues"]==="object";if(u){f=this.settings["customValues"]}m=0;for(var v=0;v<i.length;v++){p=i[v]["value"];if(u&&f.hasOwnProperty(i[v]["textCode"]))p=f[i[v]["textCode"]];if(i[v]["skip"]==="Y")continue;n=i[v]["type"];d=parseInt(i[v]["maxLength"]);c=40;l=4;switch(n){case"select":var x={};if(i[v]["params"]&&typeof i[v]["params"]==="object"){var C=i[v]["params"];for(var B in C){if(C.hasOwnProperty(B))x[B]=C[B]}}x["id"]=this.random+"_"+v;x["className"]="bx-crm-dialog-quick-create-field-select";x["name"]=i[v]["textCode"];s=BX.create("SELECT",{style:{marginLeft:"10px"},attrs:x});this.rebuildSelect(s,i[v]["items"],p);break;case"checkbox":s=BX.create("INPUT",{style:{marginLeft:"10px"},attrs:{id:this.random+"_"+v,type:n,name:i[v]["textCode"]}});s.checked=p==="Y";break;case"textarea":s=BX.create("TEXTAREA",{style:{marginLeft:"10px"},attrs:{id:this.random+"_"+v,className:"bx-crm-dialog-quick-create-field-text-input",type:n,name:i[v]["textCode"],text:BX.util.htmlspecialchars(p),cols:c,rows:l,maxlength:d>0?d:7500}});break;case"custom":var T=BX.processHTML(p);s=BX.create("DIV",{style:{marginLeft:"10px"},attrs:{id:this.random+"_"+v,className:"bx-crm-dialog-quick-create-field-custom"},html:T["HTML"]});var X=[],y=0;for(y=0;y<T["SCRIPT"].length;y++){X[y]={TYPE:T["SCRIPT"][y].isInternal?"SCRIPT":"SCRIPT_EXT",DATA:T["SCRIPT"][y].JS}}g={scripts:X,styles:T["STYLE"]};h[m++]=g;break;default:s=BX.create("INPUT",{style:{marginLeft:"10px"},attrs:{id:this.random+"_"+v,className:"bx-crm-dialog-quick-create-field-text-input",type:n,name:i[v]["textCode"],value:p,size:c,maxlength:d>0?d:255}});break}var I=BX.create("TD");if("Y"===i[v]["required"])I.appendChild(BX.create("SPAN",{attrs:{style:"position: absolute; left: 18px; color: red;"},text:"*"}));I.appendChild(BX.create("SPAN",{text:r[i[v]["textCode"]]+":"}));a.appendChild(BX.create("TR",{children:[I,BX.create("TD",{children:[s]})]}))}var b=BX.create("DIV",{attrs:{id:this.random+"_error",className:"bx-crm-dialog-quick-create-error-wrap"}});var w=BX.create("DIV",{style:{marginLeft:"12px",marginTop:"12px",marginRight:"12px",marginBottom:"12px",minWidth:"600px"},attrs:{id:this.random+"_content"},children:[b,a]});var P=this.settings["url"]?BX.util.trim(this.settings["url"].toString()):"/crm/product/edit/0/";var D=BX.create("FORM",{attrs:{id:this.settings["formId"],name:this.settings["formId"],method:"POST",action:P,enctype:"multipart/form-data"}});var A=BX.create("INPUT",{attrs:{type:"hidden",name:"sessid",value:this.settings["sessid"]}});if(A)D.appendChild(A);A=BX.create("INPUT",{attrs:{type:"hidden",name:"ajaxSubmit",value:"Y"}});if(A)D.appendChild(A);A=BX.create("INPUT",{attrs:{type:"hidden",name:"currencyTo",value:this.settings["ownerCurrencyId"]}});if(A)D.appendChild(A);A=null;D.appendChild(w);var E=new BX.PopupWindow("CrmProductCreateDialog_"+this.random,this.initialControl,{overlay:{opacity:10},autoHide:false,draggable:true,offsetLeft:0,offsetTop:0,zIndex:e-1100,bindOptions:{forceBindPosition:false},closeByEsc:true,closeIcon:{top:"10px",right:"15px"},titleBar:this.messages["dialogTitle"],events:{onPopupClose:function(){if(E){E.destroy()}}},content:D,buttons:[new BX.PopupWindowButton({text:this.messages["buttonCreateTitle"],className:"popup-window-button-accept",events:{click:function(){if(E){if(w){t.popupContentId=w.id;t.errorContainerId=b.id;t.popup=E;t.createProduct()}}}}}),new BX.PopupWindowButtonLink({text:this.messages["buttonCancelTitle"],className:"popup-window-button-link-cancel",events:{click:function(){if(E)E.close()}}})]});for(m=0;m<h.length;m++){if(h[m]["scripts"].length>0)BX.evalPack(h[m]["scripts"]);if(h[m]["styles"].length>0)BX.loadCSS(h[m]["styles"])}E.show();if(E.popupContainer)BX.scrollToNode(E.popupContainer)},createProduct:function(){var t=BX(this.settings["formId"]);BX.ajax.submitAjax(t,{method:"POST",processData:false,onsuccess:BX.delegate(function(t){if(t===""){BX.closeWait();this.showAjaxError("")}var e=BX.parseJSON(t,{});if(!e){BX.closeWait();this.showAjaxError("")}var a=0,i="";BX.closeWait();i=e["err"]!==""?e["err"]:"";a=parseInt(e["productId"])>0?parseInt(e["productId"]):0;if(a>0){if(this.popup){this.popup.close();this.popup=null}if(typeof e["productData"]!=="undefined"){var r=e["productData"];if(typeof r["NAME"]!=="undefined"&&typeof r["PRICE"]!=="undefined"&&typeof(this.settings["productAdditionHandler"]==="function")){var s=this.settings["productAdditionHandler"];var o={product:[{id:a,title:r["NAME"],customData:{price:r["PRICE"],tax:{}}}]};if(typeof r["VAT_ID"]!=="undefined")o["product"][0]["customData"]["tax"]["id"]=r["VAT_ID"];if(typeof r["VAT_INCLUDED"]!=="undefined")o["product"][0]["customData"]["tax"]["included"]=r["VAT_INCLUDED"]==="Y";if(e["measureData"]&&typeof e["measureData"]==="object"){var n=e["measureData"];if(n["code"]&&parseInt(n["code"])>0&&n["name"]){o["product"][0]["customData"]["measure"]={code:n["code"],name:n["name"]}}}s(o)}}}else{this.showAjaxError(i)}},this),onfailure:BX.delegate(function(t){BX.closeWait();this.showAjaxError("")},this)})},showAjaxError:function(t){if(t==="")t=this.messages["ajaxError"];var e=BX(this.errorContainerId);if(e){e.innerHTML=t}if(this.popup.popupContainer)BX.scrollToNode(this.popup.popupContainer)},setSelectValue:function(t,e){var a,i;var r=false;var s=!!t.getAttribute("multiple");if(!(e instanceof Array))e=[e];for(a=0;a<t.options.length;a++){for(i in e){if(t.options[a].value==e[i]){if(!r){r=true;t.selectedIndex=a}t.options[a].selected=true;break}}if(!s&&r)break}},rebuildSelect:function(t,e,a){var i,r,s,o;var n=false;var c;if(!(a instanceof Array))a=[a];if(t){c=!!t.getAttribute("multiple");while(i=t.lastChild)t.removeChild(i);for(s=0;s<e.length;s++){r=document.createElement("option");r.value=e[s]["id"];r.innerHTML=BX.util.htmlspecialchars(e[s]["title"]);try{t.add(r,t.options[null])}catch(l){r=document.createElement("option");r.text=e[s]["title"];t.add(r,null)}if(!n||c){for(o=0;o<a.length;o++){if(e[s]["id"]==a[o]){r.selected=true;if(!n){n=true;t.selectedIndex=s}break}}}}}}}}if(typeof addNewTableRow==="undefined"){function addNewTableRow(t,e,a,i){var r=document.getElementById(t);var s=r.rows.length;var o=r.insertRow(s);for(var n=0;n<e;n++){var c=o.insertCell(n);var l=r.rows[s-1].cells[n].innerHTML;c.innerHTML=l.replace(a,function(t){return t.replace("[n"+arguments[i]+"]","[n"+(1+parseInt(arguments[i]))+"]")})}}}
//# sourceMappingURL=product_create.map.js