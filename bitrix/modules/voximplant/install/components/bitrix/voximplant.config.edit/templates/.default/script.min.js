(function(e){if(!!e.BX.VoxImplantConfigEdit)return;var t=function(e,t){this.p=!!e?e:{};if(!!e["SELECTED"]){var i={},n,a;for(n in e["SELECTED"]){if(e["SELECTED"].hasOwnProperty(n)&&typeof e["SELECTED"][n]=="object"){for(a in e["SELECTED"][n]){if(e["SELECTED"][n].hasOwnProperty(a)){if(n=="USERS")i["U"+e["SELECTED"][n][a]]="users";else if(n=="SG")i["SG"+e["SELECTED"][n][a]]="sonetgroups";else if(n=="DR")i["DR"+e["SELECTED"][n][a]]="department"}}}}this.p["SELECTED"]=i}this.nodes={};var s=function(e,t){var i={},n,a,l;if(t[e]){for(l in t[e]){if(t[e].hasOwnProperty(l)){n=t[e][l];a=[];if(t[n]&&t[n].length>0)a=s(n,t);i[n]={id:n,type:"category",items:a}}}}return i},l=function(e){var t={},i;for(var n in e){if(e.hasOwnProperty(n)){i=e[n]["parent"];if(!t[i])t[i]=[];t[i][t[i].length]=n}}return s("DR0",t)};if(true||t=="users"){this.params={name:null,searchInput:null,extranetUser:this.p["EXTRANET_USER"]=="Y",bindMainPopup:{node:null,offsetTop:"5px",offsetLeft:"15px"},bindSearchPopup:{node:null,offsetTop:"5px",offsetLeft:"15px"},departmentSelectDisable:true,callback:{select:BX.delegate(this.select,this),unSelect:BX.delegate(this.unSelect,this),openDialog:BX.delegate(this.openDialog,this),closeDialog:BX.delegate(this.closeDialog,this),openSearch:BX.delegate(this.openDialog,this),closeSearch:BX.delegate(this.closeSearch,this)},items:{users:!!this.p["USERS"]?this.p["USERS"]:{},groups:{},sonetgroups:{},department:!!this.p["DEPARTMENT"]?this.p["DEPARTMENT"]:{},departmentRelation:!!this.p["DEPARTMENT"]?l(this.p["DEPARTMENT"]):{},contacts:{},companies:{},leads:{},deals:{}},itemsLast:{users:!!this.p["LAST"]&&!!this.p["LAST"]["USERS"]?this.p["LAST"]["USERS"]:{},sonetgroups:{},department:{},groups:{},contacts:{},companies:{},leads:{},deals:{},crm:[]},itemsSelected:!!this.p["SELECTED"]?BX.clone(this.p["SELECTED"]):{},isCrmFeed:false,destSort:!!this.p["DEST_SORT"]?BX.clone(this.p["DEST_SORT"]):{}}}},i=null;t.prototype={setInput:function(e,t){e=BX(e);if(!!e&&!e.hasAttribute("bx-destination-id")){var i="destination"+(""+(new Date).getTime()).substr(6),a;e.setAttribute("bx-destination-id",i);a=new n(i,e,t);this.nodes[i]=e;BX.defer_proxy(function(){this.params.name=a.id;this.params.searchInput=a.nodes.input;this.params.bindMainPopup.node=a.nodes.container;this.params.bindSearchPopup.node=a.nodes.container;BX.SocNetLogDestination.init(this.params)},this)()}},select:function(t,i,n,a,s){var l=i,o="S";if(i=="groups"){l="all-users"}else if(BX.util.in_array(i,["contacts","companies","leads","deals"])){l="crm"}if(i=="sonetgroups"){o="SG"}else if(i=="groups"){o="UA"}else if(i=="users"){o="U"}else if(i=="department"){o="DR"}else if(i=="contacts"){o="CRMCONTACT"}else if(i=="companies"){o="CRMCOMPANY"}else if(i=="leads"){o="CRMLEAD"}else if(i=="deals"){o="CRMDEAL"}var r=a?" bx-destination-undelete":"";r+=i=="sonetgroups"&&typeof e["arExtranetGroupID"]!="undefined"&&BX.util.in_array(t.entityId,e["arExtranetGroupID"])?" bx-destination-extranet":"";var d=BX.create("span",{attrs:{"data-id":t.id},props:{className:"bx-destination bx-destination-"+l+r},children:[BX.create("span",{props:{className:"bx-destination-text"},html:t.name})]});if(!a){d.appendChild(BX.create("span",{props:{className:"bx-destination-del-but"},events:{click:function(e){BX.SocNetLogDestination.deleteItem(t.id,i,s);BX.PreventDefault(e)},mouseover:function(){BX.addClass(this.parentNode,"bx-destination-hover")},mouseout:function(){BX.removeClass(this.parentNode,"bx-destination-hover")}}}))}BX.onCustomEvent(this.nodes[s],"select",[t,d,o])},unSelect:function(e,t,i,n){BX.onCustomEvent(this.nodes[n],"unSelect",[e])},openDialog:function(e){BX.onCustomEvent(this.nodes[e],"openDialog",[])},closeDialog:function(e){if(!BX.SocNetLogDestination.isOpenSearch()){BX.onCustomEvent(this.nodes[e],"closeDialog",[]);this.disableBackspace()}},closeSearch:function(e){if(!BX.SocNetLogDestination.isOpenSearch()){BX.onCustomEvent(this.nodes[e],"closeSearch",[]);this.disableBackspace()}},disableBackspace:function(){if(BX.SocNetLogDestination.backspaceDisable||BX.SocNetLogDestination.backspaceDisable!==null)BX.unbind(e,"keydown",BX.SocNetLogDestination.backspaceDisable);BX.bind(e,"keydown",BX.SocNetLogDestination.backspaceDisable=function(e){if(e.keyCode==8){BX.PreventDefault(e);return false}return true});setTimeout(function(){BX.unbind(e,"keydown",BX.SocNetLogDestination.backspaceDisable);BX.SocNetLogDestination.backspaceDisable=null},5e3)}};var n=function(e,t,i){this.node=t;this.id=e;this.inputName=i;this.node.appendChild(BX.create("SPAN",{props:{className:"bx-destination-wrap"},html:['<span id="',this.id,'-container"><span class="bx-destination-wrap-item"></span></span>','<span class="bx-destination-input-box" id="',this.id,'-input-box">','<input type="text" value="" class="bx-destination-input" id="',this.id,'-input">',"</span>",'<a href="#" class="bx-destination-add" id="',this.id,'-add-button"></a>'].join("")}));BX.defer_proxy(this.bind,this)()};n.prototype={bind:function(){this.nodes={inputBox:BX(this.id+"-input-box"),input:BX(this.id+"-input"),container:BX(this.id+"-container"),button:BX(this.id+"-add-button")};BX.bind(this.nodes.input,"keyup",BX.proxy(this.search,this));BX.bind(this.nodes.input,"keydown",BX.proxy(this.searchBefore,this));BX.bind(this.nodes.button,"click",BX.proxy(function(e){BX.SocNetLogDestination.openDialog(this.id);BX.PreventDefault(e)},this));BX.bind(this.nodes.container,"click",BX.proxy(function(e){BX.SocNetLogDestination.openDialog(this.id);BX.PreventDefault(e)},this));this.onChangeDestination();BX.addCustomEvent(this.node,"select",BX.proxy(this.select,this));BX.addCustomEvent(this.node,"unSelect",BX.proxy(this.unSelect,this));BX.addCustomEvent(this.node,"delete",BX.proxy(this.delete,this));BX.addCustomEvent(this.node,"openDialog",BX.proxy(this.openDialog,this));BX.addCustomEvent(this.node,"closeDialog",BX.proxy(this.closeDialog,this));BX.addCustomEvent(this.node,"closeSearch",BX.proxy(this.closeSearch,this))},select:function(e,t,i){if(!BX.findChild(this.nodes.container,{attr:{"data-id":e.id}},false,false)){t.appendChild(BX.create("INPUT",{props:{type:"hidden",name:this.inputName+"["+i+"][]",value:e.id}}));this.nodes.container.appendChild(t)}this.onChangeDestination()},unSelect:function(e){var t=BX.findChildren(this.nodes.container,{attribute:{"data-id":""+e.id+""}},true);if(t!==null){for(var i=0;i<t.length;i++)BX.remove(t[i])}this.onChangeDestination()},onChangeDestination:function(){this.nodes.input.innerHTML="";this.nodes.button.innerHTML=BX.SocNetLogDestination.getSelectedCount(this.id)<=0?BX.message("LM_ADD1"):BX.message("LM_ADD2")},openDialog:function(){BX.style(this.nodes.inputBox,"display","inline-block");BX.style(this.nodes.button,"display","none");BX.focus(this.nodes.input)},closeDialog:function(){if(this.nodes.input.value.length<=0){BX.style(this.nodes.inputBox,"display","none");BX.style(this.nodes.button,"display","inline-block");this.nodes.input.value=""}},closeSearch:function(){if(this.nodes.input.value.length>0){BX.style(this.nodes.inputBox,"display","none");BX.style(this.nodes.button,"display","inline-block");this.nodes.input.value=""}},searchBefore:function(e){if(e.keyCode==8&&this.nodes.input.value.length<=0){BX.SocNetLogDestination.sendEvent=false;BX.SocNetLogDestination.deleteLastItem(this.id)}return true},search:function(e){if(e.keyCode==16||e.keyCode==17||e.keyCode==18||e.keyCode==20||e.keyCode==244||e.keyCode==224||e.keyCode==91)return false;if(e.keyCode==13){BX.SocNetLogDestination.selectFirstSearchItem(this.id);return true}if(e.keyCode==27){this.nodes.input.value="";BX.style(this.nodes.button,"display","inline")}else{BX.SocNetLogDestination.search(this.nodes.input.value,true,this.id)}if(!BX.SocNetLogDestination.isOpenDialog()&&this.nodes.input.value.length<=0){BX.SocNetLogDestination.openDialog(this.id)}else if(BX.SocNetLogDestination.sendEvent&&BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.closeDialog()}if(e.keyCode==8){BX.SocNetLogDestination.sendEvent=true}return true}};e.BX.VoxImplantConfigEdit={ajaxUrl:"/bitrix/components/bitrix/voximplant.config.edit/ajax.php",popupTooltip:{},settingsOpened:false,bindEvents:function(){BX.bind(BX("vi_crm_forward"),"change",function(e){if(BX("vi_crm_forward").checked)BX("vi_crm_rule").style.height="40px";else BX("vi_crm_rule").style.height="0"});var t=BX("input-direct_code");if(t){BX.bind(BX("input-direct_code"),"change",function(e){if(BX("input-direct_code").checked)BX("vi-direct-code-rule").style.height="40px";else BX("vi-direct-code-rule").style.height="0"})}BX.bind(BX("vi-group-show-config"),"click",BX.VoxImplantConfigEdit.onShowSettingsClick);BX.bind(BX("vi-group-id-select"),"change",BX.VoxImplantConfigEdit._onGroupIdChanged);BX.addCustomEvent(e,"onViGroupSaved",BX.VoxImplantConfigEdit._onGroupSaved);BX.addCustomEvent(e,"onViGroupEditCanceled",BX.VoxImplantConfigEdit._onViGroupEditCanceled)},initDestination:function(e,n,a){if(i===null)i=new t(a);i.setInput(BX(e),n)},loadMelody:function(t,i){if(typeof i!=="object")return;var n=i.INPUT_NAME||"",a=i.DEFAULT_MELODY||"",s=BX["MFInput"]?BX.MFInput.get(t):null;BX.bind(BX("config_edit_form").elements["MELODY_LANG"],"change",function(){if(!(!!BX("config_edit_form").elements[n]&&!!BX("config_edit_form").elements[n]))e.jwplayer(t+"player_div").load([{file:a.replace("#LANG_ID#",this.value)}])});BX(t+"span").appendChild(BX("file_input_"+t));if(s){BX.bind(BX(t+"default"),"click",function(){s.clear()});BX.addCustomEvent(s,"onDeleteFile",function(){BX.hide(BX(t+"default"));BX.show(BX(t+"notice"));e.jwplayer(t+"player_div").load([{file:a.replace("#LANG_ID#",BX("config_edit_form").elements["MELODY_LANG"].value)}])});BX.addCustomEvent(s,"onUploadDone",function(i,n){BX.show(BX(t+"default"));BX.hide(BX(t+"notice"));if(!!e["jwplayer"]){e.jwplayer(t+"player_div").load([{file:i["url"]+(i["url"].indexOf(".mp3")>0?"":"&/melody.mp3")}])}})}else{BX.bind(BX(t+"default"),"click",function(){e["FILE_INPUT_"+t]._deleteFile(BX("config_edit_form").elements[n])});BX.addCustomEvent(e["FILE_INPUT_"+t],"onSubmit",function(){BX(t+"span").appendChild(BX.create("SPAN",{attrs:{id:t+"waiter"},props:{className:"webform-field-upload-list"},html:"<i></i>"}))});BX.addCustomEvent(e["FILE_INPUT_"+t],"onFileUploaderChange",function(){e["FILE_INPUT_"+t].INPUT.disabled=false});BX.addCustomEvent(e["FILE_INPUT_"+t],"onDeleteFile",function(i){BX.hide(BX(t+"default"));BX(t+"notice").innerHTML=BX.message("VI_CONFIG_EDIT_DOWNLOAD_TUNE_TIP");e.jwplayer(t+"player_div").load([{file:a.replace("#LANG_ID#",BX("config_edit_form").elements["MELODY_LANG"].value)}]);e["FILE_INPUT_"+t].INPUT.disabled=false});BX.addCustomEvent(e["FILE_INPUT_"+t],"onDone",function(i,n,a){BX.remove(BX(t+"waiter"));if(!!i&&i.length>0){var s=BX(t+"notice");if(a===false&&!!i[0]){if(n!="init"){s.innerHTML=BX.message("VI_CONFIG_EDIT_UPLOAD_SUCCESS");if(!!e["jwplayer"]){e.jwplayer(t+"player_div").load([{file:i[0]["fileURL"]}])}BX(t+"default").style.display=""}}else if(!!i[0]&&i[0]["error"]){s.innerHTML=i[0]["error"]}}})}},showTooltip:function(e,t,i){if(this.popupTooltip[e])this.popupTooltip[e].close();this.popupTooltip[e]=new BX.PopupWindow("bx-voximplant-tooltip",t,{lightShadow:true,autoHide:false,darkMode:true,offsetLeft:0,offsetTop:2,bindOptions:{position:"top"},zIndex:200,events:{onPopupClose:function(){this.destroy()}},content:BX.create("div",{attrs:{style:"padding-right: 5px; width: 250px;"},html:i})});this.popupTooltip[e].setAngle({offset:13,position:"bottom"});this.popupTooltip[e].show();return true},hideTooltip:function(e){this.popupTooltip[e].close();this.popupTooltip[e]=null},onShowSettingsClick:function(e){if(BX.VoxImplantConfigEdit.settingsOpened)BX.VoxImplantConfigEdit.hideGroupSetting();else BX.VoxImplantConfigEdit.showGroupSetting({groupId:BX("vi-group-id-select").value})},showGroupSetting:function(e){BX.VoxImplantConfigEdit.settingsOpened=true;var t=BX("vi-group-settings-placeholder");var i=e.groupId;var n=BX("vi-group-show-config");n.innerText=BX.message("VI_CONFIG_GROUP_SETTINGS_HIDE");var a=BX("vi-group-id-select");a.disabled=true;var s={sessid:BX.bitrix_sessid(),GROUP_SETTINGS:"Y",ID:i};BX.ajax({url:BX.VoxImplantConfigEdit.ajaxUrl,method:"POST",dataType:"html",data:s,onsuccess:function(e){t.innerHTML=e;t.style.maxHeight="800px"}})},hideGroupSetting:function(){var e=BX("vi-group-settings-placeholder");var t=BX("vi-group-show-config");t.innerText=BX.message("VI_CONFIG_GROUP_SETTINGS");var i=BX("vi-group-id-select");i.disabled=false;e.style.maxHeight=0;setTimeout(function(){BX.VoxImplantConfigEdit.settingsOpened=false;e.innerHTML=""},300)},_onGroupIdChanged:function(e){var t=e.target.value;if(t==="new"){BX.VoxImplantConfigEdit.showGroupSetting({groupId:0})}BX.PreventDefault(e)},_onGroupSaved:function(e){BX.VoxImplantConfigEdit.hideGroupSetting();var t=e.GROUP;if(!t.ID)return;var i=BX("vi-group-id-select");var n=false;var a;for(var s=0;s<i.options.length;s++){a=i.options.item(s);if(a.value==t.ID){a.innerText=BX.util.htmlspecialchars(t.NAME);n=true;break}}if(!n){i.add(BX.create("option",{attrs:{value:t.ID},text:BX.util.htmlspecialchars(t.NAME)}))}i.value=t.ID},_onViGroupEditCanceled:function(){BX.VoxImplantConfigEdit.hideGroupSetting()}};BX.ready(function(){var e=BX.findChildrenByClassName(BX("tel-set-main-wrap"),"tel-context-help");for(var t=0;t<e.length;t++){e[t].setAttribute("data-id",t);BX.bind(e[t],"mouseover",function(){var e=this.getAttribute("data-id");var t=this.getAttribute("data-text");BX.VoxImplantConfigEdit.showTooltip(e,this,t)});BX.bind(e[t],"mouseout",function(){var e=this.getAttribute("data-id");BX.VoxImplantConfigEdit.hideTooltip(e)})}});BX.ViCallerId={ajaxUrl:"/bitrix/components/bitrix/voximplant.config.edit/ajax.php"};BX.ViCallerId.init=function(e){BX.ViCallerId.inputNumber=e.number;BX.ViCallerId.placeholder=e.placeholder;BX.ViCallerId.number=e.number;BX.ViCallerId.verified=e.verified;BX.ViCallerId.verifiedUntil=e.verifiedUntil;BX.ViCallerId.phoneInput=null;BX.ViCallerId.codeInput=null;BX.ViCallerId.codeError=null;BX.ViCallerId.phoneNotice=null;BX.ViCallerId.blockAjax=false;BX.ViCallerId.blockVerify=false;BX.ViCallerId.drawState();BX.bind(BX("vi_link_options"),"click",function(e){if(BX("vi_link_options_div").style.display=="none"){BX.removeClass(BX(this),"webform-button-create");BX("vi_link_options_div").style.display="block"}else{BX.addClass(BX(this),"webform-button-create");BX("vi_link_options_div").style.display="none"}BX.PreventDefault(e)})};BX.ViCallerId.drawState=function(e){var t=null;var i=null;var n=null;var a=null;e=typeof e=="object"?e:{};e.state=e.state?parseInt(e.state):1;if(e.state==1){t=BX.create("div",{props:{className:"tel-new-num-form"},children:[BX.create("span",{props:{className:"tel-balance-phone-icon"}}),BX.create("a",{props:{attrs:{href:"#put-phone"},className:"tel-balance-phone-url"},events:{click:function(e){BX.ViCallerId.drawState({state:BX.ViCallerId.number.length<=0?2:3});return BX.PreventDefault(e)}},html:BX.ViCallerId.number.length<=0?BX.message("TELEPHONY_PUT_PHONE"):BX.message("TELEPHONY_VERIFY_PHONE")}),BX.ViCallerId.number.length<=0?null:BX.create("span",{props:{className:"tel-num-change-text"},html:" "+BX.message("TELEPHONY_OR")}),BX.ViCallerId.number.length<=0?null:BX.create("a",{props:{attrs:{href:"#change-phone"},className:"tel-balance-phone-url"},events:{click:function(e){BX.ViCallerId.removePhone();return BX.PreventDefault(e)}},html:BX.message("TELEPHONY_PUT_PHONE_AGAING")})]})}else if(e.state==2||e.state==3){t=BX.create("div",{attrs:{id:"tel-new-num-form"},props:{className:"tel-new-num-form "+(e.state==3?"tel-new-num-form-disable":"")},children:[BX.create("span",{props:{className:"tel-balance-phone-icon"}}),BX.create("a",{props:{attrs:{href:"#put-phone"},className:"webform-small-button"},events:{click:e.state==3?null:function(e){BX.ViCallerId.connectPhone(BX.ViCallerId.phoneInput.value);return BX.PreventDefault(e)}},children:[BX.create("span",{props:{className:"webform-small-button-left"}}),BX.create("span",{props:{className:"webform-small-button-text"},html:BX.message("TELEPHONY_CONFIRM")}),BX.create("span",{props:{className:"webform-small-button-right"}})]}),BX.create("div",{props:{className:"tel-new-num-inp-wrap"},children:[BX.ViCallerId.phoneInput=BX.create("input",{props:{className:"tel-new-num-inp"},attrs:{placeholder:BX.message("TELEPHONY_EXAMPLE"),type:"text",value:BX.ViCallerId.inputNumber,disabled:e.state==3}})]})]});if(e.state==2){BX.ViCallerId.phoneNotice=a=BX.create("div",{props:{className:"tel-new-num-notice"},html:BX.message("TELEPHONY_VERIFY_CODE")+"<br>"+BX.message("TELEPHONY_VERIFY_CODE_4")+"<br><br>"+BX.message("TELEPHONY_VERIFY_CODE_3")})}else if(e.state==3){BX.ViCallerId.verifyPhone();BX.ViCallerId.phoneNotice=a=BX.create("div",{props:{className:"tel-new-num-notice"},html:BX.message("TELEPHONY_VERIFY_CODE_2")+"<br>"+BX.message("TELEPHONY_VERIFY_CODE_4")+"<br><br>"+BX.message("TELEPHONY_VERIFY_CODE_3")});i=BX.create("div",{props:{className:"tel-new-num-pass"},children:[BX.create("span",{props:{className:"tel-new-num-pass-title"},html:BX.message("TELEPHONY_PUT_CODE")}),BX.create("br"),BX.ViCallerId.codeInput=BX.create("input",{props:{className:"tel-new-num-inp"},attrs:{type:"text"}}),BX.ViCallerId.codeError=BX.create("span",{props:{className:"tel-new-num-pass-error"},html:""}),BX.create("a",{props:{attrs:{href:"#put-code"},className:"webform-small-button webform-small-button-accept"},events:{click:function(e){BX.ViCallerId.activatePhone(BX.ViCallerId.codeInput.value);return BX.PreventDefault(e)}},children:[BX.create("span",{props:{className:"webform-small-button-left"}}),BX.create("span",{props:{className:"webform-small-button-text"},html:BX.message("TELEPHONY_JOIN")}),BX.create("span",{props:{className:"webform-small-button-right"}})]}),BX.create("br"),BX.create("br"),BX.create("br"),BX.create("a",{attrs:{href:"#put-code",style:"margin-left: 3px; margin-right: 7px;"},props:{className:"webform-small-button"},events:{click:function(e){BX.ViCallerId.verifyPhone();return BX.PreventDefault(e)}},children:[BX.create("span",{props:{className:"webform-small-button-left"}}),BX.create("span",{props:{className:"webform-small-button-text"},html:BX.message("TELEPHONY_RECALL")}),BX.create("span",{props:{className:"webform-small-button-right"}})]}),BX.create("a",{props:{attrs:{href:"#put-code"},className:"webform-small-button"},events:{click:function(e){BX.ViCallerId.removePhone();return BX.PreventDefault(e)}},children:[BX.create("span",{props:{className:"webform-small-button-left"}}),BX.create("span",{props:{className:"webform-small-button-text"},html:BX.message("TELEPHONY_PUT_PHONE_AGAING")}),BX.create("span",{props:{className:"webform-small-button-right"}})]})]});n=null}}var s=[];if(BX.ViCallerId.number.length<=0||!BX.ViCallerId.verified){var l=null;if(BX.ViCallerId.number.length<=0){l=BX.create("div",{props:{className:"tel-balance-text"},children:[BX.create("span",{props:{className:"tel-balance-text-bold"},html:BX.message("TELEPHONY_EMPTY_PHONE")}),BX.create("span",{html:BX.message("TELEPHONY_EMPTY_PHONE_DESC")})]})}else{l=BX.create("div",{children:[BX.create("div",{props:{className:"tel-num-not-conf-text"},html:BX.message("TELEPHONY_CONFIRM_PHONE")}),BX.create("div",{props:{className:"tel-num-not-conf-block tel-num-block"},html:"+"+BX.ViCallerId.number}),BX.create("div",{props:{className:"tel-balance-text"},children:[BX.create("strong",{html:BX.message("TELEPHONY_EMPTY_PHONE_DESC")})]})]})}s=[BX.create("div",{props:{className:"tel-new-num-block"},children:[l,t,a,i,n]})]}else{s=[BX.create("div",{props:{className:"tel-balance-text"},children:[BX.create("strong",{props:{className:"tel-balance-text-bold"},html:BX.message("TELEPHONY_PHONE")})]}),BX.create("div",{props:{className:"tel-num-block"},html:"+"+BX.ViCallerId.number}),BX.create("div",{props:{className:"tel-num-change-block"},children:[BX.create("span",{props:{className:"tel-num-change-text"},html:BX.message("TELEPHONY_JOIN_TEXT")+" "}),BX.create("a",{props:{attrs:{href:"#change-phone"},className:"tel-num-change-link"},events:{click:function(e){if(confirm(BX.message("TELEPHONY_DELETE_CONFIRM"))){BX.ViCallerId.removePhone()}return BX.PreventDefault(e)}},html:BX.message("TELEPHONY_REJOIN")})]}),BX.create("div",{props:{className:"tel-set-item-block"},children:[BX.create("span",{props:{className:"tel-num-alert-text"},html:BX.message("TELEPHONY_CONFIRM_DATE").replace("#DATE#","<b>"+BX.ViCallerId.verifiedUntil+"</b>")})]})]}BX.ViCallerId.drawOnPlaceholder(s)};BX.ViCallerId.connectPhone=function(e){if(BX.ViCallerId.blockAjax)return false;BX.showWait();BX.ViCallerId.blockAjax=true;if(BX("tel-new-num-form")){BX.addClass(BX("tel-new-num-form"),"tel-new-num-form-disable")}BX.ajax({url:BX.ViCallerId.ajaxUrl,method:"POST",dataType:"json",timeout:30,data:{VI_CONNECT:"Y",NUMBER:e,VI_AJAX_CALL:"Y",sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(t){BX.closeWait();BX.ViCallerId.blockAjax=false;if(t.ERROR==""){BX.ViCallerId.inputNumber=e;if(t.VERIFIED){BX.ViCallerId.number=t.NUMBER;BX.ViCallerId.verified=true;BX.ViCallerId.verifiedUntil=t.VERIFIED_UNTIL;BX.ViCallerId.drawState({state:1})}else{BX.ViCallerId.verified=false;BX.ViCallerId.drawState({state:3})}}else{BX.addClass(BX.ViCallerId.phoneNotice,"tel-new-num-notice-err");BX.ViCallerId.phoneNotice.innerHTML=t.ERROR=="MONEY_LOW"?BX.message("TELEPHONY_ERROR_MONEY_LOW"):BX.message("TELEPHONY_ERROR_PHONE");BX.addClass(BX.ViCallerId.phoneInput,"tel-new-num-inp-err");BX.removeClass(BX("tel-new-num-form"),"tel-new-num-form-disable")}},this),onfailure:function(){BX.closeWait();BX.ViCallerId.blockAjax=false}})};BX.ViCallerId.verifyPhone=function(){if(BX.ViCallerId.blockAjax)return false;if(BX.ViCallerId.blockVerify){alert(BX.message("TELEPHONY_VERIFY_ALERT"));return true}setTimeout(function(){BX.ViCallerId.blockVerify=false},6e4);BX.ViCallerId.blockVerify=true;BX.showWait();BX.ViCallerId.blockAjax=true;BX.ajax({url:BX.ViCallerId.ajaxUrl,method:"POST",dataType:"json",timeout:30,data:{VI_VERIFY:"Y",VI_AJAX_CALL:"Y",sessid:BX.bitrix_sessid()},onsuccess:function(e){BX.closeWait();BX.ViCallerId.blockAjax=false;if(e.ERROR=="185"||e.ERROR=="183"){alert(BX.message("TELEPHONY_ERROR_BLOCK"));BX.ViCallerId.removePhone()}},onfailure:function(){BX.closeWait();BX.ViCallerId.blockVerify=false;BX.ViCallerId.blockAjax=false}})};BX.ViCallerId.activatePhone=function(e){if(BX.ViCallerId.blockAjax)return false;BX.showWait();BX.ViCallerId.blockAjax=true;BX.ajax({url:BX.ViCallerId.ajaxUrl,method:"POST",dataType:"json",timeout:30,data:{VI_ACTIVATE:"Y",CODE:e,VI_AJAX_CALL:"Y",sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(e){BX.ViCallerId.blockVerify=false;BX.closeWait();BX.ViCallerId.blockAjax=false;if(e.ERROR==""){BX.ViCallerId.number=e.NUMBER;BX.ViCallerId.verified=true;BX.ViCallerId.verifiedUntil=e.VERIFIED_UNTIL;BX.ViCallerId.drawState({state:1})}else{BX.ViCallerId.codeError.innerHTML=BX.message("TELEPHONY_WRONG_CODE");BX.addClass(BX.ViCallerId.codeInput,"tel-new-num-inp-err")}},this),onfailure:function(){BX.closeWait();BX.ViCallerId.blockVerify=false;BX.ViCallerId.blockAjax=false}})};BX.ViCallerId.removePhone=function(){if(BX.ViCallerId.blockAjax)return false;BX.ViCallerId.blockVerify=false;BX.showWait();BX.ViCallerId.blockAjax=true;BX.ajax({url:BX.ViCallerId.ajaxUrl,method:"POST",dataType:"json",timeout:30,data:{VI_REMOVE:"Y",VI_AJAX_CALL:"Y",sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(e){BX.closeWait();BX.ViCallerId.blockAjax=false;if(e.ERROR==""){BX.ViCallerId.number="";BX.ViCallerId.verified=false;BX.ViCallerId.drawState({state:1})}else{alert(BX.message("TELEPHONY_ERROR_REMOVE"))}},this),onfailure:function(){BX.closeWait();BX.ViCallerId.blockAjax=false}})};BX.ViCallerId.drawOnPlaceholder=function(e){BX.ViCallerId.placeholder.innerHTML="";BX.adjust(BX.ViCallerId.placeholder,{children:e})}})(window);
//# sourceMappingURL=script.map.js